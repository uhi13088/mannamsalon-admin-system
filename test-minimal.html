<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§›ë‚¨ì‚´ë¡± ê´€ë¦¬ì í˜ì´ì§€</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #8b7355; --primary-dark: #6b5d4f; --bg-light: #f5f1e8; --bg-white: #fdfcfa;
      --text-primary: #6b5d4f; --text-secondary: #9b8a76; --border-color: #e8dfd0; --border-radius: 8px;
      --shadow-sm: 0 2px 8px rgba(107, 93, 79, 0.08); --shadow-lg: 0 8px 24px rgba(107, 93, 79, 0.15);
      --spacing-xs: 6px; --spacing-sm: 12px; --spacing-md: 16px; --spacing-lg: 24px; --spacing-xl: 32px;
      --success-color: #7a9b7a; --warning-color: #d4a574; --danger-color: #c67b7b;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: var(--bg-light); color: var(--text-primary); }
    .hidden { display: none !important; }
    #loginScreen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-box { background: var(--bg-white); border-radius: 12px; padding: 48px 40px; box-shadow: var(--shadow-lg); max-width: 420px; width: 100%; border: 1px solid var(--border-color); text-align: center; }
    .login-logo { font-size: 64px; margin-bottom: 16px; }
    .login-box h1 { font-size: 28px; color: var(--text-primary); margin-bottom: 8px; }
    .login-subtitle { color: var(--text-secondary); margin-bottom: 32px; font-size: 14px; }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px; }
    .form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 15px; }
    .btn { padding: 12px 24px; border-radius: var(--border-radius); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border: none; }
    .btn-primary { background: var(--primary-color); color: var(--bg-white); }
    .btn-primary:hover { background: var(--primary-dark); box-shadow: var(--shadow-sm); }
    .btn-secondary { background: var(--bg-light); color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-sm { padding: 8px 16px; font-size: 12px; }
    .btn-danger { background: var(--danger-color); color: var(--bg-white); }
    .btn-success { background: var(--success-color); color: var(--bg-white); }
    .container { max-width: 1200px; margin: 0 auto; padding: var(--spacing-lg); }
    .top-bar { background: var(--bg-white); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl); }
    .admin-badge { background: var(--primary-color); color: var(--bg-white); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); }
    .dashboard-card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .dashboard-card-icon { font-size: 36px; margin-bottom: var(--spacing-sm); }
    .dashboard-card-label { color: var(--text-secondary); font-size: 13px; margin-bottom: var(--spacing-xs); }
    .dashboard-card-value { font-size: 32px; font-weight: 700; color: var(--text-primary); }
    .dashboard-card-sub { font-size: 13px; color: var(--text-secondary); margin-top: var(--spacing-xs); }
    .tabs { display: flex; gap: var(--spacing-xs); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--border-color); overflow-x: auto; flex-wrap: wrap; }
    .tab { padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; color: var(--text-secondary); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent; white-space: nowrap; }
    .tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .card-header { padding: var(--spacing-lg); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0; }
    .card-body { padding: var(--spacing-lg); }
    table { width: 100%; border-collapse: collapse; }
    table th { background: var(--bg-light); padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--border-color); font-size: 13px; }
    table td { padding: 12px; border-bottom: 1px solid var(--border-color); font-size: 14px; color: var(--text-primary); }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; }
    .badge-success { background: #e6f2e6; color: #4a6b4a; }
    .badge-warning { background: #f5ead9; color: #8b6846; }
    .badge-danger { background: #f5e3e3; color: #8b5555; }
    .badge-info { background: #e3ebf2; color: #5a708a; }
    .badge-primary { background: #e3ebf2; color: #5a708a; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
    .modal-content { background: var(--bg-white); border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); }
    .modal-header { padding: 25px 30px; border-bottom: 2px solid var(--bg-light); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 30px; }
    .modal-footer { padding: 20px 30px; border-top: 2px solid var(--bg-light); text-align: right; display: flex; gap: 8px; justify-content: flex-end; }
    .modal-close { background: none; border: none; font-size: 28px; color: var(--text-secondary); cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
    .modal-close:hover { background: var(--bg-light); color: var(--text-primary); }
    .filters { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); flex-wrap: wrap; }
    .filter-group { flex: 1; min-width: 200px; }
    .filter-group label { display: block; margin-bottom: var(--spacing-xs); font-weight: 600; color: var(--text-primary); font-size: 13px; }
    .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; }
    
    /* ê³„ì•½ì„œ ëª¨ë‹¬ ì „ìš© ìŠ¤íƒ€ì¼ */
    #contractModal { z-index: 10000; }
    #contractModal .modal-content { max-width: 95%; width: 1400px; max-height: 95vh; }
    #contractModal .tab-buttons { display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--border-color); }
    #contractModal .tab-button { padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    #contractModal .tab-button:hover { color: var(--primary-color); }
    #contractModal .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    #contractModal .tab-content { display: none; }
    #contractModal .tab-content.active { display: block; }
    #contractModal .form-section { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-xl); margin-bottom: var(--spacing-lg); }
    #contractModal .form-section h3 { font-size: 18px; color: var(--text-primary); margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color); }
    #contractModal .form-section h4 { font-size: 15px; color: var(--primary-color); margin: var(--spacing-lg) 0 var(--spacing-md) 0; }
    #contractModal .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-md); }
    #contractModal .form-group { display: flex; flex-direction: column; }
    #contractModal .form-group label { font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-xs); font-size: 14px; }
    #contractModal .form-group input, #contractModal .form-group select, #contractModal .form-group textarea { padding: var(--spacing-sm); border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; transition: border-color 0.2s ease; }
    #contractModal .form-group input:focus, #contractModal .form-group select:focus, #contractModal .form-group textarea:focus { outline: none; border-color: var(--primary-color); }
    #contractModal .form-group textarea { min-height: 150px; resize: vertical; font-family: inherit; line-height: 1.6; }
    #contractModal .help-text { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
    #contractModal .day-buttons { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    #contractModal .day-btn { padding: 10px 18px; border: 2px solid var(--border-color); background: var(--bg-white); color: var(--text-secondary); border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 14px; min-width: 50px; }
    #contractModal .day-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }
    #contractModal .day-btn.active { background: var(--primary-color); border-color: var(--primary-color); color: var(--bg-white); }
    #contractModal .work-schedule-item { background: var(--bg-light); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-md); margin-bottom: var(--spacing-md); }
    #contractModal .action-buttons { display: flex; gap: var(--spacing-md); justify-content: flex-end; margin-top: var(--spacing-xl); }
    #contractModal .preview-section { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-xl); }
    #contractModal .preview-content { max-width: 800px; margin: 0 auto; padding: 40px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    #contractModal .preview-title { text-align: center; font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-xl); letter-spacing: 8px; }
    #contractModal .preview-table { width: 100%; border-collapse: collapse; margin: var(--spacing-lg) 0; }
    #contractModal .preview-table th, #contractModal .preview-table td { border: 1px solid var(--border-color); padding: var(--spacing-md); text-align: left; }
    #contractModal .preview-table th { background: var(--bg-light); font-weight: 600; width: 30%; }
    
    /* í˜ì´ì§€ ë¸Œë ˆì´í¬ ìŠ¤íƒ€ì¼ */
    .page-break-before { page-break-before: always; break-before: page; }
    .page-break-after { page-break-after: always; break-after: page; }
    .avoid-page-break { page-break-inside: avoid; break-inside: avoid; }
    
    /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
    @media print {
      body * { visibility: hidden; }
      #contractViewModal, #contractViewModal * { visibility: visible; }
      #contractViewModal { position: fixed; left: 0; top: 0; width: 100%; height: 100%; background: white; z-index: 9999; }
      #contractControls, #contractSelector { display: none !important; }
      #contractPrintArea { box-shadow: none !important; margin: 0 !important; padding: 15mm !important; }
      #contractPrintArea table { page-break-inside: avoid; }
      #contractPrintArea table tr { page-break-inside: avoid; page-break-after: auto; }
      #contractPrintArea h1 { page-break-after: avoid; }
      .modal-overlay { position: static; background: white; }
      .modal-content { max-width: 100% !important; box-shadow: none !important; }
    }
  </style>
</head>
<body>
  <div id="mainScreen">
    <div class="top-bar">
      <h1 style="font-size: 20px; font-weight: 700; margin: 0;">ğŸª ë§›ë‚¨ì‚´ë¡± ê·¼ë¬´ê´€ë¦¬</h1>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span class="admin-badge">ê´€ë¦¬ì</span>
        <button class="btn btn-secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div class="container">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <div class="dashboard-card-icon">ğŸ‘¥</div>
          <div class="dashboard-card-label">ì´ ì§ì› ìˆ˜</div>
          <div class="dashboard-card-value" id="totalEmployees">0</div>
          <div class="dashboard-card-sub">ëª…</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">âœ…</div>
          <div class="dashboard-card-label">ì˜¤ëŠ˜ ì¶œê·¼</div>
          <div class="dashboard-card-value" id="todayAttendance">0</div>
          <div class="dashboard-card-sub">ëª…</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">â°</div>
          <div class="dashboard-card-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
          <div class="dashboard-card-value" id="pendingApprovals">0</div>
          <div class="dashboard-card-sub">ê±´</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">ğŸ“„</div>
          <div class="dashboard-card-label">ë¯¸ì„œëª… ê³„ì•½ì„œ</div>
          <div class="dashboard-card-value" id="unsignedContracts">0</div>
          <div class="dashboard-card-sub">ê±´</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab" data-tab="employees" onclick="switchTab('employees')">ğŸ‘¥ ì§ì› ê´€ë¦¬</button>
        <button class="tab" data-tab="attendance" onclick="switchTab('attendance')">ğŸ“‹ ê·¼ë¬´ê¸°ë¡</button>
        <button class="tab" data-tab="salary" onclick="switchTab('salary')">ğŸ’° ê¸‰ì—¬ ê´€ë¦¬</button>
        <button class="tab" data-tab="approvals" onclick="switchTab('approvals')">âœ”ï¸ ìŠ¹ì¸ ê´€ë¦¬</button>
        <button class="tab" data-tab="contracts" onclick="switchTab('contracts')">ğŸ“ ê³„ì•½ì„œ ê´€ë¦¬</button>
        <button class="tab" data-tab="notice" onclick="switchTab('notice')">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
        <button class="tab" data-tab="stores" onclick="switchTab('stores')">ğŸª ë§¤ì¥ ê´€ë¦¬</button>
      </div>

      <div id="tabDashboard" class="tab-content active">
        <div class="card">
          <div class="card-header"><h3>ğŸ“Š í˜„í™© ìš”ì•½</h3></div>
          <div class="card-body"><p style="color: var(--text-secondary);">ê´€ë¦¬ì í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</p></div>
        </div>

        <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="card">
          <div class="card-header">
            <h3>ğŸ—„ï¸ ë°ì´í„° ê´€ë¦¬</h3>
          </div>
          <div class="card-body">
            <!-- ìš©ëŸ‰ ì •ë³´ -->
            <div style="background: var(--bg-light); padding: var(--spacing-lg); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg);">
              <h4 style="margin: 0 0 var(--spacing-sm) 0; font-size: 14px; color: var(--text-secondary);">ğŸ“¦ Firebase ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰</h4>
              <div style="display: flex; align-items: baseline; gap: var(--spacing-sm);">
                <span id="storageSize" style="font-size: 32px; font-weight: 700; color: var(--primary-color);">-</span>
                <span style="font-size: 16px; color: var(--text-secondary);">MB / 1,000 MB</span>
              </div>
              <div style="margin-top: var(--spacing-md); background: white; border-radius: 10px; height: 20px; overflow: hidden;">
                <div id="storageBar" style="height: 100%; background: linear-gradient(90deg, var(--success-color), var(--warning-color)); width: 0%; transition: width 0.5s ease;"></div>
              </div>
              <p style="margin-top: var(--spacing-sm); font-size: 12px; color: var(--text-secondary);">
                â° ë§ˆì§€ë§‰ ìë™ ì •ë¦¬: <span id="lastCleanupTime">-</span>
              </p>
            </div>

            <!-- ë§ˆì´ê·¸ë ˆì´ì…˜ ì•ˆë‚´ -->
            <div id="migrationAlert" style="display: none; background: #fff3cd; border: 1px solid #ffc107; padding: var(--spacing-lg); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg);">
              <h4 style="margin: 0 0 var(--spacing-sm) 0; color: #856404;">âš ï¸ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”</h4>
              <p style="margin: 0 0 var(--spacing-sm) 0; font-size: 14px; color: #856404;">
                ë¸Œë¼ìš°ì € localStorageì— ì €ì¥ëœ ë°ì´í„°ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Firebaseë¡œ ì´ë™í•˜ì—¬ ì˜êµ¬ ë³´ì¡´í•˜ì„¸ìš”.
              </p>
              <button class="btn" style="background: #ffc107; color: #000; font-weight: 600;" onclick="startMigration()">
                ğŸ”„ ì§€ê¸ˆ ë§ˆì´ê·¸ë ˆì´ì…˜
              </button>
            </div>

            <!-- ê´€ë¦¬ ë²„íŠ¼ë“¤ -->
            <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
              <button class="btn btn-primary" onclick="checkStorageSize()">
                ğŸ“Š ìš©ëŸ‰ í™•ì¸
              </button>
              <button class="btn" style="background: #6c757d; color: white;" onclick="previewCleanup()">
                ğŸ” ì •ë¦¬ ë¯¸ë¦¬ë³´ê¸°
              </button>
              <button class="btn btn-danger" onclick="executeCleanup()">
                ğŸ—‘ï¸ ìë™ ì •ë¦¬ ì‹¤í–‰
              </button>
              <button class="btn btn-secondary" onclick="backupData()">
                ğŸ’¾ ë¡œì»¬ ë°±ì—…
              </button>
            </div>

            <!-- ìë™ ì •ë¦¬ ì„¤ì • -->
            <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-color);">
              <h4 style="margin: 0 0 var(--spacing-md) 0; font-size: 14px; font-weight: 600;">âš™ï¸ ìë™ ì •ë¦¬ ì„¤ì •</h4>
              <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                <label style="display: flex; align-items: center; font-size: 14px;">
                  <input type="checkbox" id="autoCleanupEnabled" checked style="margin-right: var(--spacing-sm);">
                  <span>24ì‹œê°„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì˜¤ë˜ëœ ë°ì´í„° ì •ë¦¬</span>
                </label>
                <p style="margin: 0; font-size: 12px; color: var(--text-secondary); margin-left: 24px;">
                  âœ“ 1ë…„ ì´ìƒ ì§€ë‚œ ê³„ì•½ì„œ/ê³µì§€ì‚¬í•­ ìë™ ì‚­ì œ<br>
                  âœ“ ìš©ëŸ‰ 950MB ì´ˆê³¼ ì‹œ ì˜¤ë˜ëœ ë°ì´í„°ë¶€í„° ìë™ ì‚­ì œ<br>
                  âœ“ ì‚­ì œ ì „ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ì œê³µ
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="tabEmployees" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ‘¥ ì§ì› ëª©ë¡</h3>
          </div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ë§¤ì¥</label>
                <select id="employeeStoreFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ë¶€ì²œì‹œì²­ì ">ë¶€ì²œì‹œì²­ì </option>
                  <option value="ìƒë™ì ">ìƒë™ì </option>
                  <option value="ë¶€ì²œì—­ì‚¬ì ">ë¶€ì²œì—­ì‚¬ì </option>
                </select>
              </div>
              <div class="filter-group">
                <label>ìƒíƒœ</label>
                <select id="employeeStatusFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ì¬ì§">ì¬ì§</option>
                  <option value="í‡´ì‚¬">í‡´ì‚¬</option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadEmployees()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ì§ê¸‰</th>
                  <th>ì—°ë½ì²˜</th>
                  <th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="employeeTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabAttendance" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ“‹ ê·¼ë¬´ê¸°ë¡</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ì¡°íšŒ ì›”</label>
                <input type="month" id="attendanceMonth">
              </div>
              <div class="filter-group">
                <label>ë§¤ì¥</label>
                <select id="attendanceStoreFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ë¶€ì²œì‹œì²­ì ">ë¶€ì²œì‹œì²­ì </option>
                  <option value="ìƒë™ì ">ìƒë™ì </option>
                  <option value="ë¶€ì²œì—­ì‚¬ì ">ë¶€ì²œì—­ì‚¬ì </option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadAttendanceList()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ë‚ ì§œ</th>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ì¶œê·¼</th>
                  <th>í‡´ê·¼</th>
                  <th>ê·¼ë¬´ì‹œê°„</th>
                  <th>ìƒíƒœ</th>
                </tr>
              </thead>
              <tbody id="attendanceTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; color: var(--text-secondary);">ê·¼íƒœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabSalary" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ’° ê¸‰ì—¬ ë‚´ì—­</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ì¡°íšŒ ì›”</label>
                <input type="month" id="salaryMonth">
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadSalaryList()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ê¸°ë³¸ê¸‰</th>
                  <th>ì¶”ê°€ìˆ˜ë‹¹</th>
                  <th>ê³µì œ</th>
                  <th>ì‹¤ì§€ê¸‰ì•¡</th>
                </tr>
              </thead>
              <tbody id="salaryTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ê¸‰ì—¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabApprovals" class="tab-content">
        <!-- í•„í„° -->
        <div class="filters">
          <div class="filter-group">
            <label>ìŠ¹ì¸ ìœ í˜•</label>
            <select id="approvalTypeFilter">
              <option value="">ì „ì²´</option>
              <option value="purchase">ğŸ’³ êµ¬ë§¤</option>
              <option value="disposal">ğŸ—‘ï¸ íê¸°</option>
              <option value="resignation">ğŸ“„ í‡´ì§ì„œ</option>
            </select>
          </div>
          <div class="filter-group">
            <label>ìƒíƒœ</label>
            <select id="approvalStatusFilter">
              <option value="">ì „ì²´</option>
              <option value="pending">ëŒ€ê¸°ì¤‘</option>
              <option value="approved">ìŠ¹ì¸ë¨</option>
              <option value="rejected">ê±°ë¶€ë¨</option>
            </select>
          </div>
          <div class="filter-group">
            <label>&nbsp;</label>
            <button class="btn btn-primary" onclick="loadApprovals()">ì¡°íšŒ</button>
          </div>
        </div>

        <div class="card">
          <div class="card-header"><h3>âœ”ï¸ ìŠ¹ì¸ ìš”ì²­ ëª©ë¡</h3></div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th style="width: 100px;">ìœ í˜•</th>
                  <th style="width: 100px;">ì‹ ì²­ì</th>
                  <th style="width: 140px;">ì‹ ì²­ì¼</th>
                  <th>ë‚´ìš©</th>
                  <th style="width: 120px;">ê¸ˆì•¡/ìˆ˜ëŸ‰</th>
                  <th style="width: 100px;">ìƒíƒœ</th>
                  <th style="width: 200px;">ì²˜ë¦¬</th>
                </tr>
              </thead>
              <tbody id="approvalsTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    ìŠ¹ì¸ ìš”ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabContracts" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ“ ê³„ì•½ì„œ ëª©ë¡</h3>
            <button class="btn btn-primary" onclick="openContractPage()">+ ìƒˆ ê³„ì•½ì„œ ì‘ì„±</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ì§ì›ëª…</th>
                  <th>ê³„ì•½ ìœ í˜•</th>
                  <th>ê³„ì•½ ê¸°ê°„</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="contractsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ê³„ì•½ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabNotice" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h3>
            <button class="btn btn-primary" onclick="showAddNoticeModal()">+ ê³µì§€ì‚¬í•­ ì‘ì„±</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ì¤‘ìš”</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="noticeTableBody">
                <tr>
                  <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabStores" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸª ë§¤ì¥ ê´€ë¦¬</h3>
            <button class="btn btn-primary" onclick="showAddStoreModal()">+ ë§¤ì¥ ì¶”ê°€</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ë§¤ì¥ëª…</th>
                  <th>ì£¼ì†Œ</th>
                  <th>ì—°ë½ì²˜</th>
                  <th>ëŒ€í‘œì</th>
                  <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="storesTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ë¡œë”© ì¤‘...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë§¤ì¥ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="storeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="storeModalTitle" style="margin: 0;">ğŸª ë§¤ì¥ ì¶”ê°€</h2>
        <button class="modal-close" onclick="closeStoreModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editStoreId">
        <div class="form-group">
          <label for="storeName">ë§¤ì¥ëª… *</label>
          <input type="text" id="storeName" placeholder="ë¶€ì²œì‹œì²­ì " required>
        </div>
        <div class="form-group">
          <label for="storeAddress">ì£¼ì†Œ</label>
          <input type="text" id="storeAddress" placeholder="ê²½ê¸°ë„ ë¶€ì²œì‹œ...">
        </div>
        <div class="form-group">
          <label for="storePhone">ì—°ë½ì²˜</label>
          <input type="tel" id="storePhone" placeholder="032-123-4567">
        </div>
        <div class="form-group">
          <label for="storeCEO">ëŒ€í‘œìëª…</label>
          <input type="text" id="storeCEO" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
          <label for="storeBusinessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
          <input type="text" id="storeBusinessNumber" placeholder="123-45-67890">
        </div>
        <div class="form-group">
          <label>ëŒ€í‘œ ì„œëª… ì´ë¯¸ì§€</label>
          <div style="margin-bottom: 10px;">
            <input type="file" id="storeCeoSignatureInput" accept="image/*" onchange="previewStoreSignature(event)" style="display: none;">
            <button type="button" class="btn" style="background: #6c757d; color: white; width: 100%;" onclick="document.getElementById('storeCeoSignatureInput').click()">
              ğŸ“¸ ëŒ€í‘œ ì„œëª… ì—…ë¡œë“œ
            </button>
          </div>
          <div id="storeCeoSignaturePreview" style="border: 2px dashed #ddd; padding: 20px; text-align: center; min-height: 100px; display: flex; align-items: center; justify-content: center;">
            <span style="color: #999;">ì„œëª… ì´ë¯¸ì§€ ì„ íƒ (ì„ íƒì‚¬í•­)</span>
          </div>
          <small style="color: #666; display: block; margin-top: 8px;">
            ğŸ’¡ ë§¤ì¥ë³„ ëŒ€í‘œìê°€ ë‹¤ë¥¼ ê²½ìš° ê°ê° ì„œëª…ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeStoreModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveStore()">ì €ì¥</button>
        <button id="deleteStoreBtn" class="btn btn-danger" onclick="deleteStore()" style="display: none; margin-right: auto;">ì‚­ì œ</button>
      </div>
    </div>
  </div>

  <!-- ê³µì§€ì‚¬í•­ ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="noticeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 id="noticeModalTitle" style="margin: 0;">ğŸ“¢ ê³µì§€ì‚¬í•­ ì‘ì„±</h2>
        <button class="modal-close" onclick="closeNoticeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editNoticeId">
        <div class="form-group">
          <label for="noticeTitle">ì œëª© *</label>
          <input type="text" id="noticeTitle" placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <div class="form-group">
          <label for="noticeContent">ë‚´ìš© *</label>
          <textarea id="noticeContent" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required style="min-height: 300px; resize: vertical;"></textarea>
        </div>
        <div class="form-group">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="noticeImportant" style="width: auto; margin-right: 8px; cursor: pointer;">
            <span style="font-size: 14px;">â­ ì¤‘ìš” ê³µì§€ì‚¬í•­ìœ¼ë¡œ í‘œì‹œ</span>
          </label>
          <small style="color: #666; display: block; margin-top: 8px;">
            ì¤‘ìš” ê³µì§€ì‚¬í•­ì€ ì§ì› í˜ì´ì§€ ìƒë‹¨ì— ê³ ì • í‘œì‹œë©ë‹ˆë‹¤.
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeNoticeModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveNotice()">ì €ì¥</button>
        <button id="deleteNoticeBtn" class="btn btn-danger" onclick="deleteNotice()" style="display: none; margin-right: auto;">ì‚­ì œ</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isAuthenticated = false;
    let currentTab = 'dashboard';
    
    // firestore-utils.js ëŒ€ì‹  í•„ìš”í•œ í•¨ìˆ˜ë§Œ ì¸ë¼ì¸ìœ¼ë¡œ í¬í•¨
    // (firestore-utils.js íŒŒì¼ ë¡œë”© ì‹œ await ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ì¸ë¼ì¸ìœ¼ë¡œ ë³€ê²½)

    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      const monthFilters = ['attendanceMonth', 'salaryMonth'];
      monthFilters.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.value = currentMonth;
      });
      checkAuthStatus();
    });

    function checkAuthStatus() {
      // Firebase Auth ìƒíƒœ í™•ì¸
      auth.onAuthStateChanged(async (user) => {
        if (!user) {
          // Firebase Auth ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ
          const savedAuth = sessionStorage.getItem('admin_authenticated');
          const isLoggingOut = sessionStorage.getItem('admin_logging_out');
          
          if (savedAuth === 'true' && !isLoggingOut) {
            // sessionStorageì—ëŠ” ìˆì§€ë§Œ Firebase AuthëŠ” ì—†ìŒ - ë‹¤ì‹œ ë¡œê·¸ì¸ í•„ìš”
            alert('âš ï¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
          }
          
          sessionStorage.clear();
          window.location.href = 'admin-login.html';
          return;
        }
        
        // Firestoreì—ì„œ ì‚¬ìš©ì role í™•ì¸
        try {
          const userDoc = await db.collection('users').doc(user.uid).get();
          
          if (!userDoc.exists) {
            alert('âš ï¸ ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            await auth.signOut();
            sessionStorage.clear();
            window.location.href = 'admin-login.html';
            return;
          }
          
          const userData = userDoc.data();
          
          // ê´€ë¦¬ì ë˜ëŠ” ë§¤ë‹ˆì € ê¶Œí•œ í™•ì¸
          if (userData.role !== 'admin' && userData.role !== 'manager') {
            alert('âš ï¸ ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
            await auth.signOut();
            sessionStorage.clear();
            window.location.href = 'admin-login.html';
            return;
          }
          
          // ì¸ì¦ ì„±ê³µ
          isAuthenticated = true;
          sessionStorage.setItem('admin_authenticated', 'true');
          sessionStorage.setItem('admin_email', user.email);
          sessionStorage.setItem('admin_uid', user.uid);
          sessionStorage.setItem('admin_role', userData.role);
          showMainScreen();
          
        } catch (error) {
          console.error('âŒ ì‚¬ìš©ì ì •ë³´ í™•ì¸ ì‹¤íŒ¨:', error);
          alert('âš ï¸ ì‚¬ìš©ì ì •ë³´ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          await auth.signOut();
          sessionStorage.clear();
          window.location.href = 'admin-login.html';
        }
</body></html>
