<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§›ë‚¨ì‚´ë¡± ê´€ë¦¬ì ê°€ì…</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #8b7355; 
      --primary-dark: #6b5d4f; 
      --bg-light: #f5f1e8; 
      --bg-white: #fdfcfa;
      --text-primary: #6b5d4f; 
      --text-secondary: #9b8a76; 
      --border-color: #e8dfd0; 
      --border-radius: 8px;
      --shadow-sm: 0 2px 8px rgba(107, 93, 79, 0.08); 
      --shadow-lg: 0 8px 24px rgba(107, 93, 79, 0.15);
      --spacing-xs: 6px; 
      --spacing-sm: 12px; 
      --spacing-md: 16px; 
      --spacing-lg: 24px; 
      --spacing-xl: 32px;
      --success-color: #7a9b7a; 
      --warning-color: #d4a574; 
      --danger-color: #c67b7b;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
      background: var(--bg-light);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: var(--text-primary);
    }

    .register-box {
      background: var(--bg-white);
      border-radius: 12px;
      padding: 48px 40px;
      box-shadow: var(--shadow-lg);
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--border-color);
    }

    .logo {
      text-align: center;
      font-size: 64px;
      margin-bottom: 16px;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-weight: 700;
    }

    .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }

    label .required {
      color: var(--danger-color);
    }

    input, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 15px;
      transition: all 0.2s;
      background: var(--bg-white);
      color: var(--text-primary);
    }

    input:focus, select:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .btn {
      width: 100%;
      padding: 14px;
      background: var(--primary-color);
      color: var(--bg-white);
      border: none;
      border-radius: var(--border-radius);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 10px;
    }

    .btn:hover {
      background: var(--primary-dark);
      box-shadow: var(--shadow-sm);
    }

    .btn:disabled {
      background: var(--text-secondary);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .error {
      background: #f5e3e3;
      color: #8b5555;
      padding: 12px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      font-size: 14px;
      border: 1px solid #e8c0c0;
      display: none;
    }

    .error.show {
      display: block;
    }

    .success {
      background: #e6f2e6;
      color: #4a6b4a;
      padding: 12px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      font-size: 14px;
      border: 1px solid #c0dcc0;
      display: none;
    }

    .success.show {
      display: block;
    }

    .loading {
      display: none;
      text-align: center;
      color: var(--primary-color);
      font-weight: 600;
      margin-top: 10px;
    }

    .loading.show {
      display: block;
    }

    .help-text {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .login-link {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .login-link a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
    }

    .login-link a:hover {
      text-decoration: underline;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--primary-color);
      margin: var(--spacing-lg) 0 var(--spacing-md) 0;
      padding-bottom: var(--spacing-xs);
      border-bottom: 2px solid var(--border-color);
    }

    .role-info {
      background: #f0f8ff;
      padding: 12px;
      border-radius: var(--border-radius);
      font-size: 13px;
      color: #4a5f7a;
      margin-top: 8px;
      border: 1px solid #d0e5ff;
    }

    .role-info strong {
      color: var(--primary-color);
    }
  </style>
</head>
<body>
  <div class="register-box">
    <div class="logo">â˜•</div>
    <h1>ë§›ë‚¨ì‚´ë¡±</h1>
    <p class="subtitle">ê´€ë¦¬ì ê°€ì… ì‹ ì²­</p>

    <div id="error" class="error"></div>
    <div id="success" class="success"></div>

    <form id="registerForm">
      <!-- ê¸°ë³¸ ì •ë³´ -->
      <div class="section-title">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</div>
      
      <div class="form-group">
        <label for="name">ì´ë¦„ <span class="required">*</span></label>
        <input type="text" id="name" placeholder="í™ê¸¸ë™" required>
      </div>

      <div class="form-group">
        <label for="phone">ì—°ë½ì²˜ <span class="required">*</span></label>
        <input type="tel" id="phone" placeholder="010-1234-5678" required>
        <div class="help-text">- í¬í•¨í•˜ì—¬ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
      </div>

      <!-- ì§ì±…/ê¶Œí•œ ì •ë³´ -->
      <div class="section-title">ğŸ’¼ ê¶Œí•œ ì •ë³´</div>
      
      <div class="form-group">
        <label for="role">ì§ì±… <span class="required">*</span></label>
        <select id="role" required>
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="admin">ê´€ë¦¬ì</option>
          <option value="manager">ë§¤ë‹ˆì €</option>
        </select>
        <div id="roleInfo" class="role-info" style="display: none;">
          <strong>ê´€ë¦¬ì</strong>: ëª¨ë“  ë°ì´í„° ì½ê¸°/ì“°ê¸°/í¸ì§‘/ì‚­ì œ ê¶Œí•œ<br>
          <strong>ë§¤ë‹ˆì €</strong>: ëª¨ë“  ë°ì´í„° ì½ê¸° ì „ìš© ê¶Œí•œ (ì“°ê¸°/í¸ì§‘ ë¶ˆê°€)
        </div>
      </div>

      <!-- ê³„ì • ì •ë³´ -->
      <div class="section-title">ğŸ” ê³„ì • ì •ë³´</div>
      
      <div class="form-group">
        <label for="email">ì´ë©”ì¼ (ë¡œê·¸ì¸ ID) <span class="required">*</span></label>
        <input type="email" id="email" placeholder="admin@example.com" required>
        <div class="help-text">ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©í•  ì´ë©”ì¼ ì£¼ì†Œ</div>
      </div>

      <div class="form-group">
        <label for="password">ë¹„ë°€ë²ˆí˜¸ <span class="required">*</span></label>
        <input type="password" id="password" placeholder="6ì ì´ìƒ" required minlength="6">
      </div>

      <div class="form-group">
        <label for="passwordConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="required">*</span></label>
        <input type="password" id="passwordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" required minlength="6">
      </div>

      <button type="submit" id="registerBtn" class="btn">ê°€ì… ì‹ ì²­í•˜ê¸°</button>
    </form>

    <div class="loading" id="loading">â³ ê°€ì… ì‹ ì²­ ì²˜ë¦¬ ì¤‘...</div>

    <div class="login-link">
      ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="admin-login.html">ë¡œê·¸ì¸</a>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    // Firebase ì´ˆê¸°í™”
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');

    // ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const registerForm = document.getElementById('registerForm');
    const registerBtn = document.getElementById('registerBtn');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const successDiv = document.getElementById('success');
    const roleSelect = document.getElementById('role');
    const roleInfo = document.getElementById('roleInfo');

    // ì—­í•  ì„ íƒ ì‹œ ì„¤ëª… í‘œì‹œ
    roleSelect.addEventListener('change', function() {
      if (this.value) {
        roleInfo.style.display = 'block';
      } else {
        roleInfo.style.display = 'none';
      }
    });

    // ì—ëŸ¬ í‘œì‹œ
    function showError(msg) {
      errorDiv.textContent = msg;
      errorDiv.classList.add('show');
      successDiv.classList.remove('show');
    }

    // ì„±ê³µ í‘œì‹œ
    function showSuccess(msg) {
      successDiv.textContent = msg;
      successDiv.classList.add('show');
      errorDiv.classList.remove('show');
    }

    // ë©”ì‹œì§€ ìˆ¨ê¹€
    function hideMessages() {
      errorDiv.classList.remove('show');
      successDiv.classList.remove('show');
    }

    // ê°€ì… í¼ ì œì¶œ
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const role = document.getElementById('role').value;
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const passwordConfirm = document.getElementById('passwordConfirm').value;
      
      // ìœ íš¨ì„± ê²€ì‚¬
      if (!name || !phone || !role || !email || !password) {
        showError('âš ï¸ ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      if (password !== passwordConfirm) {
        showError('âš ï¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }

      if (password.length < 6) {
        showError('âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      hideMessages();
      registerBtn.disabled = true;
      loading.classList.add('show');
      
      try {
        console.log('ğŸ“ ê´€ë¦¬ì ê°€ì… ì‹ ì²­ ì‹œì‘:', email, 'ì—­í• :', role);
        
        // 1. Firebase Authenticationì— ì‚¬ìš©ì ìƒì„±
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        console.log('âœ… Auth ì‚¬ìš©ì ìƒì„± ì™„ë£Œ:', user.uid);
        
        // 2. Firestoreì— ê´€ë¦¬ì ì •ë³´ ì €ì¥
        const adminData = {
          uid: user.uid,
          email: email,
          name: name,
          phone: phone,
          userType: 'admin',
          role: role,  // 'admin' ë˜ëŠ” 'manager'
          position: role === 'admin' ? 'ê´€ë¦¬ì' : 'ë§¤ë‹ˆì €',
          status: 'pending',  // ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        // users ì»¬ë ‰ì…˜ì— ì €ì¥
        await db.collection('users').doc(user.uid).set(adminData);
        
        console.log('âœ… Firestoreì— ê´€ë¦¬ì ì •ë³´ ì €ì¥ ì™„ë£Œ (ìŠ¹ì¸ ëŒ€ê¸°)');
        
        const roleText = role === 'admin' ? 'ê´€ë¦¬ì' : 'ë§¤ë‹ˆì €';
        showSuccess(`âœ… ${roleText} ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nì ì‹œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
        
        // 3ì´ˆ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        setTimeout(() => {
          window.location.href = 'admin-login.html';
        }, 3000);
        
      } catch (error) {
        console.error('âŒ ê°€ì… ì‹ ì²­ ì‹¤íŒ¨:', error);
        
        let errorMsg = 'ê°€ì… ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        
        if (error.code === 'auth/email-already-in-use') {
          errorMsg = 'âš ï¸ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
        } else if (error.code === 'auth/invalid-email') {
          errorMsg = 'âš ï¸ ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
        } else if (error.code === 'auth/weak-password') {
          errorMsg = 'âš ï¸ ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. 6ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.';
        } else {
          errorMsg = 'âŒ ' + (error.message || 'ê°€ì… ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        showError(errorMsg);
        registerBtn.disabled = false;
        loading.classList.remove('show');
      }
    });
  </script>
</body>
</html>
