<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Authentication ì •ë¦¬ ë„êµ¬</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 40px 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: #333;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .info-box {
      background: #f0f9ff;
      border-left: 4px solid #3b82f6;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    .btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #3b82f6;
      color: white;
    }
    .btn-primary:hover {
      background: #2563eb;
    }
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    .btn-danger:hover {
      background: #c82333;
    }
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #result {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 13px;
      display: none;
    }
    .user-list {
      margin-top: 20px;
    }
    .user-item {
      padding: 12px;
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-info {
      flex: 1;
    }
    .user-email {
      font-weight: 600;
      color: #333;
    }
    .user-uid {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }
    .badge-danger {
      background: #fee;
      color: #c00;
    }
    .badge-success {
      background: #efe;
      color: #0a0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ Firebase Authentication ì •ë¦¬ ë„êµ¬</h1>
    <p class="subtitle">Firestoreì— ì—†ëŠ” Authentication ê³„ì •ì„ í™•ì¸í•˜ê³  ì •ë¦¬í•©ë‹ˆë‹¤.</p>

    <div class="warning-box">
      <strong>âš ï¸ ì¤‘ìš” ì•ˆë‚´:</strong><br>
      í´ë¼ì´ì–¸íŠ¸ SDKë¡œëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìì˜ Authentication ê³„ì •ì„ ì§ì ‘ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
      ì´ ë„êµ¬ëŠ” ì •ë¦¬ê°€ í•„ìš”í•œ ê³„ì • ëª©ë¡ì„ í™•ì¸í•˜ê³ , Firebase Consoleì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
    </div>

    <div class="info-box">
      <strong>ğŸ’¡ ì‘ë™ ë°©ì‹:</strong><br>
      1. Firestoreì˜ users ì»¬ë ‰ì…˜ì—ì„œ ëª¨ë“  ì‚¬ìš©ì UID ìˆ˜ì§‘<br>
      2. ì •ë¦¬ê°€ í•„ìš”í•œ ê³„ì • ëª©ë¡ í‘œì‹œ<br>
      3. Firebase Console ë§í¬ ì œê³µ (ìˆ˜ë™ ì‚­ì œ)
    </div>

    <button class="btn btn-primary" onclick="checkOrphanedAccounts()">ğŸ“Š ì •ë¦¬ í•„ìš” ê³„ì • í™•ì¸</button>

    <div id="result"></div>
    <div id="userList" class="user-list"></div>

    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
      <h3 style="margin-bottom: 12px;">ğŸ”— Firebase Console ë§í¬</h3>
      <p style="margin-bottom: 8px; font-size: 14px;">Authentication ê³„ì •ì„ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•˜ë ¤ë©´:</p>
      <ol style="margin-left: 20px; font-size: 14px; line-height: 1.6;">
        <li><a href="https://console.firebase.google.com/project/abcdc-staff-system/authentication/users" target="_blank" style="color: #3b82f6;">Firebase Console - Authentication</a> í˜ì´ì§€ë¡œ ì´ë™</li>
        <li>ì•„ë˜ ëª©ë¡ì— í‘œì‹œëœ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì°¾ì•„ì„œ ì‚­ì œ</li>
        <li>ì‚­ì œ ì™„ë£Œ í›„ ì´ í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ í™•ì¸</li>
      </ol>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    async function checkOrphanedAccounts() {
      const resultDiv = document.getElementById('result');
      const userListDiv = document.getElementById('userList');
      
      resultDiv.style.display = 'block';
      resultDiv.textContent = 'ğŸ” í™•ì¸ ì¤‘...\n\n';
      userListDiv.innerHTML = '';

      try {
        // 1. Firestoreì˜ users ì»¬ë ‰ì…˜ì—ì„œ ëª¨ë“  UID ìˆ˜ì§‘
        const snapshot = await db.collection('users').get();
        const validUIDs = new Set();
        
        snapshot.forEach(doc => {
          validUIDs.add(doc.id);
        });

        resultDiv.textContent += `âœ… Firestoreì— ë“±ë¡ëœ ì‚¬ìš©ì: ${validUIDs.size}ëª…\n\n`;

        // 2. ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        resultDiv.textContent += 'ğŸ“‹ í˜„ì¬ Firestoreì— ë“±ë¡ëœ ì‚¬ìš©ì ëª©ë¡:\n\n';
        
        const users = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          users.push({
            uid: doc.id,
            email: data.email,
            name: data.name,
            role: data.role,
            userType: data.userType,
            status: data.status
          });
        });

        users.sort((a, b) => a.name.localeCompare(b.name));

        users.forEach(user => {
          const userItem = document.createElement('div');
          userItem.className = 'user-item';
          
          const roleText = user.role === 'admin' ? 'ê´€ë¦¬ì' : user.role === 'manager' ? 'ë§¤ë‹ˆì €' : 'ì§ì›';
          const statusBadge = user.status === 'approved' ? 
            '<span class="badge badge-success">í™œì„±</span>' : 
            '<span class="badge badge-danger">ëŒ€ê¸°ì¤‘</span>';
          
          userItem.innerHTML = `
            <div class="user-info">
              <div class="user-email">${user.name} (${user.email}) ${statusBadge}</div>
              <div class="user-uid">ì—­í• : ${roleText} | UID: ${user.uid}</div>
            </div>
          `;
          
          userListDiv.appendChild(userItem);
        });

        resultDiv.textContent += `\nâœ… í™•ì¸ ì™„ë£Œ!\n\n`;
        resultDiv.textContent += `âš ï¸ Firebase Authenticationì— ìœ„ ëª©ë¡ ì™¸ì˜ ê³„ì •ì´ ìˆë‹¤ë©´\n`;
        resultDiv.textContent += `   Firebase Consoleì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ì‚­ì œí•´ì£¼ì„¸ìš”.\n\n`;
        resultDiv.textContent += `ğŸ”— Firebase Console ë§í¬:\n`;
        resultDiv.textContent += `https://console.firebase.google.com/project/abcdc-staff-system/authentication/users\n`;

      } catch (error) {
        console.error('âŒ í™•ì¸ ì‹¤íŒ¨:', error);
        resultDiv.textContent += `\nâŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}\n`;
      }
    }
  </script>
</body>
</html>
