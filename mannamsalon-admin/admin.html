<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì - ë§›ë‚¨ì‚´ë¡±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    /* ìƒë‹¨ ë°” */
    .top-bar {
      background: white;
      padding: 20px 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .top-bar h1 {
      font-size: 24px;
      color: #333;
      margin: 0;
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f5f5f5;
      border-radius: 20px;
    }

    .user-info span {
      font-weight: 600;
      color: #333;
    }

    .btn-logout {
      padding: 8px 16px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn-logout:hover {
      background: #c82333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* í†µê³„ ì¹´ë“œ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .stat-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: #333;
    }

    /* í™˜ì˜ ì¹´ë“œ */
    .welcome-card {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }

    .welcome-card h2 {
      font-size: 32px;
      color: #333;
      margin-bottom: 16px;
    }

    .welcome-card p {
      font-size: 16px;
      color: #666;
      margin-bottom: 32px;
    }

    /* ë¹ ë¥¸ ì‘ì—… ë²„íŠ¼ */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 32px;
    }

    .quick-action-btn {
      padding: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.2s ease;
      text-align: center;
    }

    .quick-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .quick-action-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    /* ë¡œë”© */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .loading-overlay.show {
      display: flex;
    }

    .loading-spinner {
      background: white;
      padding: 32px;
      border-radius: 8px;
      text-align: center;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .top-bar {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>ì¸ì¦ í™•ì¸ ì¤‘...</p>
    </div>
  </div>

  <!-- ìƒë‹¨ ë°” -->
  <div class="top-bar">
    <h1>ğŸª ë§›ë‚¨ì‚´ë¡± ê´€ë¦¬ì</h1>
    <div class="top-bar-right">
      <div class="user-info">
        <span>ğŸ‘¨â€ğŸ’¼</span>
        <span id="userName">ê´€ë¦¬ì</span>
      </div>
      <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <div class="container">
    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-label">ì´ ì§ì› ìˆ˜</div>
        <div class="stat-value" id="totalEmployees">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âœ…</div>
        <div class="stat-label">ê¸ˆì¼ ì¶œê·¼</div>
        <div class="stat-value" id="todayAttendance">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“„</div>
        <div class="stat-label">ëŒ€ê¸° ì¤‘ì¸ ê³„ì•½</div>
        <div class="stat-value" id="pendingContracts">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-label">ì´ë²ˆ ë‹¬ ê¸‰ì—¬</div>
        <div class="stat-value" id="monthlySalary">0ì›</div>
      </div>
    </div>

    <!-- í™˜ì˜ ë©”ì‹œì§€ -->
    <div class="welcome-card">
      <h2>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
      <p>ë§›ë‚¨ì‚´ë¡± ê·¼ë¬´ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
      
      <div class="quick-actions">
        <button class="quick-action-btn" onclick="navigateToContract()">
          <div class="quick-action-icon">ğŸ“</div>
          <div>ê³„ì•½ì„œ ì‘ì„±</div>
        </button>
        <button class="quick-action-btn" onclick="alert('ì§ì› ê´€ë¦¬ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.')">
          <div class="quick-action-icon">ğŸ‘¥</div>
          <div>ì§ì› ê´€ë¦¬</div>
        </button>
        <button class="quick-action-btn" onclick="alert('ê·¼íƒœ ê´€ë¦¬ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.')">
          <div class="quick-action-icon">ğŸ“Š</div>
          <div>ê·¼íƒœ ê´€ë¦¬</div>
        </button>
        <button class="quick-action-btn" onclick="alert('ê¸‰ì—¬ ê´€ë¦¬ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.')">
          <div class="quick-action-icon">ğŸ’°</div>
          <div>ê¸‰ì—¬ ê´€ë¦¬</div>
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    // Firebase ì´ˆê¸°í™”
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');

    const loadingOverlay = document.getElementById('loadingOverlay');

    // ë¡œë”© í‘œì‹œ
    loadingOverlay.classList.add('show');

    // ì¸ì¦ í™•ì¸
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
        console.log('âŒ ë¡œê·¸ì¸ í•„ìš”');
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = 'index.html';
        return;
      }

      try {
        console.log('ğŸ” ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ:', user.uid);

        // Firestoreì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (!userDoc.exists) {
          throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        const userData = userDoc.data();
        console.log('âœ… ì‚¬ìš©ì ì •ë³´:', userData);

        // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
        if (userData.userType !== 'admin') {
          throw new Error('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
        }

        if (userData.status !== 'active') {
          throw new Error('ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤.');
        }

        // ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ
        document.getElementById('userName').textContent = userData.name || 'ê´€ë¦¬ì';

        // ì„¸ì…˜ ì €ì¥
        sessionStorage.setItem('user', JSON.stringify({
          uid: user.uid,
          email: user.email,
          ...userData
        }));

        console.log('âœ… ê´€ë¦¬ì ì¸ì¦ ì™„ë£Œ');

        // í†µê³„ ë¡œë“œ
        loadStats();

        // ë¡œë”© ìˆ¨ê¹€
        loadingOverlay.classList.remove('show');

      } catch (error) {
        console.error('âŒ ì¸ì¦ ì˜¤ë¥˜:', error);
        alert(error.message);
        await auth.signOut();
        window.location.href = 'index.html';
      }
    });

    // í†µê³„ ë¡œë“œ (ì„ì‹œ)
    async function loadStats() {
      try {
        // TODO: ì‹¤ì œ ë°ì´í„°ë¡œ êµì²´
        document.getElementById('totalEmployees').textContent = '0';
        document.getElementById('todayAttendance').textContent = '0';
        document.getElementById('pendingContracts').textContent = '0';
        document.getElementById('monthlySalary').textContent = '0ì›';
      } catch (error) {
        console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ê³„ì•½ì„œ í˜ì´ì§€ë¡œ ì´ë™
    function navigateToContract() {
      // ì„ì‹œ: ì•Œë¦¼ìœ¼ë¡œ ì•ˆë‚´
      alert('ê³„ì•½ì„œ ì‘ì„± ê¸°ëŠ¥:\n\n1. contract.htmlì„ ë³„ë„ë¡œ ë°°í¬í•´ì£¼ì„¸ìš”\n2. ë°°í¬ëœ URLì„ ì•Œë ¤ì£¼ì‹œë©´ ì—°ê²°í•˜ê² ìŠµë‹ˆë‹¤\n\në˜ëŠ”\n\nindex.html (ë©”ì¸ ê´€ë¦¬ì í˜ì´ì§€)ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”');
      
      // ë°©ë²• 1: ìƒëŒ€ ê²½ë¡œ ì‹œë„
      // window.location.href = 'contract.html';
      
      // ë°©ë²• 2: ìƒˆ íƒ­ìœ¼ë¡œ ì—´ê¸°
      // window.open('contract.html', '_blank');
      
      // ë°©ë²• 3: index.htmlë¡œ ì´ë™ (ë§Œì•½ index.htmlì— ê³„ì•½ì„œ ê¸°ëŠ¥ì´ ìˆë‹¤ë©´)
      // window.location.href = 'index.html';
    }

    // ë¡œê·¸ì•„ì›ƒ
    async function logout() {
      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        try {
          await auth.signOut();
          sessionStorage.clear();
          console.log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
          window.location.href = 'index.html';
        } catch (error) {
          console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
          alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      }
    }
  </script>
</body>
</html>
