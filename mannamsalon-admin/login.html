<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§›ë‚¨ì‚´ë¡± ë¡œê·¸ì¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-box {
      background: white;
      border-radius: 16px;
      padding: 48px 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 420px;
      width: 100%;
    }

    .logo {
      text-align: center;
      font-size: 64px;
      margin-bottom: 16px;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      color: #333;
      margin-bottom: 8px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 32px;
      font-size: 14px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.2s;
    }

    input:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    button {
      width: 100%;
      padding: 14px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .error {
      background: #fee;
      border: 1px solid #fcc;
      color: #c00;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      display: none;
    }

    .error.show {
      display: block;
    }

    .success {
      background: #efe;
      border: 1px solid #cfc;
      color: #060;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
      display: none;
    }

    .success.show {
      display: block;
    }

    .loading {
      display: none;
      text-align: center;
      color: #666;
      margin-top: 16px;
    }

    .loading.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <div class="logo">â˜•</div>
    <h1>ë§›ë‚¨ì‚´ë¡±</h1>
    <p class="subtitle">ê·¼ë¬´ê´€ë¦¬ ì‹œìŠ¤í…œ</p>

    <div class="error" id="error"></div>
    <div class="success" id="success"></div>

    <form id="loginForm">
      <div class="input-group">
        <label for="email">ì´ë©”ì¼</label>
        <input 
          type="email" 
          id="email" 
          placeholder="example@email.com" 
          required
        >
      </div>

      <div class="input-group">
        <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
        <input 
          type="password" 
          id="password" 
          placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
          required
        >
      </div>

      <button type="submit" id="loginBtn">ë¡œê·¸ì¸</button>
    </form>

    <div class="loading" id="loading">ì²˜ë¦¬ ì¤‘...</div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    // Firebase ì´ˆê¸°í™”
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');

    // ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    const loginForm = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const successDiv = document.getElementById('success');

    // ì—ëŸ¬ í‘œì‹œ
    function showError(msg) {
      errorDiv.textContent = msg;
      errorDiv.classList.add('show');
      successDiv.classList.remove('show');
    }

    // ì„±ê³µ í‘œì‹œ
    function showSuccess(msg) {
      successDiv.textContent = msg;
      successDiv.classList.add('show');
      errorDiv.classList.remove('show');
    }

    // ì—ëŸ¬/ì„±ê³µ ìˆ¨ê¹€
    function hideMessages() {
      errorDiv.classList.remove('show');
      successDiv.classList.remove('show');
    }

    // ë¡œê·¸ì¸ í¼ ì œì¶œ
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      hideMessages();
      loginBtn.disabled = true;
      loading.classList.add('show');
      
      try {
        console.log('ğŸ” ë¡œê·¸ì¸ ì‹œë„:', email);
        
        // Firebase ë¡œê·¸ì¸
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        console.log('âœ… Auth ë¡œê·¸ì¸ ì„±ê³µ:', user.uid);
        
        // Firestoreì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (!userDoc.exists) {
          throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        const userData = userDoc.data();
        console.log('âœ… ì‚¬ìš©ì ì •ë³´:', userData);
        
        // ê³„ì • ìƒíƒœ í™•ì¸
        if (userData.status !== 'active') {
          throw new Error('ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤. ìƒíƒœ: ' + userData.status);
        }
        
        // ì„¸ì…˜ ì €ì¥
        sessionStorage.setItem('user', JSON.stringify({
          uid: user.uid,
          email: user.email,
          ...userData
        }));
        
        showSuccess('âœ… ë¡œê·¸ì¸ ì„±ê³µ! í˜ì´ì§€ ì´ë™ ì¤‘...');
        
        // í˜ì´ì§€ ì´ë™
        setTimeout(() => {
          if (userData.userType === 'admin') {
            // Gensparkì€ ì„œë¸Œí˜ì´ì§€ ì ‘ê·¼ ë¶ˆê°€í•˜ë¯€ë¡œ admin.htmlì„ index.htmlë¡œ êµì²´í•´ì•¼ í•¨
            alert('ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.\n\nâ€» Genspark í™˜ê²½ì—ì„œëŠ” admin.htmlì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ìŒ ë‹¨ê³„: admin.htmlì„ index.htmlë¡œ êµì²´ í›„ ì¬ë°°í¬');
            // window.location.href = 'admin.html'; // Gensparkì—ì„œ ì‘ë™ ì•ˆ í•¨
          } else {
            alert('ì§ì› í˜ì´ì§€ëŠ” ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
          }
          loginBtn.disabled = false;
          loading.classList.remove('show');
        }, 1000);
        
      } catch (error) {
        console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
        
        let errorMsg = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        
        if (error.code === 'auth/invalid-email') {
          errorMsg = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
        } else if (error.code === 'auth/user-not-found') {
          errorMsg = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
        } else if (error.code === 'auth/wrong-password') {
          errorMsg = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        } else if (error.code === 'auth/too-many-requests') {
          errorMsg = 'ë¡œê·¸ì¸ ì‹œë„ê°€ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
        } else {
          errorMsg = error.message;
        }
        
        showError(errorMsg);
        loginBtn.disabled = false;
        loading.classList.remove('show');
      }
    });

    // ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
    auth.onAuthStateChanged((user) => {
      if (user) {
        console.log('â„¹ï¸ ì´ë¯¸ ë¡œê·¸ì¸ë¨:', user.email);
        // ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•˜ì§€ ì•ŠìŒ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
      } else {
        console.log('â„¹ï¸ ë¡œê·¸ì•„ì›ƒ ìƒíƒœ');
      }
    });
  </script>
</body>
</html>
