<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§›ë‚¨ì‚´ë¡± ê´€ë¦¬ì í˜ì´ì§€</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #8b7355; --primary-dark: #6b5d4f; --bg-light: #f5f1e8; --bg-white: #fdfcfa;
      --text-primary: #6b5d4f; --text-secondary: #9b8a76; --border-color: #e8dfd0; --border-radius: 8px;
      --shadow-sm: 0 2px 8px rgba(107, 93, 79, 0.08); --shadow-lg: 0 8px 24px rgba(107, 93, 79, 0.15);
      --spacing-xs: 6px; --spacing-sm: 12px; --spacing-md: 16px; --spacing-lg: 24px; --spacing-xl: 32px;
      --success-color: #7a9b7a; --warning-color: #d4a574; --danger-color: #c67b7b;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: var(--bg-light); color: var(--text-primary); }
    .hidden { display: none !important; }
    #loginScreen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-box { background: var(--bg-white); border-radius: 12px; padding: 48px 40px; box-shadow: var(--shadow-lg); max-width: 420px; width: 100%; border: 1px solid var(--border-color); text-align: center; }
    .login-logo { font-size: 64px; margin-bottom: 16px; }
    .login-box h1 { font-size: 28px; color: var(--text-primary); margin-bottom: 8px; }
    .login-subtitle { color: var(--text-secondary); margin-bottom: 32px; font-size: 14px; }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px; }
    .form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 15px; }
    .btn { padding: 12px 24px; border-radius: var(--border-radius); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border: none; }
    .btn-primary { background: var(--primary-color); color: var(--bg-white); }
    .btn-primary:hover { background: var(--primary-dark); box-shadow: var(--shadow-sm); }
    .btn-secondary { background: var(--bg-light); color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-sm { padding: 8px 16px; font-size: 12px; }
    .btn-danger { background: var(--danger-color); color: var(--bg-white); }
    .btn-success { background: var(--success-color); color: var(--bg-white); }
    .container { max-width: 1200px; margin: 0 auto; padding: var(--spacing-lg); }
    .top-bar { background: var(--bg-white); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl); }
    .admin-badge { background: var(--primary-color); color: var(--bg-white); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); }
    .dashboard-card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .dashboard-card-icon { font-size: 36px; margin-bottom: var(--spacing-sm); }
    .dashboard-card-label { color: var(--text-secondary); font-size: 13px; margin-bottom: var(--spacing-xs); }
    .dashboard-card-value { font-size: 32px; font-weight: 700; color: var(--text-primary); }
    .dashboard-card-sub { font-size: 13px; color: var(--text-secondary); margin-top: var(--spacing-xs); }
    .tabs { display: flex; gap: var(--spacing-xs); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--border-color); overflow-x: auto; flex-wrap: wrap; }
    .tab { padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; color: var(--text-secondary); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent; white-space: nowrap; }
    .tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .card-header { padding: var(--spacing-lg); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0; }
    .card-body { padding: var(--spacing-lg); }
    table { width: 100%; border-collapse: collapse; }
    table th { background: var(--bg-light); padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--border-color); font-size: 13px; }
    table td { padding: 12px; border-bottom: 1px solid var(--border-color); font-size: 14px; color: var(--text-primary); }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; }
    .badge-success { background: #e6f2e6; color: #4a6b4a; }
    .badge-warning { background: #f5ead9; color: #8b6846; }
    .badge-danger { background: #f5e3e3; color: #8b5555; }
    .badge-info { background: #e3ebf2; color: #5a708a; }
    .badge-primary { background: #e3ebf2; color: #5a708a; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
    .modal-content { background: var(--bg-white); border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); }
    .modal-header { padding: 25px 30px; border-bottom: 2px solid var(--bg-light); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 30px; }
    .modal-footer { padding: 20px 30px; border-top: 2px solid var(--bg-light); text-align: right; display: flex; gap: 8px; justify-content: flex-end; }
    .modal-close { background: none; border: none; font-size: 28px; color: var(--text-secondary); cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
    .modal-close:hover { background: var(--bg-light); color: var(--text-primary); }
    .filters { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); flex-wrap: wrap; }
    .filter-group { flex: 1; min-width: 200px; }
    .filter-group label { display: block; margin-bottom: var(--spacing-xs); font-weight: 600; color: var(--text-primary); font-size: 13px; }
    .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; }
  </style>
</head>
<body>
  <div id="loginScreen">
    <div class="login-box">
      <div class="login-logo">â˜•</div>
      <h1>ë§›ë‚¨ì‚´ë¡±</h1>
      <p class="login-subtitle">ê´€ë¦¬ì ë¡œê·¸ì¸</p>
      <div class="form-group">
        <label for="adminEmail">ì´ë©”ì¼</label>
        <input type="email" id="adminEmail" placeholder="ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key==='Enter') document.getElementById('adminPassword').focus()">
      </div>
      <div class="form-group">
        <label for="adminPassword">ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key==='Enter') handleAdminLogin()">
      </div>
      <button class="btn btn-primary" style="width: 100%;" onclick="handleAdminLogin()">ë¡œê·¸ì¸</button>
      <p id="loginError" style="color: #c67b7b; font-size: 13px; margin-top: 12px; display: none;"></p>
    </div>
  </div>

  <div id="mainScreen" class="hidden">
    <div class="top-bar">
      <h1 style="font-size: 20px; font-weight: 700; margin: 0;">ğŸª ë§›ë‚¨ì‚´ë¡± ê·¼ë¬´ê´€ë¦¬</h1>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span class="admin-badge">ê´€ë¦¬ì</span>
        <button class="btn btn-secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div class="container">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <div class="dashboard-card-icon">ğŸ‘¥</div>
          <div class="dashboard-card-label">ì´ ì§ì› ìˆ˜</div>
          <div class="dashboard-card-value" id="totalEmployees">0</div>
          <div class="dashboard-card-sub">ëª…</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">âœ…</div>
          <div class="dashboard-card-label">ì˜¤ëŠ˜ ì¶œê·¼</div>
          <div class="dashboard-card-value" id="todayAttendance">0</div>
          <div class="dashboard-card-sub">ëª…</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">â°</div>
          <div class="dashboard-card-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
          <div class="dashboard-card-value" id="pendingApprovals">0</div>
          <div class="dashboard-card-sub">ê±´</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">ğŸ“„</div>
          <div class="dashboard-card-label">ë¯¸ì„œëª… ê³„ì•½ì„œ</div>
          <div class="dashboard-card-value" id="unsignedContracts">0</div>
          <div class="dashboard-card-sub">ê±´</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab" data-tab="employees" onclick="switchTab('employees')">ğŸ‘¥ ì§ì› ê´€ë¦¬</button>
        <button class="tab" data-tab="attendance" onclick="switchTab('attendance')">ğŸ“‹ ê·¼íƒœ ê´€ë¦¬</button>
        <button class="tab" data-tab="salary" onclick="switchTab('salary')">ğŸ’° ê¸‰ì—¬ ê´€ë¦¬</button>
        <button class="tab" data-tab="approvals" onclick="switchTab('approvals')">âœ”ï¸ ìŠ¹ì¸ ê´€ë¦¬</button>
        <button class="tab" data-tab="contracts" onclick="switchTab('contracts')">ğŸ“ ê³„ì•½ì„œ ê´€ë¦¬</button>
        <button class="tab" data-tab="notice" onclick="switchTab('notice')">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
      </div>

      <div id="tabDashboard" class="tab-content active">
        <div class="card">
          <div class="card-header"><h3>ğŸ“Š í˜„í™© ìš”ì•½</h3></div>
          <div class="card-body"><p style="color: var(--text-secondary);">ê´€ë¦¬ì í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</p></div>
        </div>
      </div>

      <div id="tabEmployees" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ‘¥ ì§ì› ëª©ë¡</h3>
            <button class="btn btn-primary" onclick="window.location.href='contract.html'">+ ì§ì› ì¶”ê°€</button>
          </div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ë§¤ì¥</label>
                <select id="employeeStoreFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ë¶€ì²œì‹œì²­ì ">ë¶€ì²œì‹œì²­ì </option>
                  <option value="ìƒë™ì ">ìƒë™ì </option>
                  <option value="ë¶€ì²œì—­ì‚¬ì ">ë¶€ì²œì—­ì‚¬ì </option>
                </select>
              </div>
              <div class="filter-group">
                <label>ìƒíƒœ</label>
                <select id="employeeStatusFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ì¬ì§">ì¬ì§</option>
                  <option value="í‡´ì‚¬">í‡´ì‚¬</option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadEmployees()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ì§ê¸‰</th>
                  <th>ì‹œê¸‰</th>
                  <th>ì…ì‚¬ì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="employeeTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabAttendance" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ“‹ ê·¼íƒœ ê¸°ë¡</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ì¡°íšŒ ì›”</label>
                <input type="month" id="attendanceMonth">
              </div>
              <div class="filter-group">
                <label>ë§¤ì¥</label>
                <select id="attendanceStoreFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ë¶€ì²œì‹œì²­ì ">ë¶€ì²œì‹œì²­ì </option>
                  <option value="ìƒë™ì ">ìƒë™ì </option>
                  <option value="ë¶€ì²œì—­ì‚¬ì ">ë¶€ì²œì—­ì‚¬ì </option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadAttendanceList()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ë‚ ì§œ</th>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ì¶œê·¼</th>
                  <th>í‡´ê·¼</th>
                  <th>ê·¼ë¬´ì‹œê°„</th>
                  <th>ìƒíƒœ</th>
                </tr>
              </thead>
              <tbody id="attendanceTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; color: var(--text-secondary);">ê·¼íƒœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabSalary" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ’° ê¸‰ì—¬ ë‚´ì—­</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ì¡°íšŒ ì›”</label>
                <input type="month" id="salaryMonth">
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadSalaryList()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ê¸°ë³¸ê¸‰</th>
                  <th>ì¶”ê°€ìˆ˜ë‹¹</th>
                  <th>ê³µì œ</th>
                  <th>ì‹¤ì§€ê¸‰ì•¡</th>
                </tr>
              </thead>
              <tbody id="salaryTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ê¸‰ì—¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabApprovals" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>âœ”ï¸ ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡</h3></div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ìœ í˜•</th>
                  <th>ì‹ ì²­ì</th>
                  <th>ë‚ ì§œ</th>
                  <th>ë‚´ìš©</th>
                  <th>ìƒíƒœ</th>
                  <th>ì²˜ë¦¬</th>
                </tr>
              </thead>
              <tbody id="approvalsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ìŠ¹ì¸ ëŒ€ê¸° ê±´ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabContracts" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ“ ê³„ì•½ì„œ ëª©ë¡</h3>
            <button class="btn btn-primary" onclick="openContractPage()">+ ìƒˆ ê³„ì•½ì„œ ì‘ì„±</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ì§ì›ëª…</th>
                  <th>ê³„ì•½ ìœ í˜•</th>
                  <th>ê³„ì•½ ê¸°ê°„</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="contractsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ê³„ì•½ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabNotice" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h3></div>
          <div class="card-body">
            <p style="color: var(--text-secondary);">ê³µì§€ì‚¬í•­ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isAuthenticated = false;
    let currentTab = 'dashboard';

    const DUMMY_EMPLOYEES = [
      { id: 1, name: 'ê¹€ë¯¼ìˆ˜', store: 'ë¶€ì²œì‹œì²­ì ', position: 'ë§¤ë‹ˆì €', hourlyWage: '15,000ì›', startDate: '2023-01-15', status: 'ì¬ì§' },
      { id: 2, name: 'ì´ì§€ì€', store: 'ìƒë™ì ', position: 'ë°”ë¦¬ìŠ¤íƒ€', hourlyWage: '10,500ì›', startDate: '2023-03-20', status: 'ì¬ì§' },
      { id: 3, name: 'ë°•ì„œì¤€', store: 'ë¶€ì²œì—­ì‚¬ì ', position: 'ë°”ë¦¬ìŠ¤íƒ€', hourlyWage: '10,000ì›', startDate: '2023-05-10', status: 'ì¬ì§' },
    ];

    const DUMMY_ATTENDANCE = [
      { id: 1, date: '2025-01-28', name: 'ê¹€ë¯¼ìˆ˜', store: 'ë¶€ì²œì‹œì²­ì ', clockIn: '09:00', clockOut: '18:00', workTime: '8ì‹œê°„', status: 'ì •ìƒ' },
      { id: 2, date: '2025-01-28', name: 'ì´ì§€ì€', store: 'ìƒë™ì ', clockIn: '09:05', clockOut: '18:00', workTime: '7ì‹œê°„ 55ë¶„', status: 'ì§€ê°' },
    ];

    const DUMMY_SALARIES = [
      { id: 1, name: 'ê¹€ë¯¼ìˆ˜', store: 'ë¶€ì²œì‹œì²­ì ', basicPay: 3000000, overtimePay: 200000, deductions: 300000, totalPay: 2900000 },
      { id: 2, name: 'ì´ì§€ì€', store: 'ìƒë™ì ', basicPay: 1800000, overtimePay: 150000, deductions: 195000, totalPay: 1755000 },
    ];

    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      const monthFilters = ['attendanceMonth', 'salaryMonth'];
      monthFilters.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.value = currentMonth;
      });
      checkAuthStatus();
    });

    function checkAuthStatus() {
      const savedAuth = sessionStorage.getItem('admin_authenticated');
      if (savedAuth === 'true') {
        isAuthenticated = true;
        showMainScreen();
      } else {
        showLoginScreen();
      }
    }

    async function handleAdminLogin() {
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value;
      const errorEl = document.getElementById('loginError');
      
      if (!email) {
        errorEl.textContent = 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        errorEl.style.display = 'block';
        return;
      }
      if (!password) {
        errorEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        errorEl.style.display = 'block';
        return;
      }

      try {
        errorEl.style.display = 'none';
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (userDoc.exists) {
          const userData = userDoc.data();
          if (userData.role === 'admin' || userData.role === 'manager') {
            isAuthenticated = true;
            sessionStorage.setItem('admin_authenticated', 'true');
            showMainScreen();
          } else {
            errorEl.textContent = 'ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
            errorEl.style.display = 'block';
            await auth.signOut();
          }
        } else {
          errorEl.textContent = 'ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          errorEl.style.display = 'block';
          await auth.signOut();
        }
      } catch (error) {
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        if (error.code === 'auth/user-not-found') errorEl.textContent = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
        else if (error.code === 'auth/wrong-password') errorEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        else if (error.code === 'auth/invalid-email') errorEl.textContent = 'ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
        else errorEl.textContent = 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        errorEl.style.display = 'block';
        document.getElementById('adminPassword').value = '';
      }
    }

    async function logout() {
      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        try {
          await auth.signOut();
          isAuthenticated = false;
          sessionStorage.removeItem('admin_authenticated');
          showLoginScreen();
        } catch (error) {
          console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
        }
      }
    }

    function showLoginScreen() {
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('mainScreen').classList.add('hidden');
    }

    function showMainScreen() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainScreen').classList.remove('hidden');
      loadDashboard();
      switchTab('employees');
    }

    function switchTab(tabName) {
      currentTab = tabName;
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
      if (selectedTab) selectedTab.classList.add('active');
      const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
      const tabId = `tab${capitalize(tabName)}`;
      const selectedContent = document.getElementById(tabId);
      if (selectedContent) {
        selectedContent.classList.add('active');
        selectedContent.style.display = 'block';
      }
      switch(tabName) {
        case 'dashboard': loadDashboard(); break;
        case 'employees': loadEmployees(); break;
        case 'attendance': loadAttendanceList(); break;
        case 'salary': loadSalaryList(); break;
        case 'approvals': loadApprovals(); break;
        case 'contracts': loadContracts(); break;
        case 'notice': loadNotice(); break;
      }
    }

    function loadDashboard() {
      let totalContracts = 0;
      let unsignedContracts = 0;
      const employeeMap = new Map();
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            
            const empKey = contractData.employeeName + '_' + contractData.employeeBirth;
            if (!employeeMap.has(empKey)) {
              employeeMap.set(empKey, true);
              totalContracts++;
            }
            
            if (!isSigned) unsignedContracts++;
          } catch(e) {}
        }
      }
      
      document.getElementById('totalEmployees').textContent = totalContracts;
      document.getElementById('todayAttendance').textContent = '0';
      document.getElementById('pendingApprovals').textContent = '0';
      document.getElementById('unsignedContracts').textContent = unsignedContracts;
    }

    function updateDashboardCard(id, value, subtitle) {
      const valueElement = document.getElementById(id);
      if (valueElement) {
        valueElement.textContent = value;
        if (subtitle) {
          const subElement = valueElement.nextElementSibling;
          if (subElement) subElement.textContent = subtitle;
        }
      }
    }

    function loadEmployees() {
      const tbody = document.getElementById('employeeTableBody');
      if (!tbody) return;
      
      const employeeMap = new Map();
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            const empKey = contractData.employeeName + '_' + contractData.employeeBirth;
            if (!employeeMap.has(empKey)) {
              employeeMap.set(empKey, {
                name: contractData.employeeName,
                store: contractData.workStore,
                position: contractData.position,
                wage: `${contractData.wageType} ${contractData.wageAmount}ì›`,
                startDate: contractData.startDate,
                status: isSigned ? 'ê·¼ë¬´ì¤‘' : 'ì„œëª…ëŒ€ê¸°',
                contractId: contractId,
                phone: contractData.employeePhone
              });
            }
          } catch (e) {}
        }
      }
      
      const employees = Array.from(employeeMap.values());
      if (employees.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
              <p style="margin-bottom: 16px;">ê³„ì•½ì„œê°€ ì‘ì„±ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
              <button class="btn btn-primary" onclick="openContractPage()">+ ì²« ê³„ì•½ì„œ ì‘ì„±í•˜ê¸°</button>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = employees.map(emp => `
        <tr>
          <td>${emp.name}</td>
          <td>${emp.store}</td>
          <td>${emp.position}</td>
          <td>${emp.wage}</td>
          <td>${emp.startDate}</td>
          <td><span class="badge ${emp.status === 'ê·¼ë¬´ì¤‘' ? 'badge-success' : 'badge-warning'}">${emp.status}</span></td>
          <td>
            <button class="btn btn-sm btn-secondary" onclick="showEmployeeContractList('${emp.name}')">ğŸ“„ ê³„ì•½ì„œ</button>
          </td>
        </tr>
      `).join('');
    }

    function showEmployeeContractList(employeeName) {
      const contracts = [];
      let employeeId = null;
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          const contractData = JSON.parse(localStorage.getItem(key));
          if (contractData.employeeName === employeeName) {
            const contractId = key.replace('contract_', '');
            if (!employeeId) employeeId = getEmployeeIdFromContract(contractData);
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            contracts.push({
              id: contractId,
              data: contractData,
              isSigned: isSigned,
              createdAt: contractData.createdAt || null
            });
          }
        }
      }
      
      if (contracts.length === 0) {
        alert('âš ï¸ í•´ë‹¹ ì§ì›ì˜ ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      contracts.sort((a, b) => {
        const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
        const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
        return dateB - dateA;
      });
      
      const docKey = `employee_docs_${employeeName}_${employeeId}`;
      const employeeDocs = JSON.parse(localStorage.getItem(docKey) || '{}');
      
      let bankAccountHtml = '';
      if (employeeDocs.bankAccount) {
        const ba = employeeDocs.bankAccount;
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #f0f9ff; border-radius: var(--border-radius); border-left: 4px solid #3b82f6;">
            <h4 style="margin-bottom: var(--spacing-sm);">ğŸ¦ í†µì¥ì‚¬ë³¸</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md);">
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ì€í–‰ëª…</p>
                <p style="font-weight: 600; margin: 0;">${ba.bankName || '-'}</p>
              </div>
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ê³„ì¢Œë²ˆí˜¸</p>
                <p style="font-weight: 600; margin: 0;">${ba.accountNumber || '-'}</p>
              </div>
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ì˜ˆê¸ˆì£¼</p>
                <p style="font-weight: 600; margin: 0;">${ba.accountHolder || '-'}</p>
              </div>
            </div>
            <p style="font-size: 11px; color: var(--text-secondary); margin: 8px 0 0 0;">
              ìµœì¢… ì—…ë°ì´íŠ¸: ${ba.updatedAt ? new Date(ba.updatedAt).toLocaleString('ko-KR') : '-'}
            </p>
          </div>
        `;
      } else {
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border-radius: var(--border-radius); border-left: 4px solid #ffc107;">
            <p style="margin: 0; font-size: 14px;">ğŸ¦ <strong>í†µì¥ì‚¬ë³¸</strong> - ì§ì›ì´ ì•„ì§ ë“±ë¡í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
      }
      
      let healthCertHtml = '';
      if (employeeDocs.healthCert) {
        const hc = employeeDocs.healthCert;
        const expiryDate = hc.expiryDate ? new Date(hc.expiryDate) : null;
        const isExpired = expiryDate && expiryDate < new Date();
        const expiryBadge = isExpired ? 
          '<span class="badge badge-danger" style="margin-left: 8px;">âš ï¸ ë§Œë£Œë¨</span>' : 
          '<span class="badge badge-success" style="margin-left: 8px;">âœ… ìœ íš¨</span>';
        
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: ${isExpired ? '#fee2e2' : '#f0fdf4'}; border-radius: var(--border-radius); border-left: 4px solid ${isExpired ? '#ef4444' : '#22c55e'};">
            <h4 style="margin-bottom: var(--spacing-sm);">ğŸ©º ë³´ê±´ì¦ ${expiryBadge}</h4>
            ${hc.imageData ? `
              <div style="margin-bottom: var(--spacing-md); text-align: center;">
                <img src="${hc.imageData}" 
                     style="max-width: 100%; max-height: 200px; border: 2px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" 
                     onclick="window.open('${hc.imageData}', '_blank')"
                     title="í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤">
                <p style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">ğŸ’¡ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
              </div>
            ` : '<p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">ì—…ë¡œë“œëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
            <div>
              <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ìœ íš¨ê¸°ê°„</p>
              <p style="font-weight: 600; margin: 0; font-size: 16px; color: ${isExpired ? '#ef4444' : '#22c55e'};">${hc.expiryDate || '-'}</p>
            </div>
            <p style="font-size: 11px; color: var(--text-secondary); margin: 8px 0 0 0;">
              ìµœì¢… ì—…ë°ì´íŠ¸: ${hc.updatedAt ? new Date(hc.updatedAt).toLocaleString('ko-KR') : '-'}
            </p>
          </div>
        `;
      } else {
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border-radius: var(--border-radius); border-left: 4px solid #ffc107;">
            <p style="margin: 0; font-size: 14px;">ğŸ©º <strong>ë³´ê±´ì¦</strong> - ì§ì›ì´ ì•„ì§ ë“±ë¡í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
      }
      
      const contractRows = contracts.map((contract, index) => {
        const createdDate = contract.createdAt ? new Date(contract.createdAt).toLocaleDateString('ko-KR') : '-';
        const statusBadge = contract.isSigned ? 
          '<span class="badge badge-success">âœ… ì„œëª…ì™„ë£Œ</span>' : 
          '<span class="badge badge-warning">â° ì„œëª…ëŒ€ê¸°</span>';
        const isLatest = index === 0 ? '<span class="badge badge-primary" style="margin-left: 8px;">ìµœì‹ </span>' : '';
        
        return `
          <tr>
            <td>${contracts.length - index}</td>
            <td>${contract.data.contractType || 'ê·¼ë¡œê³„ì•½ì„œ'}${isLatest}</td>
            <td>${contract.data.startDate} ~ ${contract.data.endDate}</td>
            <td>${createdDate}</td>
            <td>${statusBadge}</td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="viewContract('${contract.id}')">ğŸ“„ ë³´ê¸°</button>
              <button class="btn btn-sm btn-primary" onclick="sendContractLink('${contract.id}')">ğŸ“§ ì „ì†¡</button>
            </td>
          </tr>
        `;
      }).join('');
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.display = 'flex';
      modal.id = 'employeeContractListModal';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>ğŸ“‹ ${employeeName}ë‹˜ì˜ ì •ë³´</h3>
            <button class="modal-close" onclick="closeEmployeeContractListModal()">âœ•</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: var(--spacing-xl);">
              <h4 style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color);">
                ğŸ“„ ì œì¶œ ì„œë¥˜
              </h4>
              ${bankAccountHtml}
              ${healthCertHtml}
            </div>
            <div>
              <h4 style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color);">
                ğŸ“‹ ê³„ì•½ì„œ ëª©ë¡
              </h4>
              <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
                <p style="margin: 0; font-size: 14px; color: var(--text-secondary);">
                  ğŸ’¡ ì´ <strong>${contracts.length}ê°œ</strong>ì˜ ê³„ì•½ì„œê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
                </p>
              </div>
              <table>
                <thead>
                  <tr>
                    <th style="width: 60px;">ë²ˆí˜¸</th>
                    <th>ê³„ì•½ìœ í˜•</th>
                    <th>ê³„ì•½ê¸°ê°„</th>
                    <th>ì‘ì„±ì¼</th>
                    <th style="width: 120px;">ìƒíƒœ</th>
                    <th style="width: 180px;">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody>
                  ${contractRows}
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeEmployeeContractListModal()">ë‹«ê¸°</button>
            <button class="btn btn-danger" onclick="resignEmployee('${employeeName}', ${employeeId})">ğŸšª í‡´ì‚¬ ì²˜ë¦¬</button>
            <button class="btn btn-primary" onclick="openContractPage()">â• ìƒˆ ê³„ì•½ì„œ ì‘ì„±</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function closeEmployeeContractListModal() {
      const modal = document.getElementById('employeeContractListModal');
      if (modal) modal.remove();
    }

    function resignEmployee(employeeName, employeeId) {
      const confirmMsg = `âš ï¸ ${employeeName}ë‹˜ì„ í‡´ì‚¬ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në‹¤ìŒ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤:\nâ€¢ í†µì¥ì‚¬ë³¸\nâ€¢ ë³´ê±´ì¦\nâ€¢ ì§ì› ì„œë¥˜ ì „ì²´\n\nâ€» ê³„ì•½ì„œì™€ ê·¼íƒœ ê¸°ë¡ì€ ë³´ì¡´ë©ë‹ˆë‹¤.`;
      if (!confirm(confirmMsg)) return;
      
      try {
        const docKey = `employee_docs_${employeeName}_${employeeId}`;
        localStorage.removeItem(docKey);
        alert(`âœ… ${employeeName}ë‹˜ì´ í‡´ì‚¬ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        closeEmployeeContractListModal();
        loadEmployees();
      } catch (error) {
        alert('âŒ í‡´ì‚¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function getEmployeeIdFromContract(contract) {
      const employeeMap = {
        'ê¹€ë¯¼ìˆ˜': 1, 'ì´ì§€ì€': 2, 'ë°•ì„œì¤€': 3, 'ìµœì˜í¬': 4, 'ì •ìˆ˜ë¯¼': 5, 'ê°•í˜¸ë™': 6
      };
      return employeeMap[contract.employeeName] || 0;
    }

    function viewContract(id) {
      const contractData = localStorage.getItem(`contract_${id}`);
      if (!contractData) {
        alert('âš ï¸ ê³„ì•½ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      try {
        const contract = JSON.parse(contractData);
        showContractViewModal(contract);
      } catch (e) {
        alert('âš ï¸ ê³„ì•½ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    function showContractViewModal(contract) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.display = 'flex';
      modal.id = 'contractViewModal';
      
      const signLink = `${window.location.href.split('?')[0].replace('index.html', '')}contract-sign.html?id=${contract.id}`;
      const docKey = `employee_docs_${contract.employeeName}_${getEmployeeIdFromContract(contract)}`;
      const employeeDocs = JSON.parse(localStorage.getItem(docKey) || '{}');
      
      let bankAccountHtml = '';
      if (employeeDocs.bankAccount) {
        const ba = employeeDocs.bankAccount;
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
            <h4 style="margin-bottom: var(--spacing-sm);">ğŸ¦ í†µì¥ì‚¬ë³¸</h4>
            <p><strong>ì€í–‰ëª…:</strong> ${ba.bankName || '-'}</p>
            <p><strong>ê³„ì¢Œë²ˆí˜¸:</strong> ${ba.accountNumber || '-'}</p>
            <p><strong>ì˜ˆê¸ˆì£¼:</strong> ${ba.accountHolder || '-'}</p>
          </div>
        `;
      }
      
      let healthCertHtml = '';
      if (employeeDocs.healthCert) {
        const hc = employeeDocs.healthCert;
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
            <h4 style="margin-bottom: var(--spacing-sm);">ğŸ©º ë³´ê±´ì¦</h4>
            ${hc.imageData ? `
              <div style="margin-bottom: var(--spacing-md);">
                <img src="${hc.imageData}" style="max-width: 100%; max-height: 300px; border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer;" onclick="window.open('${hc.imageData}', '_blank')">
              </div>
            ` : ''}
            <p><strong>ìœ íš¨ê¸°ê°„:</strong> ${hc.expiryDate || '-'}</p>
          </div>
        `;
      }
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>ğŸ“„ ê³„ì•½ì„œ ìƒì„¸ë³´ê¸°</h3>
            <button class="modal-close" onclick="closeContractViewModal()">âœ•</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>ğŸ‘¤ ê·¼ë¡œì ì •ë³´</h4>
              <p><strong>ì´ë¦„:</strong> ${contract.employeeName}</p>
              <p><strong>ìƒë…„ì›”ì¼:</strong> ${contract.employeeBirth}</p>
              <p><strong>ì£¼ì†Œ:</strong> ${contract.employeeAddress}</p>
              <p><strong>ì—°ë½ì²˜:</strong> ${contract.employeePhone}</p>
            </div>
            ${bankAccountHtml}
            ${healthCertHtml}
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>ğŸ¢ íšŒì‚¬ ì •ë³´</h4>
              <p><strong>íšŒì‚¬ëª…:</strong> ${contract.companyName}</p>
              <p><strong>ê·¼ë¬´ë§¤ì¥:</strong> ${contract.workStore}</p>
              <p><strong>ì§ì±…:</strong> ${contract.position}</p>
            </div>
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>ğŸ“‹ ê³„ì•½ ì •ë³´</h4>
              <p><strong>ê³„ì•½ê¸°ê°„:</strong> ${contract.startDate} ~ ${contract.endDate}</p>
              <p><strong>ê·¼ë¬´ì¼:</strong> ${contract.workDays}</p>
              <p><strong>ê·¼ë¬´ì‹œê°„:</strong> ${contract.workTime}</p>
              <p><strong>${contract.wageType}:</strong> ${contract.wageAmount}ì›</p>
            </div>
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>ğŸ”— ì„œëª… ë§í¬</h4>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="text" value="${signLink}" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 13px;">
                <button class="btn btn-primary btn-sm" onclick="copySignLink('${signLink}')">ğŸ“‹ ë³µì‚¬</button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeContractViewModal()">ë‹«ê¸°</button>
            <button class="btn btn-primary" onclick="sendContractLink('${contract.id}')">ğŸ“§ ë§í¬ ì „ì†¡</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function closeContractViewModal() {
      const modal = document.getElementById('contractViewModal');
      if (modal) modal.remove();
    }

    function copySignLink(link) {
      const tempInput = document.createElement('input');
      tempInput.value = link;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      alert('âœ… ì„œëª… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function sendContractLink(id) {
      const contractData = localStorage.getItem(`contract_${id}`);
      if (!contractData) {
        alert('âš ï¸ ê³„ì•½ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      try {
        const contract = JSON.parse(contractData);
        const signLink = `${window.location.href.split('?')[0].replace('index.html', '')}contract-sign.html?id=${id}`;
        
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.style.display = 'flex';
        modal.id = 'sendLinkModal';
        
        modal.innerHTML = `
          <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
              <h3>ğŸ“§ ì„œëª… ë§í¬ ì „ì†¡</h3>
              <button class="modal-close" onclick="closeSendLinkModal()">âœ•</button>
            </div>
            <div class="modal-body">
              <p style="margin-bottom: 16px;"><strong>${contract.employeeName}</strong>ë‹˜ê»˜ ì„œëª… ë§í¬ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.</p>
              <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">ğŸ“± ì—°ë½ì²˜</label>
                <input type="tel" value="${contract.employeePhone}" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-light);">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">ğŸ”— ì„œëª… ë§í¬</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="linkToCopy" value="${signLink}" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 13px;">
                  <button class="btn btn-primary btn-sm" onclick="copyLinkToSend()">ğŸ“‹ ë³µì‚¬</button>
                </div>
              </div>
              <div style="padding: 16px; background: #fff3cd; border-radius: 4px; border: 1px solid #ffc107;">
                <p style="margin: 0; font-size: 14px;">ğŸ’¡ <strong>ë§í¬ ë³µì‚¬ í›„</strong> ì¹´ì¹´ì˜¤í†¡, ë¬¸ì ë“±ìœ¼ë¡œ ì§ì›ì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”.</p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" onclick="closeSendLinkModal()">ë‹«ê¸°</button>
              <button class="btn btn-primary" onclick="copyAndClose()">ğŸ“‹ ë³µì‚¬í•˜ê³  ë‹«ê¸°</button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
      } catch (e) {
        alert('âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function closeSendLinkModal() {
      const modal = document.getElementById('sendLinkModal');
      if (modal) modal.remove();
    }

    function copyLinkToSend() {
      const input = document.getElementById('linkToCopy');
      input.select();
      document.execCommand('copy');
      alert('âœ… ì„œëª… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function copyAndClose() {
      copyLinkToSend();
      setTimeout(() => closeSendLinkModal(), 500);
    }

    function loadAttendanceList() {
      const tbody = document.getElementById('attendanceTableBody');
      if (!tbody) return;
      tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">ê·¼íƒœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    }

    function loadSalaryList() {
      const tbody = document.getElementById('salaryTableBody');
      if (!tbody) return;
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">ê¸‰ì—¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    }

    function loadApprovals() {
      const tbody = document.getElementById('approvalsTableBody');
      if (!tbody) return;
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">ìŠ¹ì¸ ëŒ€ê¸° ê±´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    }

    function loadContracts() {
      const tbody = document.getElementById('contractsTableBody');
      if (!tbody) return;
      
      const allContracts = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            
            allContracts.push({
              id: contractId,
              name: contractData.employeeName,
              type: contractData.contractType,
              period: `${contractData.startDate} ~ ${contractData.endDate}`,
              createdAt: new Date(contractData.createdAt).toLocaleDateString('ko-KR'),
              status: isSigned ? 'ì„œëª…ì™„ë£Œ' : 'ì„œëª…ëŒ€ê¸°',
              data: contractData
            });
          } catch (e) {}
        }
      }
      
      if (allContracts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);"><p style="margin-bottom: 16px;">ìƒì„±ëœ ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p><button class="btn btn-primary" onclick="openContractPage()">+ ì²« ê³„ì•½ì„œ ì‘ì„±í•˜ê¸°</button></td></tr>';
        return;
      }
      
      tbody.innerHTML = allContracts.map(con => {
        const statusClass = con.status === 'ì„œëª…ì™„ë£Œ' ? 'badge-success' : 'badge-warning';
        return `
          <tr>
            <td>${con.name}</td>
            <td>${con.type}</td>
            <td>${con.period}</td>
            <td>${con.createdAt}</td>
            <td><span class="badge ${statusClass}">${con.status}</span></td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="viewContract('${con.id}')">ğŸ“„ ë³´ê¸°</button>
              ${con.status === 'ì„œëª…ëŒ€ê¸°' ? `<button class="btn btn-sm btn-primary" onclick="sendContractLink('${con.id}')">ğŸ“§ ë§í¬ì „ì†¡</button>` : ''}
            </td>
          </tr>
        `;
      }).join('');
    }

    function loadNotice() {
      // ê³µì§€ì‚¬í•­ ê¸°ëŠ¥ ì¶”í›„ êµ¬í˜„
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // ê³„ì•½ì„œ ì‘ì„± í˜ì´ì§€ ì—´ê¸°
    function openContractPage() {
      // ë°©ë²• 1: ìƒˆ íƒ­ìœ¼ë¡œ ì—´ê¸° (ê°€ì¥ ì•ˆì „)
      const contractWindow = window.open('contract.html', '_blank');
      
      // íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆì„ ê²½ìš° ëŒ€ë¹„
      if (!contractWindow) {
        // ë°©ë²• 2: í˜„ì¬ íƒ­ì—ì„œ ì—´ê¸°
        if (confirm('ê³„ì•½ì„œ ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€» ì‘ì„± í›„ ë’¤ë¡œê°€ê¸°ë¡œ ëŒì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
          window.location.href = 'contract.html';
        }
      }
    }
  </script>
</body>
</html>
