<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§›ë‚¨ì‚´ë¡± ê´€ë¦¬ì í˜ì´ì§€</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #8b7355; --primary-dark: #6b5d4f; --bg-light: #f5f1e8; --bg-white: #fdfcfa;
      --text-primary: #6b5d4f; --text-secondary: #9b8a76; --border-color: #e8dfd0; --border-radius: 8px;
      --shadow-sm: 0 2px 8px rgba(107, 93, 79, 0.08); --shadow-lg: 0 8px 24px rgba(107, 93, 79, 0.15);
      --spacing-xs: 6px; --spacing-sm: 12px; --spacing-md: 16px; --spacing-lg: 24px; --spacing-xl: 32px;
      --success-color: #7a9b7a; --warning-color: #d4a574; --danger-color: #c67b7b;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: var(--bg-light); color: var(--text-primary); }
    .hidden { display: none !important; }
    #loginScreen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-box { background: var(--bg-white); border-radius: 12px; padding: 48px 40px; box-shadow: var(--shadow-lg); max-width: 420px; width: 100%; border: 1px solid var(--border-color); text-align: center; }
    .login-logo { font-size: 64px; margin-bottom: 16px; }
    .login-box h1 { font-size: 28px; color: var(--text-primary); margin-bottom: 8px; }
    .login-subtitle { color: var(--text-secondary); margin-bottom: 32px; font-size: 14px; }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px; }
    .form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 15px; }
    .btn { padding: 12px 24px; border-radius: var(--border-radius); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border: none; }
    .btn-primary { background: var(--primary-color); color: var(--bg-white); }
    .btn-primary:hover { background: var(--primary-dark); box-shadow: var(--shadow-sm); }
    .btn-secondary { background: var(--bg-light); color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-sm { padding: 8px 16px; font-size: 12px; }
    .btn-danger { background: var(--danger-color); color: var(--bg-white); }
    .btn-success { background: var(--success-color); color: var(--bg-white); }
    .container { max-width: 1200px; margin: 0 auto; padding: var(--spacing-lg); }
    .top-bar { background: var(--bg-white); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl); }
    .admin-badge { background: var(--primary-color); color: var(--bg-white); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); }
    .dashboard-card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .dashboard-card-icon { font-size: 36px; margin-bottom: var(--spacing-sm); }
    .dashboard-card-label { color: var(--text-secondary); font-size: 13px; margin-bottom: var(--spacing-xs); }
    .dashboard-card-value { font-size: 32px; font-weight: 700; color: var(--text-primary); }
    .dashboard-card-sub { font-size: 13px; color: var(--text-secondary); margin-top: var(--spacing-xs); }
    .tabs { display: flex; gap: var(--spacing-xs); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--border-color); overflow-x: auto; flex-wrap: wrap; }
    .tab { padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; color: var(--text-secondary); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent; white-space: nowrap; }
    .tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .card-header { padding: var(--spacing-lg); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0; }
    .card-body { padding: var(--spacing-lg); }
    table { width: 100%; border-collapse: collapse; }
    table th { background: var(--bg-light); padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--border-color); font-size: 13px; }
    table td { padding: 12px; border-bottom: 1px solid var(--border-color); font-size: 14px; color: var(--text-primary); }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; }
    .badge-success { background: #e6f2e6; color: #4a6b4a; }
    .badge-warning { background: #f5ead9; color: #8b6846; }
    .badge-danger { background: #f5e3e3; color: #8b5555; }
    .badge-info { background: #e3ebf2; color: #5a708a; }
    .badge-primary { background: #e3ebf2; color: #5a708a; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
    .modal-content { background: var(--bg-white); border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); }
    .modal-header { padding: 25px 30px; border-bottom: 2px solid var(--bg-light); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 30px; }
    .modal-footer { padding: 20px 30px; border-top: 2px solid var(--bg-light); text-align: right; display: flex; gap: 8px; justify-content: flex-end; }
    .modal-close { background: none; border: none; font-size: 28px; color: var(--text-secondary); cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
    .modal-close:hover { background: var(--bg-light); color: var(--text-primary); }
    .filters { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); flex-wrap: wrap; }
    .filter-group { flex: 1; min-width: 200px; }
    .filter-group label { display: block; margin-bottom: var(--spacing-xs); font-weight: 600; color: var(--text-primary); font-size: 13px; }
    .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; }
    
    /* ê³„ì•½ì„œ ëª¨ë‹¬ ì „ìš© ìŠ¤íƒ€ì¼ */
    #contractModal { z-index: 10000; }
    #contractModal .modal-content { max-width: 95%; width: 1400px; max-height: 95vh; }
    #contractModal .tab-buttons { display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--border-color); }
    #contractModal .tab-button { padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    #contractModal .tab-button:hover { color: var(--primary-color); }
    #contractModal .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    #contractModal .tab-content { display: none; }
    #contractModal .tab-content.active { display: block; }
    #contractModal .form-section { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-xl); margin-bottom: var(--spacing-lg); }
    #contractModal .form-section h3 { font-size: 18px; color: var(--text-primary); margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color); }
    #contractModal .form-section h4 { font-size: 15px; color: var(--primary-color); margin: var(--spacing-lg) 0 var(--spacing-md) 0; }
    #contractModal .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-md); }
    #contractModal .form-group { display: flex; flex-direction: column; }
    #contractModal .form-group label { font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-xs); font-size: 14px; }
    #contractModal .form-group input, #contractModal .form-group select, #contractModal .form-group textarea { padding: var(--spacing-sm); border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; transition: border-color 0.2s ease; }
    #contractModal .form-group input:focus, #contractModal .form-group select:focus, #contractModal .form-group textarea:focus { outline: none; border-color: var(--primary-color); }
    #contractModal .form-group textarea { min-height: 150px; resize: vertical; font-family: inherit; line-height: 1.6; }
    #contractModal .help-text { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
    #contractModal .day-buttons { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    #contractModal .day-btn { padding: 10px 18px; border: 2px solid var(--border-color); background: var(--bg-white); color: var(--text-secondary); border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; font-size: 14px; min-width: 50px; }
    #contractModal .day-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }
    #contractModal .day-btn.active { background: var(--primary-color); border-color: var(--primary-color); color: var(--bg-white); }
    #contractModal .work-schedule-item { background: var(--bg-light); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-md); margin-bottom: var(--spacing-md); }
    #contractModal .action-buttons { display: flex; gap: var(--spacing-md); justify-content: flex-end; margin-top: var(--spacing-xl); }
    #contractModal .preview-section { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-xl); }
    #contractModal .preview-content { max-width: 800px; margin: 0 auto; padding: 40px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    #contractModal .preview-title { text-align: center; font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-xl); letter-spacing: 8px; }
    #contractModal .preview-table { width: 100%; border-collapse: collapse; margin: var(--spacing-lg) 0; }
    #contractModal .preview-table th, #contractModal .preview-table td { border: 1px solid var(--border-color); padding: var(--spacing-md); text-align: left; }
    #contractModal .preview-table th { background: var(--bg-light); font-weight: 600; width: 30%; }
    
    /* í˜ì´ì§€ ë¸Œë ˆì´í¬ ìŠ¤íƒ€ì¼ */
    .page-break-before { page-break-before: always; break-before: page; }
    .page-break-after { page-break-after: always; break-after: page; }
    .avoid-page-break { page-break-inside: avoid; break-inside: avoid; }
    
    /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
    @media print {
      body * { visibility: hidden; }
      #contractViewModal, #contractViewModal * { visibility: visible; }
      #contractViewModal { position: fixed; left: 0; top: 0; width: 100%; height: 100%; background: white; z-index: 9999; }
      #contractControls, #contractSelector { display: none !important; }
      #contractPrintArea { box-shadow: none !important; margin: 0 !important; padding: 15mm !important; }
      #contractPrintArea table { page-break-inside: avoid; }
      #contractPrintArea table tr { page-break-inside: avoid; page-break-after: auto; }
      #contractPrintArea h1 { page-break-after: avoid; }
      .modal-overlay { position: static; background: white; }
      .modal-content { max-width: 100% !important; box-shadow: none !important; }
    }
  </style>
</head>
<body>
  <div id="mainScreen">
    <div class="top-bar">
      <h1 style="font-size: 20px; font-weight: 700; margin: 0;">ğŸª ë§›ë‚¨ì‚´ë¡± ê·¼ë¬´ê´€ë¦¬</h1>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span class="admin-badge">ê´€ë¦¬ì</span>
        <button class="btn btn-secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <div class="container">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <div class="dashboard-card-icon">ğŸ‘¥</div>
          <div class="dashboard-card-label">ì´ ì§ì› ìˆ˜</div>
          <div class="dashboard-card-value" id="totalEmployees">0</div>
          <div class="dashboard-card-sub">ëª…</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">âœ…</div>
          <div class="dashboard-card-label">ì˜¤ëŠ˜ ì¶œê·¼</div>
          <div class="dashboard-card-value" id="todayAttendance">0</div>
          <div class="dashboard-card-sub">ëª…</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">â°</div>
          <div class="dashboard-card-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
          <div class="dashboard-card-value" id="pendingApprovals">0</div>
          <div class="dashboard-card-sub">ê±´</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">ğŸ“„</div>
          <div class="dashboard-card-label">ë¯¸ì„œëª… ê³„ì•½ì„œ</div>
          <div class="dashboard-card-value" id="unsignedContracts">0</div>
          <div class="dashboard-card-sub">ê±´</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="dashboard" onclick="switchTab('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
        <button class="tab" data-tab="admins" onclick="switchTab('admins')">ğŸ‘‘ ê´€ë¦¬ì ëª©ë¡</button>
        <button class="tab" data-tab="employees" onclick="switchTab('employees')">ğŸ‘¥ ì§ì› ê´€ë¦¬</button>
        <button class="tab" data-tab="attendance" onclick="switchTab('attendance')">ğŸ“‹ ê·¼ë¬´ê¸°ë¡</button>
        <button class="tab" data-tab="salary" onclick="switchTab('salary')">ğŸ’° ê¸‰ì—¬ ê´€ë¦¬</button>
        <button class="tab" data-tab="approvals" onclick="switchTab('approvals')">âœ”ï¸ ìŠ¹ì¸ ê´€ë¦¬</button>
        <button class="tab" data-tab="contracts" onclick="switchTab('contracts')">ğŸ“ ê³„ì•½ì„œ ê´€ë¦¬</button>
        <button class="tab" data-tab="notice" onclick="switchTab('notice')">ğŸ“¢ ê³µì§€ì‚¬í•­</button>
        <button class="tab" data-tab="stores" onclick="switchTab('stores')">ğŸª ë§¤ì¥ ê´€ë¦¬</button>
      </div>

      <div id="tabDashboard" class="tab-content active">
        <div class="card">
          <div class="card-header"><h3>ğŸ“Š í˜„í™© ìš”ì•½</h3></div>
          <div class="card-body"><p style="color: var(--text-secondary);">ê´€ë¦¬ì í˜ì´ì§€ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</p></div>
        </div>
      </div>

      <div id="tabAdmins" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ‘‘ ê´€ë¦¬ì ëª©ë¡</h3>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ì´ë©”ì¼</th>
                  <th>ì—°ë½ì²˜</th>
                  <th>ì§ì±…</th>
                  <th>ìƒíƒœ</th>
                  <th>ê°€ì…ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="adminsTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ê´€ë¦¬ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabEmployees" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ‘¥ ì§ì› ëª©ë¡</h3>
          </div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ë§¤ì¥</label>
                <select id="employeeStoreFilter">
                  <option value="">ì „ì²´</option>
                  <!-- ë§¤ì¥ ëª©ë¡ì€ loadStoresForFilter()ì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                </select>
              </div>
              <div class="filter-group">
                <label>ìŠ¹ì¸ ìƒíƒœ</label>
                <select id="employeeStatusFilter">
                  <option value="">ì „ì²´</option>
                  <option value="pending">ìŠ¹ì¸ ëŒ€ê¸°</option>
                  <option value="approved">ìŠ¹ì¸ë¨</option>
                  <option value="rejected">ê±°ë¶€ë¨</option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadEmployees()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ì´ë©”ì¼</th>
                  <th>ë§¤ì¥</th>
                  <th>ì§ê¸‰</th>
                  <th>ì—°ë½ì²˜</th>
                  <th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="employeeTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabAttendance" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ“‹ ê·¼ë¬´ê¸°ë¡</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ì¡°íšŒ ì›”</label>
                <input type="month" id="attendanceMonth">
              </div>
              <div class="filter-group">
                <label>ë§¤ì¥</label>
                <select id="attendanceStoreFilter">
                  <option value="">ì „ì²´</option>
                  <option value="ë¶€ì²œì‹œì²­ì ">ë¶€ì²œì‹œì²­ì </option>
                  <option value="ìƒë™ì ">ìƒë™ì </option>
                  <option value="ë¶€ì²œì—­ì‚¬ì ">ë¶€ì²œì—­ì‚¬ì </option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadAttendanceList()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ë‚ ì§œ</th>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ì¶œê·¼</th>
                  <th>í‡´ê·¼</th>
                  <th>ê·¼ë¬´ì‹œê°„</th>
                  <th>ìƒíƒœ</th>
                </tr>
              </thead>
              <tbody id="attendanceTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; color: var(--text-secondary);">ê·¼ë¬´ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabSalary" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>ğŸ’° ê¸‰ì—¬ ë‚´ì—­</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ì¡°íšŒ ì›”</label>
                <input type="month" id="salaryMonth">
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadSalaryList()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì´ë¦„</th>
                  <th>ë§¤ì¥</th>
                  <th>ê¸°ë³¸ê¸‰</th>
                  <th>ì¶”ê°€ìˆ˜ë‹¹</th>
                  <th>ê³µì œ</th>
                  <th>ì‹¤ì§€ê¸‰ì•¡</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="salaryTableBody">
                <tr>
                  <td colspan="8" style="text-align: center; color: var(--text-secondary);">ê¸‰ì—¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabApprovals" class="tab-content">
        <!-- ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ (êµ¬ë§¤/íê¸°/í‡´ì§ì„œ) -->
        <div class="card">
          <div class="card-header">
            <h3>âœ”ï¸ ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡</h3>
          </div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>ìŠ¹ì¸ ìœ í˜•</label>
                <select id="approvalTypeFilter">
                  <option value="">ì „ì²´</option>
                  <option value="purchase">ğŸ’³ êµ¬ë§¤</option>
                  <option value="disposal">ğŸ—‘ï¸ íê¸°</option>
                  <option value="resignation">ğŸ“„ í‡´ì§ì„œ</option>
                </select>
              </div>
              <div class="filter-group">
                <label>ìƒíƒœ</label>
                <select id="approvalStatusFilter">
                  <option value="">ì „ì²´</option>
                  <option value="pending">ëŒ€ê¸°ì¤‘</option>
                  <option value="approved">ìŠ¹ì¸ë¨</option>
                  <option value="rejected">ê±°ë¶€ë¨</option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadApprovals()">ì¡°íšŒ</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì‹ ì²­ì</th>
                  <th>ìœ í˜•</th>
                  <th>ì œëª©/ë‚´ìš©</th>
                  <th>ì‹ ì²­ì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ì²˜ë¦¬</th>
                </tr>
              </thead>
              <tbody id="approvalsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabContracts" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ“ ê³„ì•½ì„œ ëª©ë¡</h3>
            <button class="btn btn-primary" onclick="openContractPage()">+ ìƒˆ ê³„ì•½ì„œ ì‘ì„±</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ì§ì›ëª…</th>
                  <th>ê³„ì•½ ìœ í˜•</th>
                  <th>ê³„ì•½ ê¸°ê°„</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="contractsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ê³„ì•½ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabNotice" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸ“¢ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h3>
            <button class="btn btn-primary" onclick="showAddNoticeModal()">+ ê³µì§€ì‚¬í•­ ì‘ì„±</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ì¤‘ìš”</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="noticeTableBody">
                <tr>
                  <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabStores" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>ğŸª ë§¤ì¥ ê´€ë¦¬</h3>
            <button class="btn btn-primary" onclick="showAddStoreModal()">+ ë§¤ì¥ ì¶”ê°€</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ë§¤ì¥ëª…</th>
                  <th>ì£¼ì†Œ</th>
                  <th>ì—°ë½ì²˜</th>
                  <th>ëŒ€í‘œì</th>
                  <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="storesTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ë¡œë”© ì¤‘...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë§¤ì¥ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="storeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="storeModalTitle" style="margin: 0;">ğŸª ë§¤ì¥ ì¶”ê°€</h2>
        <button class="modal-close" onclick="closeStoreModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editStoreId">
        <div class="form-group">
          <label for="storeName">ë§¤ì¥ëª… *</label>
          <input type="text" id="storeName" placeholder="ë¶€ì²œì‹œì²­ì " required>
        </div>
        <div class="form-group">
          <label for="storeAddress">ì£¼ì†Œ</label>
          <input type="text" id="storeAddress" placeholder="ê²½ê¸°ë„ ë¶€ì²œì‹œ...">
        </div>
        <div class="form-group">
          <label for="storePhone">ì—°ë½ì²˜</label>
          <input type="tel" id="storePhone" placeholder="032-123-4567">
        </div>
        <div class="form-group">
          <label for="storeCEO">ëŒ€í‘œìëª…</label>
          <input type="text" id="storeCEO" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
          <label for="storeBusinessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
          <input type="text" id="storeBusinessNumber" placeholder="123-45-67890">
        </div>
        
        <!-- ìˆ˜ë‹¹ ì ìš© ì˜µì…˜ -->
        <div class="form-group" style="border-top: 2px solid var(--border-color); padding-top: var(--spacing-md); margin-top: var(--spacing-md);">
          <label style="font-weight: 700; font-size: 15px; margin-bottom: var(--spacing-sm);">ğŸ’° ìˆ˜ë‹¹ ì ìš© ì˜µì…˜</label>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-md);">
            ì´ ë§¤ì¥ì—ì„œ ì ìš©í•  ìˆ˜ë‹¹ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”. ê³„ì•½ì„œ ì‘ì„± ì‹œ ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.
          </p>
          
          <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
            <label style="display: flex; align-items: center; cursor: pointer; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius);">
              <input type="checkbox" id="storeOvertimeAllowance" style="width: auto; margin-right: 8px; cursor: pointer;">
              <span style="font-size: 14px;">ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 1.5ë°°)</span>
            </label>
            
            <label style="display: flex; align-items: center; cursor: pointer; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius);">
              <input type="checkbox" id="storeNightAllowance" style="width: auto; margin-right: 8px; cursor: pointer;">
              <span style="font-size: 14px;">ì•¼ê°„ê·¼ë¡œìˆ˜ë‹¹ (22:00~06:00, ì‹œê¸‰ Ã— 0.5ë°°)</span>
            </label>
            
            <label style="display: flex; align-items: center; cursor: pointer; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius);">
              <input type="checkbox" id="storeHolidayAllowance" style="width: auto; margin-right: 8px; cursor: pointer;">
              <span style="font-size: 14px;">íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 1.5ë°°)</span>
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label>ëŒ€í‘œ ì„œëª… ì´ë¯¸ì§€</label>
          <div style="margin-bottom: 10px;">
            <input type="file" id="storeCeoSignatureInput" accept="image/*" onchange="previewStoreSignature(event)" style="display: none;">
            <button type="button" class="btn" style="background: #6c757d; color: white; width: 100%;" onclick="document.getElementById('storeCeoSignatureInput').click()">
              ğŸ“¸ ëŒ€í‘œ ì„œëª… ì—…ë¡œë“œ
            </button>
          </div>
          <div id="storeCeoSignaturePreview" style="border: 2px dashed #ddd; padding: 20px; text-align: center; min-height: 100px; display: flex; align-items: center; justify-content: center;">
            <span style="color: #999;">ì„œëª… ì´ë¯¸ì§€ ì„ íƒ (ì„ íƒì‚¬í•­)</span>
          </div>
          <small style="color: #666; display: block; margin-top: 8px;">
            ğŸ’¡ ë§¤ì¥ë³„ ëŒ€í‘œìê°€ ë‹¤ë¥¼ ê²½ìš° ê°ê° ì„œëª…ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeStoreModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveStore()">ì €ì¥</button>
        <button id="deleteStoreBtn" class="btn btn-danger" onclick="deleteStore()" style="display: none; margin-right: auto;">ì‚­ì œ</button>
      </div>
    </div>
  </div>

  <!-- ê³µì§€ì‚¬í•­ ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="noticeModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 id="noticeModalTitle" style="margin: 0;">ğŸ“¢ ê³µì§€ì‚¬í•­ ì‘ì„±</h2>
        <button class="modal-close" onclick="closeNoticeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editNoticeId">
        <div class="form-group">
          <label for="noticeTitle">ì œëª© *</label>
          <input type="text" id="noticeTitle" placeholder="ê³µì§€ì‚¬í•­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <div class="form-group">
          <label for="noticeContent">ë‚´ìš© *</label>
          <textarea id="noticeContent" placeholder="ê³µì§€ì‚¬í•­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; min-height: 300px; resize: vertical; box-sizing: border-box;"></textarea>
        </div>
        <div class="form-group">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox" id="noticeImportant" style="width: auto; margin-right: 8px; cursor: pointer;">
            <span style="font-size: 14px;">â­ ì¤‘ìš” ê³µì§€ì‚¬í•­ìœ¼ë¡œ í‘œì‹œ</span>
          </label>
          <small style="color: #666; display: block; margin-top: 8px;">
            ì¤‘ìš” ê³µì§€ì‚¬í•­ì€ ì§ì› í˜ì´ì§€ ìƒë‹¨ì— ê³ ì • í‘œì‹œë©ë‹ˆë‹¤.
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeNoticeModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveNotice()">ì €ì¥</button>
        <button id="deleteNoticeBtn" class="btn btn-danger" onclick="deleteNotice()" style="display: none; margin-right: auto;">ì‚­ì œ</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isAuthenticated = false;
    let currentTab = 'dashboard';

    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      const monthFilters = ['attendanceMonth', 'salaryMonth'];
      monthFilters.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.value = currentMonth;
      });
      checkAuthStatus();
    });

    function checkAuthStatus() {
      const savedAuth = sessionStorage.getItem('admin_authenticated');
      if (savedAuth === 'true') {
        isAuthenticated = true;
        showMainScreen();
      } else {
        // ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        alert('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        window.location.href = 'admin-login.html';
      }
    }

    // handleAdminLogin í•¨ìˆ˜ëŠ” admin-login.htmlë¡œ ì´ë™ë¨

    async function logout() {
      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        try {
          await auth.signOut();
          isAuthenticated = false;
          sessionStorage.removeItem('admin_authenticated');
          window.location.href = 'admin-login.html';
        } catch (error) {
          console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
        }
      }
    }

    async function showMainScreen() {
      document.getElementById('mainScreen').classList.remove('hidden');
      
      // ì—­í•  ì²´í¬ ë° UI ì œí•œ
      const userRole = sessionStorage.getItem('admin_role');
      if (userRole === 'manager') {
        applyManagerRestrictions();
      }
      
      // signedContracts ìºì‹œ ë¡œë“œ
      await loadSignedContractsCache();
      // localStorage contracts ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜
      await migrateLocalStorageContracts();
      loadDashboard();
      switchTab('employees');
    }
    
    // ë§¤ë‹ˆì € ê¶Œí•œ ì œí•œ ì ìš©
    function applyManagerRestrictions() {
      console.log('ğŸ”’ ë§¤ë‹ˆì € ê¶Œí•œ ì œí•œ ì ìš© ì¤‘...');
      
      // ê´€ë¦¬ì ë°°ì§€ ë³€ê²½
      const adminBadge = document.querySelector('.admin-badge');
      if (adminBadge) {
        adminBadge.textContent = 'ë§¤ë‹ˆì € (ì½ê¸° ì „ìš©)';
        adminBadge.style.background = 'var(--text-secondary)';
      }
      
      // ëª¨ë“  ì“°ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ê³µí†µ í´ë˜ìŠ¤ ì‚¬ìš©)
      const writeButtons = [
        // ì§ì› ê´€ë¦¬ - ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¸°ê¸°ëŠ” ë™ì ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ loadEmployeesì—ì„œ ì²˜ë¦¬
        
        // ê³„ì•½ì„œ ê´€ë¦¬ - ìƒˆ ê³„ì•½ì„œ ì‘ì„± ë²„íŠ¼
        'document.querySelector("#tabContracts .btn-primary")',
        
        // ê³µì§€ì‚¬í•­ - ì‘ì„± ë²„íŠ¼
        'document.querySelector("#tabNotice .btn-primary")',
        
        // ë§¤ì¥ ê´€ë¦¬ - ì¶”ê°€ ë²„íŠ¼
        'document.querySelector("#tabStores .btn-primary")'
      ];
      
      writeButtons.forEach(selector => {
        try {
          const btn = eval(selector);
          if (btn) {
            btn.style.display = 'none';
          }
        } catch (e) {
          // ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ë¬´ì‹œ
        }
      });
      
      // ìŠ¹ì¸ ê´€ë¦¬ íƒ­ì˜ ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ loadApprovalsì—ì„œ ì²˜ë¦¬
      
      console.log('âœ… ë§¤ë‹ˆì € ê¶Œí•œ ì œí•œ ì ìš© ì™„ë£Œ');
    }
    
    // signedContracts Firestore ìºì‹œ ë¡œë“œ
    async function loadSignedContractsCache() {
      try {
        const snapshot = await firebase.firestore().collection('signedContracts').get();
        signedContractsCache = [];
        snapshot.forEach(doc => {
          signedContractsCache.push({ id: doc.id, ...doc.data() });
        });
        console.log(`âœ… ${signedContractsCache.length}ê°œ ì„œëª…ëœ ê³„ì•½ì„œ ìºì‹œ ë¡œë“œ ì™„ë£Œ`);
      } catch (error) {
        console.error('âŒ signedContracts ë¡œë“œ ì‹¤íŒ¨:', error);
        signedContractsCache = [];
      }
    }

    // localStorage contractsë¥¼ Firestoreë¡œ ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜
    async function migrateLocalStorageContracts() {
      console.log('ğŸ”„ localStorage contracts ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...');
      
      try {
        let migratedCount = 0;
        let skippedCount = 0;
        let errorCount = 0;
        
        // localStorageì—ì„œ ëª¨ë“  contract í‚¤ ì°¾ê¸°
        const contractKeys = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('contract_C')) {
            contractKeys.push(key);
          }
        }
        
        if (contractKeys.length === 0) {
          console.log('âœ… localStorageì— ë§ˆì´ê·¸ë ˆì´ì…˜í•  ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        console.log(`ğŸ“Š ì´ ${contractKeys.length}ê°œì˜ localStorage ê³„ì•½ì„œ ë°œê²¬`);
        
        // ê° ê³„ì•½ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜
        for (const key of contractKeys) {
          try {
            const contractId = key.replace('contract_', '');
            
            // Firestoreì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            const docRef = firebase.firestore().collection('contracts').doc(contractId);
            const docSnap = await docRef.get();
            
            if (docSnap.exists) {
              console.log(`â­ï¸  ê±´ë„ˆë›°ê¸°: ${contractId} (ì´ë¯¸ Firestoreì— ì¡´ì¬)`);
              skippedCount++;
              continue;
            }
            
            // localStorageì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const contractData = JSON.parse(localStorage.getItem(key));
            
            // Firestoreì— ì €ì¥
            await docRef.set({
              ...contractData,
              migratedFrom: 'localStorage',
              migratedAt: new Date().toISOString()
            });
            
            console.log(`âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: ${contractId} (${contractData.employeeName})`);
            migratedCount++;
            
            // localStorageì—ì„œ ì‚­ì œ
            localStorage.removeItem(key);
            console.log(`ğŸ—‘ï¸  localStorageì—ì„œ ì‚­ì œ: ${key}`);
            
          } catch (error) {
            console.error(`âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${key}`, error);
            errorCount++;
          }
        }
        
        // ê²°ê³¼ ìš”ì•½
        console.log('');
        console.log('='.repeat(50));
        console.log('ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ ìš”ì•½');
        console.log('='.repeat(50));
        console.log(`âœ… ì„±ê³µ: ${migratedCount}ê°œ`);
        console.log(`â­ï¸  ê±´ë„ˆë›°ê¸°: ${skippedCount}ê°œ (ì´ë¯¸ Firestoreì— ì¡´ì¬)`);
        console.log(`âŒ ì‹¤íŒ¨: ${errorCount}ê°œ`);
        console.log('='.repeat(50));
        
        if (migratedCount > 0) {
          alert(`âœ… localStorage ê³„ì•½ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!\n\nì„±ê³µ: ${migratedCount}ê°œ\nê±´ë„ˆë›°ê¸°: ${skippedCount}ê°œ\nì‹¤íŒ¨: ${errorCount}ê°œ`);
        }
        
      } catch (error) {
        console.error('âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
      }
    }

    function switchTab(tabName) {
      currentTab = tabName;
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
      if (selectedTab) selectedTab.classList.add('active');
      const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
      const tabId = `tab${capitalize(tabName)}`;
      const selectedContent = document.getElementById(tabId);
      if (selectedContent) {
        selectedContent.classList.add('active');
        selectedContent.style.display = 'block';
      }
      switch(tabName) {
        case 'dashboard': loadDashboard(); break;
        case 'admins': loadAdmins(); break;
        case 'employees': 
          loadStoresForFilter('employeeStoreFilter'); 
          loadEmployees(); 
          break;
        case 'attendance': loadAttendanceList(); break;
        case 'salary': loadSalaryList(); break;
        case 'approvals': loadApprovals(); break;
        case 'contracts': loadContracts(); break;
        case 'notice': loadNotice(); break;
        case 'stores': loadStores(); break;
      }
    }

    async function loadDashboard() {
      let totalEmployees = 0; // ê¸°ë³¸ê°’ 0 (Firebaseì—ì„œ ì‹¤ì œ ìˆ˜ë¥¼ ê°€ì ¸ì˜´)
      let totalContracts = 0;
      let unsignedContracts = 0;
      
      // Firestore users ì»¬ë ‰ì…˜ì—ì„œ ì§ì› ìˆ˜ ê°€ì ¸ì˜¤ê¸°
      try {
        const snapshot = await db.collection('users')
          .where('userType', '==', 'employee')
          .get();
        
        totalEmployees = snapshot.size;
        console.log(`ğŸ“Š ëŒ€ì‹œë³´ë“œ: ì´ ${totalEmployees}ëª…ì˜ ì§ì› í™•ì¸`);
      } catch (error) {
        console.warn('âš ï¸ Firestore ì§ì› ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
        totalEmployees = 0;
      }
      
      // localStorageì—ì„œ ê³„ì•½ì„œ ìˆ˜ ì¹´ìš´íŠ¸
      const employeeMap = new Map();
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = signedContractsCache;
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            
            const empKey = contractData.employeeName + '_' + contractData.employeeBirth;
            if (!employeeMap.has(empKey)) {
              employeeMap.set(empKey, true);
              totalContracts++;
            }
            
            if (!isSigned) unsignedContracts++;
          } catch(e) {}
        }
      }
      
      // ì˜¤ëŠ˜ ì¶œê·¼ ì§ì› ìˆ˜ ê³„ì‚°
      let todayAttendanceCount = 0;
      try {
        const today = new Date().toISOString().split('T')[0];
        const attendanceSnapshot = await db.collection('attendance')
          .where('date', '==', today)
          .get();
        todayAttendanceCount = attendanceSnapshot.size;
        console.log(`ğŸ“ˆ ì˜¤ëŠ˜ ì¶œê·¼: ${todayAttendanceCount}ëª…`);
      } catch (error) {
        console.warn('âš ï¸ ì¶œê·¼ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
      }
      
      // ëŒ€ê¸°ì¤‘ ìŠ¹ì¸ ìˆ˜ ê³„ì‚°
      let pendingApprovalsCount = 0;
      try {
        const approvalsSnapshot = await db.collection('approvals')
          .where('status', '==', 'pending')
          .get();
        pendingApprovalsCount = approvalsSnapshot.size;
        console.log(`ğŸ“ˆ ëŒ€ê¸°ì¤‘ ìŠ¹ì¸: ${pendingApprovalsCount}ê±´`);
      } catch (error) {
        console.warn('âš ï¸ ìŠ¹ì¸ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
      }
      
      document.getElementById('totalEmployees').textContent = totalEmployees;
      document.getElementById('todayAttendance').textContent = todayAttendanceCount;
      document.getElementById('pendingApprovals').textContent = pendingApprovalsCount;
      document.getElementById('unsignedContracts').textContent = unsignedContracts;
    }

    function updateDashboardCard(id, value, subtitle) {
      const valueElement = document.getElementById(id);
      if (valueElement) {
        valueElement.textContent = value;
        if (subtitle) {
          const subElement = valueElement.nextElementSibling;
          if (subElement) subElement.textContent = subtitle;
        }
      }
    }

    async function loadEmployees() {
      const tbody = document.getElementById('employeeTableBody');
      if (!tbody) return;
      
      // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
      const storeFilter = document.getElementById('employeeStoreFilter')?.value || '';
      const statusFilter = document.getElementById('employeeStatusFilter')?.value || '';
      
      // ë¡œë”© í‘œì‹œ
      tbody.innerHTML = `
        <tr>
          <td colspan="8" style="text-align: center; padding: 40px;">
            <div>â³ ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </td>
        </tr>
      `;
      
      try {
        console.log('ğŸ“‹ ì§ì› ëª©ë¡ ë¡œë“œ ì‹œì‘...');
        console.log('ğŸ“ ì»¬ë ‰ì…˜: users, ì¡°ê±´: userType == employee');
        
        // Firestore users ì»¬ë ‰ì…˜ì—ì„œ ì§ì› ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        let query = db.collection('users').where('userType', '==', 'employee');
        
        // ìƒíƒœ í•„í„° ì ìš©
        if (statusFilter) {
          query = query.where('status', '==', statusFilter);
        }
        
        const usersSnapshot = await query.get();
        
        console.log(`ğŸ“Š ì¡°íšŒ ê²°ê³¼: ${usersSnapshot.size}ëª…ì˜ ì§ì›`);
        
        // ë””ë²„ê¹…: ëª¨ë“  users ì»¬ë ‰ì…˜ ë°ì´í„° í™•ì¸
        const allUsersSnapshot = await db.collection('users').get();
        console.log(`ğŸ“Š ì „ì²´ users ì»¬ë ‰ì…˜: ${allUsersSnapshot.size}ê°œ ë¬¸ì„œ`);
        allUsersSnapshot.forEach(doc => {
          const data = doc.data();
          console.log(`  - ${doc.id}: ${data.name} (userType: ${data.userType || 'undefined'})`);
        });
        
        if (usersSnapshot.empty) {
          tbody.innerHTML = `
            <tr>
              <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                <p style="margin-bottom: 16px;">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="font-size: 14px; color: var(--text-secondary);">ì§ì› ê°€ì… í˜ì´ì§€ì—ì„œ ë¨¼ì € ì§ì›ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>
                <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">
                  ğŸ’¡ ì „ì²´ users: ${allUsersSnapshot.size}ëª… (ì½˜ì†”ì—ì„œ ìƒì„¸ í™•ì¸)
                </p>
              </td>
            </tr>
          `;
          return;
        }
        
        let employees = [];
        usersSnapshot.forEach(doc => {
          const data = doc.data();
          console.log(`âœ… ì§ì› ë¡œë“œ: ${data.name} (${doc.id})`);
          employees.push({
            uid: doc.id,
            name: data.name || '-',
            store: data.store || '-',
            position: data.position || '-',
            phone: data.phone || '-',
            birth: data.birth || '-',
            status: data.status || 'active',
            email: data.email || '-',
            address: data.address || '-'
          });
        });
        
        // ë§¤ì¥ í•„í„° ì ìš© (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
        if (storeFilter) {
          employees = employees.filter(emp => emp.store === storeFilter);
        }
        
        console.log(`âœ… ${employees.length}ëª…ì˜ ì§ì› ëª©ë¡ í‘œì‹œ`);
        
        // ê° ì§ì›ì˜ ê³„ì•½ì„œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        tbody.innerHTML = employees.map(emp => {
          // localStorageì—ì„œ í•´ë‹¹ ì§ì›ì˜ ê³„ì•½ì„œ ì°¾ê¸°
          let hasContract = false;
          let contractCount = 0;
          
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('contract_C')) {
              try {
                const contractData = JSON.parse(localStorage.getItem(key));
                // ì£¼ë¯¼ë²ˆí˜¸ë¡œ ë§¤ì¹­ (ê°€ì¥ ì •í™•)
                if (contractData.employeeBirth === emp.birth && contractData.employeeName === emp.name) {
                  hasContract = true;
                  contractCount++;
                }
              } catch(e) {}
            }
          }
          
          // ë§¤ë‹ˆì € ê¶Œí•œ ì²´í¬
          const userRole = sessionStorage.getItem('admin_role');
          const isManager = userRole === 'manager';
          
          // ê³„ì•½ì„œ ì‘ì„± ì™„ë£Œ ì—¬ë¶€ì— ë”°ë¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ì™€ ìŠ¤íƒ€ì¼ ë³€ê²½
          let contractButton = '';
          if (!isManager) {
            contractButton = hasContract 
              ? `<button class="btn btn-sm" style="background: var(--success-color, #28a745); color: white;" onclick="switchTab('contracts')">âœ… ê³„ì•½ì„œ ${contractCount}ê±´</button>`
              : `<button class="btn btn-sm btn-primary" onclick="openContractPageForEmployee('${emp.uid}', '${emp.name}', '${emp.birth}', '${emp.phone}', '${emp.address}')">ğŸ“ ê³„ì•½ì„œ ì‘ì„±</button>`;
          } else {
            // ë§¤ë‹ˆì €ëŠ” ê³„ì•½ì„œ ì¡°íšŒë§Œ ê°€ëŠ¥
            contractButton = hasContract 
              ? `<button class="btn btn-sm" style="background: var(--text-secondary); color: white;" onclick="switchTab('contracts')">ğŸ“„ ê³„ì•½ì„œ ${contractCount}ê±´ ì¡°íšŒ</button>`
              : '<span style="font-size: 12px; color: var(--text-secondary);">ê³„ì•½ì„œ ì—†ìŒ</span>';
          }
          
          // ìƒíƒœ ë°°ì§€ ê²°ì •
          let statusBadge = '';
          if (emp.status === 'approved') {
            statusBadge = '<span class="badge badge-success">ì¬ì§</span>';
          } else if (emp.status === 'pending') {
            statusBadge = '<span class="badge badge-warning" style="background: #ffc107; color: #000;">ìŠ¹ì¸ëŒ€ê¸°ì¤‘</span>';
          } else if (emp.status === 'rejected') {
            statusBadge = '<span class="badge badge-danger">ê°€ì…ê±°ë¶€</span>';
          } else {
            // statusê°€ 'active' ë˜ëŠ” ê¸°íƒ€ì¸ ê²½ìš° (ì´ì „ ë°ì´í„° í˜¸í™˜)
            statusBadge = '<span class="badge badge-success">ì¬ì§</span>';
          }
          
          // ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ê²½ìš° ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ í‘œì‹œ
          let approvalButtons = '';
          if (emp.status === 'pending' && !isManager) {
            approvalButtons = `
              <button class="btn btn-sm" style="background: var(--success-color, #28a745); color: white;" onclick="approveEmployee('${emp.uid}', '${emp.name}')">
                âœ… ìŠ¹ì¸
              </button>
              <button class="btn btn-sm" style="background: var(--danger-color, #dc3545); color: white;" onclick="rejectEmployee('${emp.uid}', '${emp.name}')">
                âŒ ê±°ë¶€
              </button>
            `;
          }
          
          // ì‚­ì œ ë²„íŠ¼ (ë§¤ë‹ˆì €ëŠ” í‘œì‹œ ì•ˆ í•¨)
          const deleteButton = !isManager 
            ? `<button class="btn btn-sm" style="background: var(--danger-color, #dc3545); color: white;" onclick="deleteEmployee('${emp.uid}', '${emp.name}')">
                ğŸ—‘ï¸ ì‚­ì œ
              </button>`
            : '';
          
          return `
            <tr>
              <td>${emp.name}</td>
              <td style="font-size: 12px; color: var(--text-secondary);">${emp.email}</td>
              <td>${emp.store}</td>
              <td>${emp.position}</td>
              <td>${emp.phone}</td>
              <td>${emp.birth || '-'}</td>
              <td>${statusBadge}</td>
              <td>
                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                  ${approvalButtons}
                  ${contractButton}
                  ${deleteButton}
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
      } catch (error) {
        console.error('âŒ ì§ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        
        // ì—ëŸ¬ ë°œìƒ ì‹œ ë”ë¯¸ ë°ì´í„° í‘œì‹œ
        const dummyEmployees = [
          {
            uid: 'dummy_1',
            name: 'ê¹€ë¯¼ìˆ˜',
            email: 'minsu@example.com',
            birth: '900315-1234567',
            phone: '010-1234-5678',
            address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ì›ë¯¸êµ¬',
            store: 'ë¶€ì²œì‹œì²­ì ',
            position: 'ë°”ë¦¬ìŠ¤íƒ€',
            status: 'active'
          }
        ];
        
        tbody.innerHTML = dummyEmployees.map(emp => {
          return `
            <tr>
              <td>${emp.name}</td>
              <td style="font-size: 12px; color: var(--text-secondary);">${emp.email}</td>
              <td>${emp.store}</td>
              <td>${emp.position}</td>
              <td>${emp.phone}</td>
              <td>${emp.birth}</td>
              <td><span class="badge badge-success">í™œì„± (ë”ë¯¸)</span></td>
              <td>
                <button class="btn btn-sm btn-primary" onclick="alert('ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤. ì‹¤ì œ ì§ì›ì„ ê°€ì…ì‹œì¼œì£¼ì„¸ìš”.')">ğŸ“ ê³„ì•½ì„œ ì‘ì„±</button>
              </td>
            </tr>
          `;
        }).join('');
        
        tbody.innerHTML += `
          <tr>
            <td colspan="8" style="text-align: center; padding: 20px; background: #fff9e6; color: #8b6914;">
              <p style="margin-bottom: 8px;">âš ï¸ Firestore ì—°ê²° ì‹¤íŒ¨. ë”ë¯¸ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
              <p style="font-size: 13px;">ì‹¤ì œ ì§ì›ì´ <a href="employee-register.html" target="_blank" style="color: var(--primary-color);">ê°€ì…</a>í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </td>
          </tr>
        `;
      }
    }

    async function deleteEmployee(uid, name) {
      if (!confirm(`âš ï¸ ${name} ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œ ì‹œ:\n- ì§ì› ê³„ì •ì´ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤\n- ê³„ì•½ì„œ ë° ì¶œí‡´ê·¼ ê¸°ë¡ì€ ìœ ì§€ë©ë‹ˆë‹¤\n- Firebase ì¸ì¦ ê³„ì •ì€ í•´ë‹¹ ì§ì›ì´ ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œ ìë™ ì‚­ì œë©ë‹ˆë‹¤\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // 1. users ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
        await db.collection('users').doc(uid).delete();
        console.log('âœ… users ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ ì™„ë£Œ');
        
        // 2. employees ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
        await db.collection('employees').doc(uid).delete();
        console.log('âœ… employees ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ ì™„ë£Œ');
        
        // 3. Firebase Authentication ê³„ì •ì€ í•´ë‹¹ ì§ì›ì´ ë¡œê·¸ì¸ ì‹œë„í•  ë•Œ ìë™ìœ¼ë¡œ ì‚­ì œë¨
        //    (employee-login.html ë° employee.jsì—ì„œ ì²˜ë¦¬)
        
        alert(`âœ… ${name} ì§ì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nFirebase ì¸ì¦ ê³„ì •ì€ í•´ë‹¹ ì§ì›ì´ ë‹¤ìŒ ë¡œê·¸ì¸ ì‹œë„ ì‹œ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.`);
        
        // ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        loadEmployees();
        
      } catch (error) {
        console.error('âŒ ì§ì› ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('âŒ ì§ì› ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message);
      }
    }

    function showEmployeeContractList(employeeName) {
      const contracts = [];
      let employeeId = null;
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          const contractData = JSON.parse(localStorage.getItem(key));
          if (contractData.employeeName === employeeName) {
            const contractId = key.replace('contract_', '');
            if (!employeeId) employeeId = getEmployeeIdFromContract(contractData);
            const signedContracts = signedContractsCache;
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            contracts.push({
              id: contractId,
              data: contractData,
              isSigned: isSigned,
              createdAt: contractData.createdAt || null
            });
          }
        }
      }
      
      if (contracts.length === 0) {
        alert('âš ï¸ í•´ë‹¹ ì§ì›ì˜ ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      contracts.sort((a, b) => {
        const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
        const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
        return dateB - dateA;
      });
      
      const docKey = `employee_docs_${employeeName}_${employeeId}`;
      const employeeDocs = JSON.parse(localStorage.getItem(docKey) || '{}');
      
      let bankAccountHtml = '';
      if (employeeDocs.bankAccount) {
        const ba = employeeDocs.bankAccount;
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #f0f9ff; border-radius: var(--border-radius); border-left: 4px solid #3b82f6;">
            <h4 style="margin-bottom: var(--spacing-sm);">ğŸ¦ í†µì¥ì‚¬ë³¸</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md);">
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ì€í–‰ëª…</p>
                <p style="font-weight: 600; margin: 0;">${ba.bankName || '-'}</p>
              </div>
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ê³„ì¢Œë²ˆí˜¸</p>
                <p style="font-weight: 600; margin: 0;">${ba.accountNumber || '-'}</p>
              </div>
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ì˜ˆê¸ˆì£¼</p>
                <p style="font-weight: 600; margin: 0;">${ba.accountHolder || '-'}</p>
              </div>
            </div>
            <p style="font-size: 11px; color: var(--text-secondary); margin: 8px 0 0 0;">
              ìµœì¢… ì—…ë°ì´íŠ¸: ${ba.updatedAt ? new Date(ba.updatedAt).toLocaleString('ko-KR') : '-'}
            </p>
          </div>
        `;
      } else {
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border-radius: var(--border-radius); border-left: 4px solid #ffc107;">
            <p style="margin: 0; font-size: 14px;">ğŸ¦ <strong>í†µì¥ì‚¬ë³¸</strong> - ì§ì›ì´ ì•„ì§ ë“±ë¡í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
      }
      
      let healthCertHtml = '';
      if (employeeDocs.healthCert) {
        const hc = employeeDocs.healthCert;
        const expiryDate = hc.expiryDate ? new Date(hc.expiryDate) : null;
        const isExpired = expiryDate && expiryDate < new Date();
        const expiryBadge = isExpired ? 
          '<span class="badge badge-danger" style="margin-left: 8px;">âš ï¸ ë§Œë£Œë¨</span>' : 
          '<span class="badge badge-success" style="margin-left: 8px;">âœ… ìœ íš¨</span>';
        
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: ${isExpired ? '#fee2e2' : '#f0fdf4'}; border-radius: var(--border-radius); border-left: 4px solid ${isExpired ? '#ef4444' : '#22c55e'};">
            <h4 style="margin-bottom: var(--spacing-sm);">ğŸ©º ë³´ê±´ì¦ ${expiryBadge}</h4>
            ${hc.imageData ? `
              <div style="margin-bottom: var(--spacing-md); text-align: center;">
                <img src="${hc.imageData}" 
                     style="max-width: 100%; max-height: 200px; border: 2px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" 
                     onclick="window.open('${hc.imageData}', '_blank')"
                     title="í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤">
                <p style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">ğŸ’¡ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ í¬ê²Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
              </div>
            ` : '<p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">ì—…ë¡œë“œëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
            <div>
              <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ìœ íš¨ê¸°ê°„</p>
              <p style="font-weight: 600; margin: 0; font-size: 16px; color: ${isExpired ? '#ef4444' : '#22c55e'};">${hc.expiryDate || '-'}</p>
            </div>
            <p style="font-size: 11px; color: var(--text-secondary); margin: 8px 0 0 0;">
              ìµœì¢… ì—…ë°ì´íŠ¸: ${hc.updatedAt ? new Date(hc.updatedAt).toLocaleString('ko-KR') : '-'}
            </p>
          </div>
        `;
      } else {
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border-radius: var(--border-radius); border-left: 4px solid #ffc107;">
            <p style="margin: 0; font-size: 14px;">ğŸ©º <strong>ë³´ê±´ì¦</strong> - ì§ì›ì´ ì•„ì§ ë“±ë¡í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          </div>
        `;
      }
      
      const contractRows = contracts.map((contract, index) => {
        // ë‚ ì§œì™€ ì‹œê°„ í•¨ê»˜ í‘œì‹œ
        let createdDateTime = '-';
        if (contract.createdAt) {
          const date = new Date(contract.createdAt);
          const dateStr = date.toLocaleDateString('ko-KR');
          const timeStr = date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
          createdDateTime = `${dateStr} ${timeStr}`;
        }
        
        const statusBadge = contract.isSigned ? 
          '<span class="badge badge-success">âœ… ì„œëª…ì™„ë£Œ</span>' : 
          '<span class="badge badge-warning">â° ì„œëª…ëŒ€ê¸°</span>';
        const isLatest = index === 0 ? '<span class="badge badge-primary" style="margin-left: 8px;">ìµœì‹ </span>' : '';
        
        return `
          <tr>
            <td>${contracts.length - index}</td>
            <td>${contract.data.contractType || 'ê·¼ë¡œê³„ì•½ì„œ'}${isLatest}</td>
            <td>${contract.data.startDate} ~ ${contract.data.endDate}</td>
            <td>${createdDateTime}</td>
            <td>${statusBadge}</td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="viewContract('${contract.id}')">ğŸ“„ ë³´ê¸°</button>
              <button class="btn btn-sm btn-primary" onclick="sendContractLink('${contract.id}')">ğŸ“§ ì „ì†¡</button>
            </td>
          </tr>
        `;
      }).join('');
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.display = 'flex';
      modal.id = 'employeeContractListModal';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>ğŸ“‹ ${employeeName}ë‹˜ì˜ ì •ë³´</h3>
            <button class="modal-close" onclick="closeEmployeeContractListModal()">âœ•</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: var(--spacing-xl);">
              <h4 style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color);">
                ğŸ“„ ì œì¶œ ì„œë¥˜
              </h4>
              ${bankAccountHtml}
              ${healthCertHtml}
            </div>
            <div>
              <h4 style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color);">
                ğŸ“‹ ê³„ì•½ì„œ ëª©ë¡
              </h4>
              <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
                <p style="margin: 0; font-size: 14px; color: var(--text-secondary);">
                  ğŸ’¡ ì´ <strong>${contracts.length}ê°œ</strong>ì˜ ê³„ì•½ì„œê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
                </p>
              </div>
              <table>
                <thead>
                  <tr>
                    <th style="width: 60px;">ë²ˆí˜¸</th>
                    <th>ê³„ì•½ìœ í˜•</th>
                    <th>ê³„ì•½ê¸°ê°„</th>
                    <th>ì‘ì„±ì¼</th>
                    <th style="width: 120px;">ìƒíƒœ</th>
                    <th style="width: 180px;">ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody>
                  ${contractRows}
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeEmployeeContractListModal()">ë‹«ê¸°</button>
            <button class="btn btn-danger" onclick="resignEmployee('${employeeName}', ${employeeId})">ğŸšª í‡´ì‚¬ ì²˜ë¦¬</button>
            <button class="btn btn-primary" onclick="openContractPage()">â• ìƒˆ ê³„ì•½ì„œ ì‘ì„±</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function closeEmployeeContractListModal() {
      const modal = document.getElementById('employeeContractListModal');
      if (modal) modal.remove();
    }

    function resignEmployee(employeeName, employeeId) {
      const confirmMsg = `âš ï¸ ${employeeName}ë‹˜ì„ í‡´ì‚¬ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në‹¤ìŒ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤:\nâ€¢ í†µì¥ì‚¬ë³¸\nâ€¢ ë³´ê±´ì¦\nâ€¢ ì§ì› ì„œë¥˜ ì „ì²´\n\nâ€» ê³„ì•½ì„œì™€ ê·¼íƒœ ê¸°ë¡ì€ ë³´ì¡´ë©ë‹ˆë‹¤.`;
      if (!confirm(confirmMsg)) return;
      
      try {
        const docKey = `employee_docs_${employeeName}_${employeeId}`;
        localStorage.removeItem(docKey);
        alert(`âœ… ${employeeName}ë‹˜ì´ í‡´ì‚¬ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        closeEmployeeContractListModal();
        loadEmployees();
      } catch (error) {
        alert('âŒ í‡´ì‚¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function getEmployeeIdFromContract(contract) {
      const employeeMap = {
        'ê¹€ë¯¼ìˆ˜': 1, 'ì´ì§€ì€': 2, 'ë°•ì„œì¤€': 3, 'ìµœì˜í¬': 4, 'ì •ìˆ˜ë¯¼': 5, 'ê°•í˜¸ë™': 6
      };
      return employeeMap[contract.employeeName] || 0;
    }

    async function viewContract(id) {
      try {
        // Firestoreì—ì„œ ê³„ì•½ì„œ ì°¾ê¸°
        const docRef = firebase.firestore().collection('contracts').doc(id);
        const docSnap = await docRef.get();
        
        if (!docSnap.exists) {
          alert('âš ï¸ ê³„ì•½ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const contract = docSnap.data();
        
        // ê°™ì€ ì§ì›ì˜ ëª¨ë“  ê³„ì•½ì„œ ì°¾ê¸° (Firestoreë§Œ)
        const allContracts = [];
        
        const snapshot = await firebase.firestore().collection('contracts').get();
        snapshot.forEach(doc => {
          const c = doc.data();
          if (c.employeeBirth === contract.employeeBirth && c.employeeName === contract.employeeName) {
            allContracts.push({
              id: doc.id,
              data: c,
              createdAt: c.createdAt || new Date().toISOString()
            });
          }
        });
        
        // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
        allContracts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        showContractViewModal(contract, id, allContracts);
      } catch (e) {
        console.error('âŒ ê³„ì•½ì„œ ì¡°íšŒ ì‹¤íŒ¨:', e);
        alert('âš ï¸ ê³„ì•½ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    function showContractViewModal(contract, currentId, allContracts = []) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.display = 'flex';
      modal.id = 'contractViewModal';
      
      // ì„œëª… ì •ë³´ í™•ì¸
      const signedContracts = signedContractsCache;
      const signedContract = signedContracts.find(sc => sc.id === contract.id);
      const isSigned = !!signedContract;
      
      // ê³„ì•½ì„œ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„± (ì—¬ëŸ¬ ê³„ì•½ì„œê°€ ìˆì„ ê²½ìš°)
      let contractSelectorHtml = '';
      if (allContracts.length > 1) {
        const options = allContracts.map((c, index) => {
          const date = new Date(c.createdAt);
          const dateStr = date.toLocaleDateString('ko-KR');
          const timeStr = date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
          const label = `${dateStr} ${timeStr}${index === 0 ? ' (ìµœì‹ )' : ''}`;
          const selected = c.id === currentId ? 'selected' : '';
          return `<option value="${c.id}" ${selected}>${label}</option>`;
        }).join('');
        
        contractSelectorHtml = `
          <div style="margin-bottom: 16px; padding: 12px; background: #e3f2fd; border-radius: 4px; border-left: 4px solid #2196f3;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <label style="font-weight: 600; margin: 0; white-space: nowrap;">ğŸ“‹ ê³„ì•½ì„œ ì„ íƒ:</label>
              <select id="contractVersionSelector" style="flex: 1; font-size: 14px; padding: 6px; border: 1px solid #ddd; border-radius: 4px;" onchange="switchContractVersion(this.value)">
                ${options}
              </select>
              <span style="background: var(--primary-color); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">ì´ ${allContracts.length}ê±´</span>
            </div>
          </div>
        `;
      }
      
      // ğŸ” ë””ë²„ê¹…: ì„œëª… ë°ì´í„° í™•ì¸
      console.log('ğŸ” ê³„ì•½ì„œ ID:', contract.id);
      console.log('ğŸ” isSigned:', isSigned);
      console.log('ğŸ” signedContract:', signedContract);
      if (signedContract) {
        console.log('ğŸ” ì„œëª… ë°ì´í„° ê¸¸ì´:', signedContract.signature?.length || 0);
        console.log('ğŸ” ì„œëª… ë°ì´í„° ì‹œì‘ ë¶€ë¶„:', signedContract.signature?.substring(0, 100) || 'N/A');
      }
      
      // ì„œëª… ì •ë³´ HTML
      let signatureHtml = '';
      if (isSigned && signedContract.signature) {
        const signDate = new Date(signedContract.signedAt);
        
        // ğŸ” ì‹¤ì œ ì„œëª… ì´ë¯¸ì§€ê°€ ìœ íš¨í•œì§€ í…ŒìŠ¤íŠ¸
        console.log('âœ… ì„œëª… HTML ìƒì„± ì‹œì‘');
        console.log('  - ì„œëª…ì¼:', signDate.toLocaleDateString('ko-KR'));
        console.log('  - ê·¼ë¡œì:', contract.employeeName);
        
        // ë§¤ì¥ë³„ ëŒ€í‘œ ì„œëª… ê°€ì ¸ì˜¤ê¸°
        const stores = JSON.parse(localStorage.getItem('stores') || '[]');
        const store = stores.find(s => s.name === contract.workStore);
        const ceoSignature = store?.ceoSignature || '';
        
        signatureHtml = `
          <div style="margin-top: 50px;">
            <p style="margin-bottom: 20px; font-size: 16px; text-align: center;"><strong>ì„œëª…ì¼: ${signDate.toLocaleDateString('ko-KR')}</strong></p>
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 40px;">
              <!-- ì‚¬ìš©ì(ëŒ€í‘œ) ì„œëª… -->
              <div style="flex: 1; text-align: center;">
                ${ceoSignature ? `
                  <img src="${ceoSignature}" alt="ëŒ€í‘œ ì„œëª…" style="width: 200px; height: 80px; display: block; margin: 0 auto; object-fit: contain;">
                ` : `
                  <div style="width: 200px; height: 80px; border: 2px dashed #ddd; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: #999;">
                    <span>ëŒ€í‘œ ì„œëª… ë¯¸ë“±ë¡</span>
                  </div>
                `}
                <p style="margin-top: 8px; font-weight: 600; font-size: 14px;">ì‚¬ìš©ì: ${contract.companyCEO || contract.companyName} (ì¸)</p>
              </div>
              
              <!-- ê·¼ë¡œì ì„œëª… -->
              <div style="flex: 1; text-align: center;">
                <img src="${signedContract.signature}" alt="ê·¼ë¡œì ì„œëª…" style="width: 200px; height: 80px; display: block; margin: 0 auto; object-fit: contain;" onerror="console.error('âŒ ì„œëª… ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨!', this.src.substring(0,50))">
                <p style="margin-top: 8px; font-weight: 600; font-size: 14px;">ê·¼ë¡œì: ${contract.employeeName} (ì„œëª…)</p>
              </div>
            </div>
          </div>
        `;
      } else {
        console.log('âš ï¸ ì„œëª… ì—†ìŒ');
        signatureHtml = `
          <div style="margin-top: 50px; text-align: right; padding: 20px; background: #fff3cd; border: 2px dashed #ffc107; border-radius: 4px;">
            <p style="color: #856404; font-weight: 600;">âš ï¸ ì•„ì§ ì„œëª…ë˜ì§€ ì•Šì€ ê³„ì•½ì„œì…ë‹ˆë‹¤.</p>
          </div>
        `;
      }
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 1000px; max-height: 95vh; overflow-y: auto; padding: 0;">
          <!-- ìƒë‹¨ ì»¨íŠ¸ë¡¤ ë°” (ì¸ì‡„ ì‹œ ìˆ¨ê¹€) -->
          <div id="contractControls" style="position: sticky; top: 0; background: white; z-index: 100; padding: 16px; border-bottom: 2px solid #ddd; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 20px;">ğŸ“„ ê³„ì•½ì„œ ìƒì„¸ë³´ê¸°</h3>
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-primary" onclick="downloadContractPDF('${contract.id}')">ğŸ“¥ PDF ì €ì¥</button>
              <button class="btn btn-secondary" onclick="printContract()">ğŸ–¨ï¸ ì¸ì‡„</button>
              <button class="btn" style="background: #6c757d; color: white;" onclick="closeContractViewModal()">âœ• ë‹«ê¸°</button>
            </div>
          </div>
          
          <!-- ë“œë¡­ë‹¤ìš´ (ì¸ì‡„ ì‹œ ìˆ¨ê¹€) -->
          <div id="contractSelector" style="padding: 0 40px; padding-top: 20px;">
            ${contractSelectorHtml}
          </div>
          
          <!-- A4 ê³„ì•½ì„œ ë³¸ë¬¸ -->
          <div id="contractPrintArea" style="width: 190mm; margin: 0 auto; background: white;">
            
            <!-- 1í˜ì´ì§€: ê³„ì•½ì„œ í…Œì´ë¸” -->
            <div>
              <!-- ê³„ì•½ì„œ ì œëª© -->
              <h1 style="text-align: center; font-size: 32px; font-weight: 700; letter-spacing: 12px; margin: 0 0 30px 0;">ê·¼ ë¡œ ê³„ ì•½ ì„œ</h1>
              
              <!-- ì„œë¬¸ -->
              <p style="line-height: 1.8; margin-bottom: 25px; font-size: 14px;">
                <strong>${contract.companyName}</strong> (ì´í•˜ "ì‚¬ìš©ì"ë¼ í•¨)ì™€ <strong>${contract.employeeName}</strong> (ì´í•˜ "ê·¼ë¡œì"ë¼ í•¨)ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê·¼ë¡œê³„ì•½ì„ ì²´ê²°í•œë‹¤.
              </p>
              
              <!-- ê³„ì•½ ë‚´ìš© í…Œì´ë¸” -->
              <table style="width: 100%; border-collapse: collapse; margin-bottom: 25px; font-size: 13px;">
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; width: 25%; text-align: left;">ê·¼ë¡œì ì •ë³´</th>
                  <td style="border: 1px solid #333; padding: 10px; line-height: 1.8;">
                    <div>ì„±ëª…: ${contract.employeeName}</div>
                    <div>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸: ${contract.employeeBirth}</div>
                    <div>ì£¼ì†Œ: ${contract.employeeAddress}</div>
                    <div>ì—°ë½ì²˜: ${contract.employeePhone}</div>
                  </td>
                </tr>
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; text-align: left;">ì‚¬ìš©ì ì •ë³´</th>
                  <td style="border: 1px solid #333; padding: 10px; line-height: 1.8;">
                    <div>íšŒì‚¬ëª…: ${contract.companyName}</div>
                    <div>ëŒ€í‘œì: ${contract.companyCEO || '-'}</div>
                    <div>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: ${contract.companyBusinessNumber || '-'}</div>
                    <div>ì—°ë½ì²˜: ${contract.companyPhone || '-'}</div>
                    <div>ì£¼ì†Œ: ${contract.companyAddress || '-'}</div>
                  </td>
                </tr>
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; text-align: left;">ê³„ì•½ ê¸°ê°„</th>
                  <td style="border: 1px solid #333; padding: 10px;">${contract.startDate} ~ ${contract.endDate}</td>
                </tr>
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; text-align: left;">ê·¼ë¬´ ì¥ì†Œ</th>
                  <td style="border: 1px solid #333; padding: 10px;">${contract.workStore}</td>
                </tr>
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; text-align: left;">ì—…ë¬´ ë‚´ìš©</th>
                  <td style="border: 1px solid #333; padding: 10px;">${contract.position}</td>
                </tr>
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; text-align: left;">ê·¼ë¬´ ì¼ì‹œ</th>
                  <td style="border: 1px solid #333; padding: 10px; line-height: 1.8;">
                    <div>ê·¼ë¬´ì¼: ${contract.workDays}</div>
                    <div>ê·¼ë¬´ì‹œê°„: ${contract.workTime}</div>
                    <div>íœ´ê²Œì‹œê°„: ${contract.breakTime || 'ê·¼ë¡œê¸°ì¤€ë²• ì¤€ìˆ˜'}</div>
                  </td>
                </tr>
                <tr>
                  <th style="border: 1px solid #333; padding: 10px; background: #f5f5f5; font-weight: 600; text-align: left;">ê¸‰ì—¬ ì¡°ê±´</th>
                  <td style="border: 1px solid #333; padding: 10px; line-height: 1.8;">
                    <div>${contract.wageType}: ${contract.wageAmount}ì›</div>
                    <div>ì§€ê¸‰ì¼: ${contract.paymentDay || 'ë§¤ì›” ë§ì¼'}</div>
                    <div>ì§€ê¸‰ë°©ë²•: ${contract.paymentMethod || 'ê³„ì¢Œì´ì²´'}</div>
                  </td>
                </tr>
              </table>
            </div>
            
            <!-- 2í˜ì´ì§€ë¶€í„°: ê³„ì•½ ë³¸ë¬¸ + ì„œëª…ë€ -->
            <div class="page-break-before">
              <!-- ê³„ì•½ì„œ ë³¸ë¬¸ (contractContent ë˜ëŠ” contractBody) -->
              ${(contract.contractContent || contract.contractBody) ? `
                <div style="white-space: pre-line; line-height: 1.8; margin-bottom: 25px; font-size: 13px; border: 1px solid #ddd; padding: 15px; background: #fafafa;">
                  ${contract.contractContent || contract.contractBody}
                </div>
              ` : ''}
              
              <!-- ê³„ì•½ ì¼ì -->
              <p style="text-align: center; margin-top: 40px; margin-bottom: 50px; font-size: 16px; font-weight: 600;">
                ${contract.contractDate || new Date(contract.createdAt).toLocaleDateString('ko-KR')}
              </p>
              
              <!-- ì„œëª…ë€ -->
              ${signatureHtml}
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function closeContractViewModal() {
      const modal = document.getElementById('contractViewModal');
      if (modal) modal.remove();
    }
    
    // ê³„ì•½ì„œ ë²„ì „ ì „í™˜ í•¨ìˆ˜
    window.switchContractVersion = function(contractId) {
      closeContractViewModal();
      viewContract(contractId);
    };
    
    // ì¸ì‡„ ê¸°ëŠ¥
    window.printContract = function() {
      window.print();
    };
    
    // PDF ì €ì¥ ê¸°ëŠ¥ (html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)
    window.downloadContractPDF = function(contractId) {
      const contractArea = document.getElementById('contractPrintArea');
      if (!contractArea) {
        alert('âŒ ê³„ì•½ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // html2pdf ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
      if (typeof html2pdf === 'undefined') {
        // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë“œ
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
        script.onload = function() {
          generatePDF(contractArea, contractId);
        };
        document.head.appendChild(script);
      } else {
        generatePDF(contractArea, contractId);
      }
    };
    
    async function generatePDF(element, contractId) {
      const contractData = localStorage.getItem(`contract_${contractId}`);
      if (!contractData) return;
      
      const contract = JSON.parse(contractData);
      const fileName = `ê·¼ë¡œê³„ì•½ì„œ_${contract.employeeName}_${new Date().toISOString().split('T')[0]}.pdf`;
      
      // ğŸ” ë””ë²„ê¹…: element ë‚´ìš© í™•ì¸
      console.log('ğŸ” PDF ìƒì„± ì˜ì—­:', element);
      console.log('ğŸ” element HTML ê¸¸ì´:', element.innerHTML.length);
      
      // ğŸ”¥ ì„œëª… ë°ì´í„°ë¥¼ localStorageì—ì„œ ì§ì ‘ ê°€ì ¸ì™€ì„œ ë‹¤ì‹œ ì£¼ì…
      const signedContracts = signedContractsCache;
      const signedContract = signedContracts.find(sc => sc.id === contract.id);
      
      console.log('ğŸ” ì„œëª… ë°ì´í„° ì¡´ì¬:', !!signedContract);
      if (signedContract) {
        console.log('ğŸ” ì„œëª… ì´ë¯¸ì§€ ê¸¸ì´:', signedContract.signature?.length || 0);
        console.log('ğŸ” ì„œëª… ì´ë¯¸ì§€ ì‹œì‘:', signedContract.signature?.substring(0, 50) || 'N/A');
      }
      
      // ğŸ”¥ ì„œëª…ì´ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ë‹¤ì‹œ ê·¸ë ¤ë„£ê¸° (ì‚¬ìš©ì + ê·¼ë¡œì ì–‘ìª½)
      if (signedContract && signedContract.signature) {
        // ê¸°ì¡´ ì„œëª… ì œê±°
        element.querySelectorAll('.avoid-page-break').forEach(div => {
          if (div.querySelector('img[alt="ì„œëª…"], img[alt="ê·¼ë¡œì ì„œëª…"], img[alt="ëŒ€í‘œ ì„œëª…"]')) {
            div.remove();
          }
        });
        
        // ë§¤ì¥ë³„ ëŒ€í‘œ ì„œëª… ê°€ì ¸ì˜¤ê¸°
        const stores = JSON.parse(localStorage.getItem('stores') || '[]');
        const store = stores.find(s => s.name === contract.workStore);
        const ceoSignature = store?.ceoSignature || '';
        
        const signDate = new Date(signedContract.signedAt);
        const signatureHtml = `
          <div class="avoid-page-break" style="margin-top: 60px; page-break-inside: avoid;">
            <p style="margin-bottom: 20px; font-size: 16px; text-align: center;"><strong>ì„œëª…ì¼: ${signDate.toLocaleDateString('ko-KR')}</strong></p>
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 40px;">
              <!-- ì‚¬ìš©ì(ëŒ€í‘œ) ì„œëª… -->
              <div style="flex: 1; text-align: center;">
                ${ceoSignature ? `
                  <img src="${ceoSignature}" alt="ëŒ€í‘œ ì„œëª…" style="width: 200px; height: 80px; display: block; margin: 0 auto; object-fit: contain;">
                ` : `
                  <div style="width: 200px; height: 80px; border: 2px dashed #ddd; display: flex; align-items: center; justify-content: center; margin: 0 auto; color: #999; font-size: 12px;">
                    ëŒ€í‘œ ì„œëª… ë¯¸ë“±ë¡
                  </div>
                `}
                <p style="margin-top: 8px; font-weight: 600; font-size: 14px;">ì‚¬ìš©ì: ${contract.companyCEO || contract.companyName} (ì¸)</p>
              </div>
              
              <!-- ê·¼ë¡œì ì„œëª… -->
              <div style="flex: 1; text-align: center;">
                <img src="${signedContract.signature}" alt="ê·¼ë¡œì ì„œëª…" style="width: 200px; height: 80px; display: block; margin: 0 auto; object-fit: contain;">
                <p style="margin-top: 8px; font-weight: 600; font-size: 14px;">ê·¼ë¡œì: ${contract.employeeName} (ì„œëª…)</p>
              </div>
            </div>
          </div>
        `;
        element.insertAdjacentHTML('beforeend', signatureHtml);
        console.log('âœ… ì–‘ìª½ ì„œëª… ì¬ì£¼ì… ì™„ë£Œ');
      }
      
      // PDF ìƒì„± ì‹œì‘ ì•Œë¦¼
      const loadingDiv = document.createElement('div');
      loadingDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10000; text-align: center;';
      loadingDiv.innerHTML = '<p style="margin: 0; font-size: 16px; font-weight: 600;">ğŸ“„ PDF ìƒì„± ì¤‘...</p><p style="margin-top: 8px; font-size: 14px; color: #666;">ì„œëª… ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘...</p>';
      document.body.appendChild(loadingDiv);
      
      // PDF ìƒì„± ì „ padding ì œê±° (marginìœ¼ë¡œ ëŒ€ì²´)
      const originalPadding = element.style.padding;
      element.style.padding = '0';
      
      // 500ms ëŒ€ê¸°
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const opt = {
        margin: 10, // ìƒí•˜ì¢Œìš° 1cm (10mm)
        filename: fileName,
        image: { 
          type: 'jpeg', 
          quality: 0.98 
        },
        html2canvas: { 
          scale: 2,
          useCORS: false, // Blob URLì€ CORS ë¶ˆí•„ìš”
          logging: true,
          letterRendering: true,
          imageTimeout: 0 // Blob URLì€ ì¦‰ì‹œ ë¡œë“œ
        },
        jsPDF: { 
          unit: 'mm', 
          format: 'a4', 
          orientation: 'portrait',
          compress: true
        },
        pagebreak: { 
          mode: 'css',  // CSS ëª¨ë“œë§Œ ì‚¬ìš© (ìì—°ìŠ¤ëŸ¬ìš´ í˜ì´ì§€ ë‚˜ëˆ„ê¸°)
          before: '.page-break-before',
          after: '.page-break-after'
        }
      };
      
      html2pdf().set(opt).from(element).save().then(() => {
        // padding ë³µì›
        element.style.padding = originalPadding;
        document.body.removeChild(loadingDiv);
        console.log('âœ… PDF ìƒì„± ì™„ë£Œ:', fileName);
        alert('âœ… PDF ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!');
      }).catch(err => {
        // padding ë³µì›
        element.style.padding = originalPadding;
        document.body.removeChild(loadingDiv);
        console.error('âŒ PDF ìƒì„± ì‹¤íŒ¨:', err);
        alert('âŒ PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:\n' + err.message);
      });
    }

    function copySignLink(link) {
      const tempInput = document.createElement('input');
      tempInput.value = link;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      alert('âœ… ì„œëª… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function sendContractLink(id) {
      const contractData = localStorage.getItem(`contract_${id}`);
      if (!contractData) {
        alert('âš ï¸ ê³„ì•½ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      try {
        const contract = JSON.parse(contractData);
        // ì„œëª… ë§í¬ ìƒì„± - í˜„ì¬ ë””ë ‰í† ë¦¬ ê¸°ì¤€
        const currentPath = window.location.pathname;
        const directory = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
        const signLink = `${window.location.origin}${directory}contract-sign.html?id=${id}`;
        
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.style.display = 'flex';
        modal.id = 'sendLinkModal';
        
        modal.innerHTML = `
          <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
              <h3>ğŸ“§ ì„œëª… ë§í¬ ì „ì†¡</h3>
              <button class="modal-close" onclick="closeSendLinkModal()">âœ•</button>
            </div>
            <div class="modal-body">
              <p style="margin-bottom: 16px;"><strong>${contract.employeeName}</strong>ë‹˜ê»˜ ì„œëª… ë§í¬ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.</p>
              <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">ğŸ“± ì—°ë½ì²˜</label>
                <input type="tel" value="${contract.employeePhone}" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-light);">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">ğŸ”— ì„œëª… ë§í¬</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="linkToCopy" value="${signLink}" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 13px;">
                  <button class="btn btn-primary btn-sm" onclick="copyLinkToSend()">ğŸ“‹ ë³µì‚¬</button>
                </div>
              </div>
              <div style="padding: 16px; background: #fff3cd; border-radius: 4px; border: 1px solid #ffc107;">
                <p style="margin: 0; font-size: 14px;">ğŸ’¡ <strong>ë§í¬ ë³µì‚¬ í›„</strong> ì¹´ì¹´ì˜¤í†¡, ë¬¸ì ë“±ìœ¼ë¡œ ì§ì›ì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”.</p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" onclick="closeSendLinkModal()">ë‹«ê¸°</button>
              <button class="btn btn-primary" onclick="copyAndClose()">ğŸ“‹ ë³µì‚¬í•˜ê³  ë‹«ê¸°</button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
      } catch (e) {
        alert('âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function closeSendLinkModal() {
      const modal = document.getElementById('sendLinkModal');
      if (modal) modal.remove();
    }

    function copyLinkToSend() {
      const input = document.getElementById('linkToCopy');
      input.select();
      document.execCommand('copy');
      alert('âœ… ì„œëª… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function copyAndClose() {
      copyLinkToSend();
      setTimeout(() => closeSendLinkModal(), 500);
    }

    async function loadAttendanceList() {
      console.log('ğŸ” loadAttendanceList í˜¸ì¶œë¨');
      
      const tbody = document.getElementById('attendanceTableBody');
      if (!tbody) {
        console.log('âŒ attendanceTableBody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">ê·¼íƒœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        console.log('ğŸ” Firestore ì¿¼ë¦¬ ì‹œì‘: attendance ì»¬ë ‰ì…˜');
        
        // Firestoreì—ì„œ ê·¼íƒœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const attendanceSnapshot = await firebase.firestore().collection('attendance')
          .orderBy('date', 'desc')
          .limit(100)
          .get();
        
        console.log('ğŸ“Š ì¡°íšŒ ê²°ê³¼:', {
          empty: attendanceSnapshot.empty,
          size: attendanceSnapshot.size,
          docs: attendanceSnapshot.docs.length
        });
        
        if (attendanceSnapshot.empty) {
          console.warn('âš ï¸ attendance ì»¬ë ‰ì…˜ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
          tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">ê·¼íƒœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }
        
        let attendanceList = [];
        attendanceSnapshot.forEach(doc => {
          const data = doc.data();
          console.log('ğŸ“„ ë¬¸ì„œ ë°ì´í„°:', { id: doc.id, data });
          attendanceList.push({ id: doc.id, ...data });
        });
        
        console.log('âœ… ì´ ê·¼íƒœ ê¸°ë¡:', attendanceList.length);
        
        // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§
        const monthFilter = document.getElementById('attendanceMonth').value;
        const storeFilter = document.getElementById('attendanceStoreFilter').value;
        
        if (monthFilter) {
          attendanceList = attendanceList.filter(att => {
            return att.date && att.date.startsWith(monthFilter);
          });
          console.log(`ğŸ“… ì›” í•„í„° ì ìš© (${monthFilter}):`, attendanceList.length);
        }
        
        if (storeFilter) {
          attendanceList = attendanceList.filter(att => att.store === storeFilter);
          console.log(`ğŸª ë§¤ì¥ í•„í„° ì ìš© (${storeFilter}):`, attendanceList.length);
        }
        
        if (attendanceList.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">ì¡°ê±´ì— ë§ëŠ” ê·¼íƒœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }
        
        tbody.innerHTML = attendanceList.map(att => {
          const statusClass = att.status === 'ì •ìƒ' ? 'success' : 
                              att.status === 'ì§€ê°' ? 'warning' : 
                              att.status === 'ì¡°í‡´' ? 'info' : 'danger';
          return `
            <tr>
              <td>${att.date || '-'}</td>
              <td>${att.employeeName || att.name || '-'}</td>
              <td>${att.store || '-'}</td>
              <td>${att.clockIn || '-'}</td>
              <td>${att.clockOut || '-'}</td>
              <td>${att.workType || 'ì •ê·œê·¼ë¬´'}</td>
              <td><span class="badge badge-${statusClass}">${att.status || 'ì •ìƒ'}</span></td>
              <td>
                <button class="btn btn-sm btn-secondary" onclick="alert('ê·¼íƒœ ${att.id} ìƒì„¸ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •')">ìƒì„¸</button>
              </td>
            </tr>
          `;
        }).join('');
      } catch (error) {
        console.error('âŒ ê·¼íƒœ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--danger-color);">âŒ ê·¼íƒœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }

    // ===========================================
    // ê¸‰ì—¬ ê³„ì‚° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    // ===========================================
    
    /**
     * ì‹œê°„ ë¬¸ìì—´ì„ ë¶„ ë‹¨ìœ„ë¡œ ë³€í™˜
     * @param {string} timeStr - "HH:MM" í˜•ì‹
     * @returns {number} ì´ ë¶„
     */
    function timeToMinutes(timeStr) {
      if (!timeStr || typeof timeStr !== 'string') return 0;
      const [hours, minutes] = timeStr.split(':').map(Number);
      return (hours || 0) * 60 + (minutes || 0);
    }
    
    /**
     * ë‘ ì‹œê°„ ì‚¬ì´ì˜ ì°¨ì´ë¥¼ ì‹œê°„ ë‹¨ìœ„ë¡œ ê³„ì‚°
     * @param {string} startTime - "HH:MM"
     * @param {string} endTime - "HH:MM"
     * @returns {number} ì‹œê°„ (ì†Œìˆ˜ì )
     */
    function calculateWorkHours(startTime, endTime) {
      const startMinutes = timeToMinutes(startTime);
      let endMinutes = timeToMinutes(endTime);
      
      // ìì •ì„ ë„˜ì–´ê°€ëŠ” ê²½ìš° ì²˜ë¦¬
      if (endMinutes < startMinutes) {
        endMinutes += 24 * 60;
      }
      
      return (endMinutes - startMinutes) / 60;
    }
    
    /**
     * ì•¼ê°„ ê·¼ë¬´ ì‹œê°„ ê³„ì‚° (22:00~06:00)
     * @param {string} startTime - "HH:MM"
     * @param {string} endTime - "HH:MM"
     * @returns {number} ì•¼ê°„ ê·¼ë¬´ ì‹œê°„
     */
    function calculateNightHours(startTime, endTime) {
      const start = timeToMinutes(startTime);
      let end = timeToMinutes(endTime);
      
      if (end < start) end += 24 * 60;
      
      const nightStart = 22 * 60; // 22:00
      const nightEnd = (24 + 6) * 60; // ë‹¤ìŒë‚  06:00
      
      let nightMinutes = 0;
      
      // 22:00~24:00 êµ¬ê°„
      const overlap1Start = Math.max(start, nightStart);
      const overlap1End = Math.min(end, 24 * 60);
      if (overlap1Start < overlap1End) {
        nightMinutes += overlap1End - overlap1Start;
      }
      
      // 00:00~06:00 êµ¬ê°„
      if (end > 24 * 60) {
        const overlap2Start = Math.max(start, 24 * 60);
        const overlap2End = Math.min(end, nightEnd);
        if (overlap2Start < overlap2End) {
          nightMinutes += overlap2End - overlap2Start;
        }
      }
      
      return nightMinutes / 60;
    }
    
    /**
     * í•œ ë‹¬ê°„ ì§ì›ì˜ ê¸‰ì—¬ ê³„ì‚°
     * @param {object} employee - ì§ì› ì •ë³´
     * @param {object} contract - ê³„ì•½ì„œ ì •ë³´
     * @param {array} attendances - ì¶œí‡´ê·¼ ê¸°ë¡ ë°°ì—´
     * @param {string} yearMonth - "YYYY-MM" í˜•ì‹
     * @returns {object} ê¸‰ì—¬ ìƒì„¸ ë‚´ì—­
     */
    async function calculateMonthlySalary(employee, contract, attendances, yearMonth) {
      console.log('ğŸ’° ê¸‰ì—¬ ê³„ì‚° ì‹œì‘:', employee.name, yearMonth);
      
      const result = {
        employeeName: employee.name,
        employeeUid: employee.uid,
        storeName: employee.store || contract.workStore,
        yearMonth: yearMonth,
        
        // ê¸°ë³¸ ì •ë³´
        hourlyWage: 0,
        totalWorkHours: 0,
        
        // ì§€ê¸‰ í•­ëª©
        basePay: 0,
        overtimePay: 0,
        nightPay: 0,
        holidayPay: 0,
        weeklyHolidayPay: 0,
        totalAllowances: 0,
        
        // ê³µì œ í•­ëª©
        nationalPension: 0,
        healthInsurance: 0,
        longTermCare: 0,
        employmentInsurance: 0,
        incomeTax: 0,
        totalDeductions: 0,
        
        // ìµœì¢… ê¸ˆì•¡
        totalPay: 0,
        netPay: 0,
        
        // ìƒì„¸ ì •ë³´
        workDays: 0,
        attendanceDetails: []
      };
      
      // ì‹œê¸‰ í™•ì¸
      if (contract.wageType !== 'ì‹œê¸‰') {
        console.log('âš ï¸ ì‹œê¸‰ì œê°€ ì•„ë‹˜. í˜„ì¬ëŠ” ì‹œê¸‰ì œë§Œ ì§€ì›');
        return result;
      }
      
      result.hourlyWage = parseFloat(contract.wageAmount) || 0;
      
      if (result.hourlyWage === 0) {
        console.log('âš ï¸ ì‹œê¸‰ì´ 0ì›');
        return result;
      }
      
      // ì¶œí‡´ê·¼ ê¸°ë¡ ë¶„ì„
      let totalWorkHours = 0;
      let totalOvertimeHours = 0;
      let totalNightHours = 0;
      let totalHolidayHours = 0;
      let weeklyWorkHours = {}; // ì£¼ì°¨ë³„ ê·¼ë¬´ì‹œê°„
      
      attendances.forEach(att => {
        if (att.status !== 'completed') return;
        
        const workHours = calculateWorkHours(att.checkIn, att.checkOut);
        const nightHours = calculateNightHours(att.checkIn, att.checkOut);
        
        totalWorkHours += workHours;
        result.workDays++;
        
        // ì•¼ê°„ ê·¼ë¬´ ì‹œê°„
        if (contract.allowances?.night && nightHours > 0) {
          totalNightHours += nightHours;
        }
        
        // ì£¼ì°¨ë³„ ê·¼ë¬´ì‹œê°„ ëˆ„ì  (ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚°ìš©)
        const date = new Date(att.date);
        const weekKey = getWeekOfMonth(date);
        weeklyWorkHours[weekKey] = (weeklyWorkHours[weekKey] || 0) + workHours;
        
        result.attendanceDetails.push({
          date: att.date,
          checkIn: att.checkIn,
          checkOut: att.checkOut,
          workHours: workHours.toFixed(2),
          nightHours: nightHours.toFixed(2)
        });
      });
      
      result.totalWorkHours = totalWorkHours;
      
      // ê¸°ë³¸ê¸‰ ê³„ì‚°
      result.basePay = Math.round(result.hourlyWage * totalWorkHours);
      
      // ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹ (ì£¼ 40ì‹œê°„ ì´ˆê³¼ë¶„) - ê³„ì•½ì„œì— ì„¤ì •ëœ ê²½ìš°ë§Œ
      if (contract.allowances?.overtime) {
        Object.values(weeklyWorkHours).forEach(weekHours => {
          if (weekHours > 40) {
            totalOvertimeHours += (weekHours - 40);
          }
        });
        result.overtimePay = Math.round(result.hourlyWage * 1.5 * totalOvertimeHours);
      }
      
      // ì•¼ê°„ê·¼ë¡œìˆ˜ë‹¹ - ê³„ì•½ì„œì— ì„¤ì •ëœ ê²½ìš°ë§Œ
      if (contract.allowances?.night && totalNightHours > 0) {
        result.nightPay = Math.round(result.hourlyWage * 0.5 * totalNightHours);
      }
      
      // íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹ - ê³„ì•½ì„œì— ì„¤ì •ëœ ê²½ìš°ë§Œ (í˜„ì¬ëŠ” 0)
      if (contract.allowances?.holiday) {
        result.holidayPay = 0; // TODO: íœ´ì¼ ê·¼ë¬´ íŒë³„ ë¡œì§ í•„ìš”
      }
      
      // ì£¼íœ´ìˆ˜ë‹¹ - ì£¼ 15ì‹œê°„ ì´ìƒ ê·¼ë¬´í•œ ì£¼ì— ëŒ€í•´ì„œë§Œ
      if (contract.allowances?.weeklyHoliday) {
        let weeklyHolidayHours = 0;
        Object.values(weeklyWorkHours).forEach(weekHours => {
          if (weekHours >= 15) {
            // ì£¼íœ´ìˆ˜ë‹¹ = (ì£¼ ê·¼ë¬´ì‹œê°„ / 40) Ã— 8ì‹œê°„
            weeklyHolidayHours += (weekHours / 40) * 8;
          }
        });
        result.weeklyHolidayPay = Math.round(result.hourlyWage * weeklyHolidayHours);
      }
      
      // ì´ ìˆ˜ë‹¹
      result.totalAllowances = result.overtimePay + result.nightPay + result.holidayPay + result.weeklyHolidayPay;
      
      // ì´ ì§€ê¸‰ì•¡ (ê³µì œ ì „)
      result.totalPay = result.basePay + result.totalAllowances;
      
      // 4ëŒ€ë³´í—˜ ê³µì œ ê³„ì‚°
      const insuranceType = contract.insurance?.type || 'none';
      
      if (insuranceType === 'all') {
        // ì „ì²´ ì ìš©
        result.nationalPension = Math.round(result.totalPay * 0.045); // 4.5%
        result.healthInsurance = Math.round(result.totalPay * 0.03545); // 3.545%
        result.longTermCare = Math.round(result.healthInsurance * 0.1295); // ê±´ê°•ë³´í—˜ì˜ 12.95%
        result.employmentInsurance = Math.round(result.totalPay * 0.009); // 0.9%
        result.incomeTax = Math.round(result.totalPay * 0.033); // 3.3%
      } else if (insuranceType === 'employment_only') {
        // ê³ ìš©Â·ì‚°ì¬ë³´í—˜ë§Œ
        result.employmentInsurance = Math.round(result.totalPay * 0.009); // 0.9%
        result.incomeTax = Math.round(result.totalPay * 0.033); // 3.3%
      } else if (insuranceType === 'freelancer') {
        // í”„ë¦¬ëœì„œ - ì†Œë“ì„¸ë§Œ
        result.incomeTax = Math.round(result.totalPay * 0.033); // 3.3%
      }
      // 'none'ì¸ ê²½ìš° ê³µì œ ì—†ìŒ
      
      result.totalDeductions = result.nationalPension + result.healthInsurance + 
                               result.longTermCare + result.employmentInsurance + result.incomeTax;
      
      // ì‹¤ì§€ê¸‰ì•¡
      result.netPay = result.totalPay - result.totalDeductions;
      
      console.log('âœ… ê¸‰ì—¬ ê³„ì‚° ì™„ë£Œ:', result);
      return result;
    }
    
    /**
     * ë‚ ì§œê°€ ì†í•œ ì£¼ì°¨ êµ¬í•˜ê¸° (ì›” ê¸°ì¤€)
     * @param {Date} date
     * @returns {string} "YYYY-MM-Wì£¼ì°¨"
     */
    function getWeekOfMonth(date) {
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekNum = Math.ceil(day / 7);
      return `${year}-${month.toString().padStart(2, '0')}-W${weekNum}`;
    }
    
    // ===========================================
    // ê¸‰ì—¬ ê´€ë¦¬ UI í•¨ìˆ˜ë“¤
    // ===========================================
    
    async function loadSalaryList() {
      const tbody = document.getElementById('salaryTableBody');
      if (!tbody) return;
      
      const monthInput = document.getElementById('salaryMonth');
      const yearMonth = monthInput.value;
      
      if (!yearMonth) {
        alert('âš ï¸ ì¡°íšŒí•  ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">ê¸‰ì—¬ ê³„ì‚° ì¤‘...</td></tr>';
      
      try {
        console.log('ğŸ’° ê¸‰ì—¬ ì¡°íšŒ ì‹œì‘:', yearMonth);
        
        // ëª¨ë“  ì§ì› ê°€ì ¸ì˜¤ê¸°
        const employeesSnapshot = await firebase.firestore().collection('users')
          .where('role', '==', 'employee')
          .get();
        
        if (employeesSnapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }
        
        const salaryData = [];
        
        for (const empDoc of employeesSnapshot.docs) {
          const employee = { uid: empDoc.id, ...empDoc.data() };
          
          // í•´ë‹¹ ì§ì›ì˜ ê³„ì•½ì„œ ì°¾ê¸°
          const contractsSnapshot = await firebase.firestore().collection('contracts')
            .where('employeeName', '==', employee.name)
            .orderBy('createdAt', 'desc')
            .limit(1)
            .get();
          
          if (contractsSnapshot.empty) {
            console.log('âš ï¸ ê³„ì•½ì„œ ì—†ìŒ:', employee.name);
            continue;
          }
          
          const contract = contractsSnapshot.docs[0].data();
          
          // í•´ë‹¹ ì›”ì˜ ì¶œí‡´ê·¼ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
          const [year, month] = yearMonth.split('-');
          const startDate = `${year}-${month}-01`;
          const endDate = `${year}-${month}-${new Date(year, month, 0).getDate()}`;
          
          const attendancesSnapshot = await firebase.firestore().collection('attendance')
            .where('uid', '==', employee.uid)
            .where('date', '>=', startDate)
            .where('date', '<=', endDate)
            .get();
          
          const attendances = [];
          attendancesSnapshot.forEach(doc => {
            attendances.push(doc.data());
          });
          
          // ê¸‰ì—¬ ê³„ì‚°
          const salary = await calculateMonthlySalary(employee, contract, attendances, yearMonth);
          salaryData.push(salary);
        }
        
        // Firestoreì—ì„œ í™•ì •ëœ ê¸‰ì—¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const confirmedSalaries = {};
        const salariesSnapshot = await firebase.firestore().collection('salaries')
          .where('yearMonth', '==', yearMonth)
          .get();
        
        salariesSnapshot.forEach(doc => {
          const data = doc.data();
          confirmedSalaries[data.employeeUid] = {
            status: data.status || 'confirmed',
            paid: data.paid || false,
            docId: doc.id
          };
        });
        
        // í…Œì´ë¸” ë Œë”ë§
        if (salaryData.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">ê¸‰ì—¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }
        
        tbody.innerHTML = salaryData.map(salary => {
          const confirmed = confirmedSalaries[salary.employeeUid];
          const isConfirmed = !!confirmed;
          const isPaid = confirmed?.paid || false;
          
          let statusBadge = '<span class="badge badge-warning">ë¯¸í™•ì •</span>';
          if (isConfirmed && isPaid) {
            statusBadge = '<span class="badge badge-success">ì§€ê¸‰ì™„ë£Œ</span>';
          } else if (isConfirmed) {
            statusBadge = '<span class="badge badge-info">í™•ì •ë¨</span>';
          }
          
          let actionButtons = `<button class="btn btn-sm btn-secondary" onclick="showSalaryDetail('${salary.employeeUid}', '${yearMonth}')" style="margin-left: 4px;">ìƒì„¸</button>`;
          
          if (isConfirmed && !isPaid) {
            actionButtons += `<button class="btn btn-sm btn-success" onclick="markAsPaid('${confirmed.docId}')" style="margin-left: 4px;">ì§€ê¸‰ì™„ë£Œ</button>`;
          }
          
          return `
            <tr>
              <td><strong>${salary.employeeName}</strong></td>
              <td>${salary.storeName || '-'}</td>
              <td style="text-align: right;">${salary.basePay.toLocaleString()}ì›</td>
              <td style="text-align: right; color: var(--success-color);">
                +${salary.totalAllowances.toLocaleString()}ì›
              </td>
              <td style="text-align: right; color: var(--danger-color);">
                -${salary.totalDeductions.toLocaleString()}ì›
              </td>
              <td style="text-align: right;">
                <strong style="font-size: 15px;">${salary.netPay.toLocaleString()}ì›</strong>
              </td>
              <td style="text-align: center;">${statusBadge}</td>
              <td style="text-align: center; white-space: nowrap;">${actionButtons}</td>
            </tr>
          `;
        }).join('');
        
        console.log('âœ… ê¸‰ì—¬ ëª©ë¡ ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ ê¸‰ì—¬ ì¡°íšŒ ì‹¤íŒ¨:', error);
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--danger-color);">ê¸‰ì—¬ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    
    // ê¸‰ì—¬ ìƒì„¸ ë³´ê¸° ì „ì—­ ë³€ìˆ˜
    let currentSalaryDetail = null;
    
    async function showSalaryDetail(employeeUid, yearMonth) {
      try {
        console.log('ğŸ’° ê¸‰ì—¬ ìƒì„¸ ì¡°íšŒ:', employeeUid, yearMonth);
        
        // ì§ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const empDoc = await firebase.firestore().collection('users').doc(employeeUid).get();
        if (!empDoc.exists) {
          alert('âŒ ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        const employee = { uid: empDoc.id, ...empDoc.data() };
        
        // ê³„ì•½ì„œ ì°¾ê¸°
        const contractsSnapshot = await firebase.firestore().collection('contracts')
          .where('employeeName', '==', employee.name)
          .orderBy('createdAt', 'desc')
          .limit(1)
          .get();
        
        if (contractsSnapshot.empty) {
          alert('âŒ ê³„ì•½ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        const contract = contractsSnapshot.docs[0].data();
        
        // ì¶œí‡´ê·¼ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
        const [year, month] = yearMonth.split('-');
        const startDate = `${year}-${month}-01`;
        const endDate = `${year}-${month}-${new Date(year, month, 0).getDate()}`;
        
        const attendancesSnapshot = await firebase.firestore().collection('attendance')
          .where('uid', '==', employeeUid)
          .where('date', '>=', startDate)
          .where('date', '<=', endDate)
          .get();
        
        const attendances = [];
        attendancesSnapshot.forEach(doc => {
          attendances.push(doc.data());
        });
        
        // ê¸‰ì—¬ ê³„ì‚°
        const salary = await calculateMonthlySalary(employee, contract, attendances, yearMonth);
        currentSalaryDetail = salary;
        
        // ëª¨ë‹¬ì— ë°ì´í„° í‘œì‹œ
        document.getElementById('salaryDetailName').textContent = salary.employeeName;
        document.getElementById('salaryDetailStore').textContent = salary.storeName || '-';
        document.getElementById('salaryDetailMonth').textContent = yearMonth;
        document.getElementById('salaryDetailWorkDays').textContent = `${salary.workDays}ì¼`;
        
        // ì§€ê¸‰ í•­ëª©
        document.getElementById('salaryDetailHourlyWage').textContent = salary.hourlyWage.toLocaleString();
        document.getElementById('salaryDetailTotalHours').textContent = salary.totalWorkHours.toFixed(1);
        document.getElementById('salaryDetailBasePay').textContent = salary.basePay.toLocaleString() + 'ì›';
        
        // ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹
        if (salary.overtimePay > 0) {
          document.getElementById('salaryDetailOvertimeRow').style.display = '';
          document.getElementById('salaryDetailOvertimePay').textContent = '+' + salary.overtimePay.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailOvertimeRow').style.display = 'none';
        }
        
        // ì•¼ê°„ê·¼ë¡œìˆ˜ë‹¹
        if (salary.nightPay > 0) {
          document.getElementById('salaryDetailNightRow').style.display = '';
          document.getElementById('salaryDetailNightPay').textContent = '+' + salary.nightPay.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailNightRow').style.display = 'none';
        }
        
        // íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹
        if (salary.holidayPay > 0) {
          document.getElementById('salaryDetailHolidayRow').style.display = '';
          document.getElementById('salaryDetailHolidayPay').textContent = '+' + salary.holidayPay.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailHolidayRow').style.display = 'none';
        }
        
        // ì£¼íœ´ìˆ˜ë‹¹
        if (salary.weeklyHolidayPay > 0) {
          document.getElementById('salaryDetailWeeklyRow').style.display = '';
          document.getElementById('salaryDetailWeeklyPay').textContent = '+' + salary.weeklyHolidayPay.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailWeeklyRow').style.display = 'none';
        }
        
        document.getElementById('salaryDetailTotalPay').textContent = salary.totalPay.toLocaleString() + 'ì›';
        
        // ê³µì œ í•­ëª©
        if (salary.nationalPension > 0) {
          document.getElementById('salaryDetailPensionRow').style.display = '';
          document.getElementById('salaryDetailPension').textContent = '-' + salary.nationalPension.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailPensionRow').style.display = 'none';
        }
        
        if (salary.healthInsurance > 0) {
          document.getElementById('salaryDetailHealthRow').style.display = '';
          document.getElementById('salaryDetailHealth').textContent = '-' + salary.healthInsurance.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailHealthRow').style.display = 'none';
        }
        
        if (salary.longTermCare > 0) {
          document.getElementById('salaryDetailLongTermRow').style.display = '';
          document.getElementById('salaryDetailLongTerm').textContent = '-' + salary.longTermCare.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailLongTermRow').style.display = 'none';
        }
        
        if (salary.employmentInsurance > 0) {
          document.getElementById('salaryDetailEmploymentRow').style.display = '';
          document.getElementById('salaryDetailEmployment').textContent = '-' + salary.employmentInsurance.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailEmploymentRow').style.display = 'none';
        }
        
        if (salary.incomeTax > 0) {
          document.getElementById('salaryDetailTaxRow').style.display = '';
          document.getElementById('salaryDetailTax').textContent = '-' + salary.incomeTax.toLocaleString() + 'ì›';
        } else {
          document.getElementById('salaryDetailTaxRow').style.display = 'none';
        }
        
        document.getElementById('salaryDetailTotalDeduction').textContent = salary.totalDeductions.toLocaleString() + 'ì›';
        
        // ì‹¤ì§€ê¸‰ì•¡
        document.getElementById('salaryDetailNetPay').textContent = salary.netPay.toLocaleString() + 'ì›';
        
        // ëª¨ë‹¬ í‘œì‹œ
        document.getElementById('salaryDetailModal').style.display = 'flex';
        
      } catch (error) {
        console.error('âŒ ê¸‰ì—¬ ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:', error);
        alert('ê¸‰ì—¬ ìƒì„¸ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }
    
    function closeSalaryDetailModal() {
      document.getElementById('salaryDetailModal').style.display = 'none';
      currentSalaryDetail = null;
    }
    
    async function confirmSalary() {
      if (!currentSalaryDetail) {
        alert('âš ï¸ ê¸‰ì—¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm('ì´ ê¸‰ì—¬ë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní™•ì • í›„ì—ëŠ” Firestoreì— ì €ì¥ë©ë‹ˆë‹¤.')) {
        return;
      }
      
      try {
        console.log('ğŸ’¾ ê¸‰ì—¬ í™•ì • ì €ì¥ ì‹œì‘:', currentSalaryDetail);
        
        // Firestoreì— ì €ì¥
        const salaryData = {
          ...currentSalaryDetail,
          confirmedAt: firebase.firestore.FieldValue.serverTimestamp(),
          confirmedBy: firebase.auth().currentUser?.uid || 'unknown',
          status: 'confirmed',
          paid: false
        };
        
        // ë¬¸ì„œ ID: employeeUid_yearMonth
        const docId = `${currentSalaryDetail.employeeUid}_${currentSalaryDetail.yearMonth}`;
        
        await firebase.firestore().collection('salaries').doc(docId).set(salaryData);
        
        console.log('âœ… ê¸‰ì—¬ í™•ì • ì™„ë£Œ:', docId);
        alert('âœ… ê¸‰ì—¬ê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
        closeSalaryDetailModal();
        loadSalaryList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ê¸‰ì—¬ í™•ì • ì‹¤íŒ¨:', error);
        alert('ê¸‰ì—¬ í™•ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }
    
    async function markAsPaid(docId) {
      if (!confirm('ì´ ê¸‰ì—¬ë¥¼ ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        console.log('ğŸ’µ ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬:', docId);
        
        await firebase.firestore().collection('salaries').doc(docId).update({
          paid: true,
          paidAt: firebase.firestore.FieldValue.serverTimestamp(),
          paidBy: firebase.auth().currentUser?.uid || 'unknown'
        });
        
        console.log('âœ… ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬ ì„±ê³µ');
        alert('âœ… ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
        loadSalaryList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        alert('ì§€ê¸‰ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    // ê´€ë¦¬ì ëª©ë¡ ë¡œë“œ
    async function loadAdmins() {
      const tbody = document.getElementById('adminsTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">ê´€ë¦¬ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        // Firestoreì—ì„œ ê´€ë¦¬ì/ë§¤ë‹ˆì € ì¡°íšŒ
        const snapshot = await db.collection('users')
          .where('userType', '==', 'admin')
          .get();
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">ë“±ë¡ëœ ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          return;
        }
        
        const admins = [];
        snapshot.forEach(doc => {
          admins.push({
            uid: doc.id,
            ...doc.data()
          });
        });
        
        // ìµœì‹ ìˆœ ì •ë ¬
        admins.sort((a, b) => {
          const aTime = a.createdAt?.toDate?.() || new Date(0);
          const bTime = b.createdAt?.toDate?.() || new Date(0);
          return bTime - aTime;
        });
        
        // ë§¤ë‹ˆì € ê¶Œí•œ ì²´í¬
        const userRole = sessionStorage.getItem('admin_role');
        const isManager = userRole === 'manager';
        
        tbody.innerHTML = admins.map(user => {
          const roleText = user.role === 'admin' ? 'ê´€ë¦¬ì' : 'ë§¤ë‹ˆì €';
          const roleDesc = user.role === 'admin' ? '(ì „ì²´ ê¶Œí•œ)' : '(ì½ê¸° ì „ìš©)';
          const createdDate = user.createdAt?.toDate?.() ? user.createdAt.toDate().toLocaleDateString('ko-KR') : '-';
          
          // ìƒíƒœ ë°°ì§€
          let statusBadge = '';
          if (user.status === 'approved') {
            statusBadge = '<span class="badge badge-success">í™œì„±</span>';
          } else if (user.status === 'pending') {
            statusBadge = '<span class="badge badge-warning" style="background: #ffc107; color: #000;">ìŠ¹ì¸ëŒ€ê¸°</span>';
          } else if (user.status === 'rejected') {
            statusBadge = '<span class="badge badge-danger">ê±°ë¶€ë¨</span>';
          } else {
            statusBadge = '<span class="badge badge-success">í™œì„±</span>';
          }
          
          // ë§¤ë‹ˆì €ëŠ” ì‚­ì œ ë²„íŠ¼ í‘œì‹œ ì•ˆ í•¨
          const deleteButton = !isManager 
            ? `<button class="btn btn-sm" style="background: var(--danger-color, #dc3545); color: white;" onclick="deleteAdmin('${user.uid}', '${user.name}')">
                ğŸ—‘ï¸ ì‚­ì œ
              </button>`
            : '<span style="font-size: 12px; color: var(--text-secondary);">-</span>';
          
          return `
            <tr>
              <td>${user.name || '-'}</td>
              <td style="font-size: 12px; color: var(--text-secondary);">${user.email || '-'}</td>
              <td>${user.phone || '-'}</td>
              <td>
                <span class="badge ${user.role === 'admin' ? 'badge-primary' : 'badge-info'}">
                  ${roleText} ${roleDesc}
                </span>
              </td>
              <td>${statusBadge}</td>
              <td>${createdDate}</td>
              <td>
                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                  ${deleteButton}
                </div>
              </td>
            </tr>
          `;
        }).join('');
        
      } catch (error) {
        console.error('âŒ ê´€ë¦¬ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--danger-color);">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }

    // ìŠ¹ì¸ ê´€ë¦¬ ë¡œë“œ (êµ¬ë§¤/íê¸°/í‡´ì§ì„œ)
    async function loadApprovals() {
      const tbody = document.getElementById('approvalsTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">ìŠ¹ì¸ ëŒ€ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        // Firestoreì—ì„œ ìŠ¹ì¸ ëŒ€ê¸° ë¬¸ì„œ ì¡°íšŒ
        const typeFilter = document.getElementById('approvalTypeFilter')?.value || '';
        const statusFilter = document.getElementById('approvalStatusFilter')?.value || '';
        
        let query = db.collection('approvals');
        
        if (typeFilter) {
          query = query.where('type', '==', typeFilter);
        }
        
        if (statusFilter) {
          query = query.where('status', '==', statusFilter);
        } else {
          // ê¸°ë³¸ì ìœ¼ë¡œ ëŒ€ê¸°ì¤‘ë§Œ í‘œì‹œ
          query = query.where('status', '==', 'pending');
        }
        
        const snapshot = await query.get();
        
        if (snapshot.empty) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px;">
                <div style="color: var(--text-secondary);">
                  <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
                  <p>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                  <p style="font-size: 13px; margin-top: 8px;">ì§ì›ì´ ë¬¸ì„œë¥¼ ì‹ ì²­í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
              </td>
            </tr>
          `;
          return;
        }
        
        const approvals = [];
        snapshot.forEach(doc => {
          approvals.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        // ìµœì‹ ìˆœ ì •ë ¬
        approvals.sort((a, b) => {
          const aTime = a.createdAt?.toDate?.() || new Date(0);
          const bTime = b.createdAt?.toDate?.() || new Date(0);
          return bTime - aTime;
        });
        
        // ë§¤ë‹ˆì € ê¶Œí•œ ì²´í¬
        const userRole = sessionStorage.getItem('admin_role');
        const isManager = userRole === 'manager';
        
        tbody.innerHTML = approvals.map(approval => {
          const typeEmoji = {
            'purchase': 'ğŸ’³',
            'disposal': 'ğŸ—‘ï¸',
            'resignation': 'ğŸ“„'
          };
          
          const typeText = {
            'purchase': 'êµ¬ë§¤',
            'disposal': 'íê¸°',
            'resignation': 'í‡´ì§ì„œ'
          };
          
          const statusBadge = {
            'pending': '<span class="badge badge-warning" style="background: #ffc107; color: #000;">ëŒ€ê¸°ì¤‘</span>',
            'approved': '<span class="badge badge-success">ìŠ¹ì¸ë¨</span>',
            'rejected': '<span class="badge badge-danger">ê±°ë¶€ë¨</span>'
          };
          
          const createdDate = approval.createdAt?.toDate?.() ? approval.createdAt.toDate().toLocaleString('ko-KR') : '-';
          
          // ìš”ì•½ ì •ë³´
          let summary = '';
          if (approval.type === 'purchase') {
            summary = `${approval.data?.item || '-'} (${approval.data?.quantity || '-'}ê°œ)`;
          } else if (approval.type === 'disposal') {
            summary = `${approval.data?.category || '-'}`;
          } else if (approval.type === 'resignation') {
            summary = `í¬ë§ í‡´ì§ì¼: ${approval.data?.resignationDate || '-'}`;
          }
          
          // ë§¤ë‹ˆì €ëŠ” ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ í‘œì‹œ ì•ˆ í•¨
          const actionButtons = !isManager && approval.status === 'pending'
            ? `<div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-sm" style="background: var(--primary-color); color: white;" onclick="viewApprovalDetail('${approval.id}')">
                  ğŸ“„ ìƒì„¸
                </button>
                <button class="btn btn-sm" style="background: var(--success-color, #28a745); color: white;" onclick="approveDocument('${approval.id}', '${approval.type}')">
                  âœ… ìŠ¹ì¸
                </button>
                <button class="btn btn-sm" style="background: var(--danger-color, #dc3545); color: white;" onclick="rejectDocument('${approval.id}')">
                  âŒ ê±°ë¶€
                </button>
              </div>`
            : `<button class="btn btn-sm" style="background: var(--text-secondary); color: white;" onclick="viewApprovalDetail('${approval.id}')">
                ğŸ“„ ìƒì„¸ë³´ê¸°
              </button>`;
          
          return `
            <tr>
              <td>${approval.applicantName || '-'}</td>
              <td>${typeEmoji[approval.type] || ''} ${typeText[approval.type] || '-'}</td>
              <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${summary}</td>
              <td style="font-size: 12px;">${createdDate}</td>
              <td>${statusBadge[approval.status] || '-'}</td>
              <td>${actionButtons}</td>
            </tr>
          `;
        }).join('');
        
      } catch (error) {
        console.error('âŒ ìŠ¹ì¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        console.error('Error details:', error.message);
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 40px;">
              <div style="color: var(--text-secondary);">
                <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“‹</div>
                <p>ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <p style="font-size: 13px; margin-top: 8px; color: var(--text-secondary);">ì§ì›ì´ ë¬¸ì„œë¥¼ ì‹ ì²­í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
              </div>
            </td>
          </tr>
        `;
      }
    }
    
    async function approveEmployee(uid, name) {
      if (!confirm(`${name} ì§ì›ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      try {
        // users ì»¬ë ‰ì…˜ ì—…ë°ì´íŠ¸
        await db.collection('users').doc(uid).update({
          status: 'approved',
          approvedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // employees ì»¬ë ‰ì…˜ë„ ì—…ë°ì´íŠ¸
        await db.collection('employees').doc(uid).update({
          status: 'approved',
          approvedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert(`âœ… ${name} ì§ì›ì˜ ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadEmployees(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
        alert('âŒ ìŠ¹ì¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    async function rejectEmployee(uid, name) {
      if (!confirm(`${name} ì§ì›ì˜ ê°€ì…ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê±°ë¶€ëœ ê³„ì •ì€ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // users ì»¬ë ‰ì…˜ ì—…ë°ì´íŠ¸
        await db.collection('users').doc(uid).update({
          status: 'rejected',
          rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // employees ì»¬ë ‰ì…˜ë„ ì—…ë°ì´íŠ¸
        await db.collection('employees').doc(uid).update({
          status: 'rejected',
          rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert(`âŒ ${name} ì§ì›ì˜ ê°€ì…ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadEmployees(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ê±°ë¶€ ì‹¤íŒ¨:', error);
        alert('âŒ ê±°ë¶€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê´€ë¦¬ì ìŠ¹ì¸ í•¨ìˆ˜
    async function approveAdmin(uid, name, role) {
      const roleText = role === 'admin' ? 'ê´€ë¦¬ì' : 'ë§¤ë‹ˆì €';
      if (!confirm(`${name} ${roleText}ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      try {
        // users ì»¬ë ‰ì…˜ ì—…ë°ì´íŠ¸
        await db.collection('users').doc(uid).update({
          status: 'approved',
          approvedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert(`âœ… ${name} ${roleText}ì˜ ê°€ì…ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadApprovals(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ê´€ë¦¬ì ìŠ¹ì¸ ì‹¤íŒ¨:', error);
        alert('âŒ ìŠ¹ì¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }
    
    // ê´€ë¦¬ì ê±°ë¶€ í•¨ìˆ˜
    async function rejectAdmin(uid, name) {
      if (!confirm(`${name} ê´€ë¦¬ìì˜ ê°€ì…ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê±°ë¶€ëœ ê³„ì •ì€ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // users ì»¬ë ‰ì…˜ ì—…ë°ì´íŠ¸
        await db.collection('users').doc(uid).update({
          status: 'rejected',
          rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        alert(`âŒ ${name} ê´€ë¦¬ìì˜ ê°€ì…ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadApprovals(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ê´€ë¦¬ì ê±°ë¶€ ì‹¤íŒ¨:', error);
        alert('âŒ ê±°ë¶€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê´€ë¦¬ì ì‚­ì œ í•¨ìˆ˜
    async function deleteAdmin(uid, name) {
      if (!confirm(`${name} ê´€ë¦¬ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // users ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
        await db.collection('users').doc(uid).delete();
        
        alert(`âœ… ${name} ê´€ë¦¬ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        loadAdmins(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ê´€ë¦¬ì ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('âŒ ì‚­ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ìŠ¹ì¸ ë¬¸ì„œ ìƒì„¸ë³´ê¸°
    async function viewApprovalDetail(approvalId) {
      try {
        const doc = await db.collection('approvals').doc(approvalId).get();
        
        if (!doc.exists) {
          alert('âŒ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const approval = doc.data();
        
        // íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ë‹¬ í‘œì‹œ
        if (approval.type === 'purchase') {
          showPurchaseDetailModal(approvalId, approval);
        } else if (approval.type === 'disposal') {
          showDisposalDetailModal(approvalId, approval);
        } else if (approval.type === 'resignation') {
          showResignationDetailModal(approvalId, approval);
        }
        
      } catch (error) {
        console.error('âŒ ë¬¸ì„œ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('âŒ ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ë¬¸ì„œ ìŠ¹ì¸
    async function approveDocument(approvalId, type) {
      if (!confirm('ì´ ë¬¸ì„œë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        await db.collection('approvals').doc(approvalId).update({
          status: 'approved',
          approvedAt: firebase.firestore.FieldValue.serverTimestamp(),
          approvedBy: sessionStorage.getItem('admin_email')
        });
        
        // í‡´ì§ì„œì¸ ê²½ìš° ê³„ì • ì‚­ì œ
        if (type === 'resignation') {
          const doc = await db.collection('approvals').doc(approvalId).get();
          const approval = doc.data();
          
          if (approval.applicantUid) {
            // users ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
            await db.collection('users').doc(approval.applicantUid).delete();
            // employees ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
            await db.collection('employees').doc(approval.applicantUid).delete();
            
            console.log(`âœ… í‡´ì§ì„œ ìŠ¹ì¸ìœ¼ë¡œ ${approval.applicantName} ì§ì› ê³„ì • ì‚­ì œ ì™„ë£Œ`);
          }
        }
        
        alert('âœ… ë¬¸ì„œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadApprovals(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ìŠ¹ì¸ ì‹¤íŒ¨:', error);
        alert('âŒ ìŠ¹ì¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ë¬¸ì„œ ê±°ë¶€
    async function rejectDocument(approvalId) {
      const reason = prompt('ê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      
      if (reason === null) {
        return; // ì·¨ì†Œ
      }
      
      try {
        await db.collection('approvals').doc(approvalId).update({
          status: 'rejected',
          rejectedAt: firebase.firestore.FieldValue.serverTimestamp(),
          rejectedBy: sessionStorage.getItem('admin_email'),
          rejectReason: reason
        });
        
        alert('âŒ ë¬¸ì„œê°€ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadApprovals(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('âŒ ê±°ë¶€ ì‹¤íŒ¨:', error);
        alert('âŒ ê±°ë¶€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function loadContracts() {
      const tbody = document.getElementById('contractsTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">ê³„ì•½ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        // Firestoreì—ì„œ ëª¨ë“  ê³„ì•½ì„œ ë¡œë“œ (localStorage ì œê±° ì™„ë£Œ)
        const snapshot = await firebase.firestore().collection('contracts').get();
        const allContracts = [];
        
        snapshot.forEach(doc => {
          const contractData = doc.data();
          const contractId = doc.id;
          const signedContracts = signedContractsCache;
          const isSigned = signedContracts.some(sc => sc.id === contractId);
          
          allContracts.push({
            id: contractId,
            name: contractData.employeeName,
            birth: contractData.employeeBirth,
            type: contractData.contractType,
            period: `${contractData.startDate} ~ ${contractData.endDate}`,
            createdAt: contractData.createdAt || new Date().toISOString(),
            status: isSigned ? 'ì„œëª…ì™„ë£Œ' : 'ì„œëª…ëŒ€ê¸°',
            data: contractData
          });
        });
        
        if (allContracts.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);"><p style="margin-bottom: 16px;">ìƒì„±ëœ ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p><button class="btn btn-primary" onclick="openContractPage()">+ ì²« ê³„ì•½ì„œ ì‘ì„±í•˜ê¸°</button></td></tr>';
          return;
        }
        
        // ì§ì›ë³„ë¡œ ê³„ì•½ì„œ ê·¸ë£¹í™” (ì£¼ë¯¼ë²ˆí˜¸ ê¸°ì¤€)
        const employeeGroups = new Map();
        allContracts.forEach(contract => {
          const key = `${contract.name}_${contract.birth}`;
          if (!employeeGroups.has(key)) {
            employeeGroups.set(key, []);
          }
          employeeGroups.get(key).push(contract);
        });
        
        // ê° ê·¸ë£¹ì˜ ê³„ì•½ì„œë¥¼ ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
        employeeGroups.forEach((contracts, key) => {
          contracts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        });
        
        // í…Œì´ë¸” í–‰ ìƒì„±
        const rows = [];
        employeeGroups.forEach((contracts, key) => {
          const latestContract = contracts[0]; // ìµœì‹  ê³„ì•½ì„œ
          const contractCount = contracts.length;
          
          // ê³„ì•½ì„œ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìƒì„±
          const contractOptions = contracts.map((contract, index) => {
            const date = new Date(contract.createdAt);
            const dateStr = date.toLocaleDateString('ko-KR');
            const timeStr = date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            const label = `${dateStr} ${timeStr}${index === 0 ? ' (ìµœì‹ )' : ''}`;
            return `<option value="${contract.id}">${label}</option>`;
          }).join('');
          
          const selectId = `contract-select-${latestContract.id}`;
          const statusClass = latestContract.status === 'ì„œëª…ì™„ë£Œ' ? 'badge-success' : 'badge-warning';
          
          rows.push(`
            <tr>
              <td>
                <strong>${latestContract.name}</strong>
                ${contractCount > 1 ? `<br><span class="badge" style="background: var(--primary-color); color: white; font-size: 11px;">ğŸ“ ${contractCount}ê±´</span>` : ''}
              </td>
              <td>${latestContract.type}</td>
              <td>${latestContract.period}</td>
              <td>
                ${contractCount > 1 ? `
                  <select id="${selectId}" class="form-control" style="font-size: 13px; padding: 4px 8px;" onchange="updateContractButtons('${selectId}', this.value)">
                    ${contractOptions}
                  </select>
                ` : `
                  ${new Date(latestContract.createdAt).toLocaleDateString('ko-KR')} ${new Date(latestContract.createdAt).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })}
                `}
              </td>
              <td><span class="badge ${statusClass}" id="status-${latestContract.id}">${latestContract.status}</span></td>
              <td>
                <div id="buttons-${latestContract.id}" style="display: flex; gap: 4px; flex-wrap: wrap;">
                  <button class="btn btn-sm btn-secondary" onclick="viewContract('${latestContract.id}')">ğŸ“„ ë³´ê¸°</button>
                  ${latestContract.status === 'ì„œëª…ëŒ€ê¸°' ? `<button class="btn btn-sm btn-primary" onclick="sendContractLink('${latestContract.id}')">ğŸ“§ ë§í¬ì „ì†¡</button>` : ''}
                  <button class="btn btn-sm" style="background: #dc3545; color: white;" onclick="deleteContract('${latestContract.id}', '${latestContract.name}')">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
              </td>
            </tr>
          `);
        });
        
        tbody.innerHTML = rows.join('');
      } catch (error) {
        console.error('âŒ ê³„ì•½ì„œ ë¡œë“œ ì‹¤íŒ¨:', error);
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: red;">ê³„ì•½ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    
    // ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë²„íŠ¼ ì—…ë°ì´íŠ¸
    window.updateContractButtons = function(selectId, contractId) {
      // ì„ íƒëœ ê³„ì•½ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const contractData = JSON.parse(localStorage.getItem(`contract_${contractId}`) || '{}');
      const signedContracts = signedContractsCache;
      const isSigned = signedContracts.some(sc => sc.id === contractId);
      const status = isSigned ? 'ì„œëª…ì™„ë£Œ' : 'ì„œëª…ëŒ€ê¸°';
      const statusClass = status === 'ì„œëª…ì™„ë£Œ' ? 'badge-success' : 'badge-warning';
      
      // ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸
      const statusBadge = document.getElementById(`status-${selectId.replace('contract-select-', '')}`);
      if (statusBadge) {
        statusBadge.className = `badge ${statusClass}`;
        statusBadge.textContent = status;
      }
      
      // ë²„íŠ¼ ì—…ë°ì´íŠ¸
      const buttonsDiv = document.getElementById(`buttons-${selectId.replace('contract-select-', '')}`);
      if (buttonsDiv) {
        const employeeName = contractData.employeeName || '';
        buttonsDiv.innerHTML = `
          <button class="btn btn-sm btn-secondary" onclick="viewContract('${contractId}')">ğŸ“„ ë³´ê¸°</button>
          ${status === 'ì„œëª…ëŒ€ê¸°' ? `<button class="btn btn-sm btn-primary" onclick="sendContractLink('${contractId}')">ğŸ“§ ë§í¬ì „ì†¡</button>` : ''}
          <button class="btn btn-sm" style="background: #dc3545; color: white;" onclick="deleteContract('${contractId}', '${employeeName}')">ğŸ—‘ï¸ ì‚­ì œ</button>
        `;
      }
    };
    
    // ê³„ì•½ì„œ ì‚­ì œ í•¨ìˆ˜
    window.deleteContract = async function(contractId, employeeName) {
      if (!confirm(`âš ï¸ ì •ë§ë¡œ "${employeeName}"ë‹˜ì˜ ê³„ì•½ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      try {
        // Firestoreì—ì„œ ê³„ì•½ì„œ ì‚­ì œ
        await firebase.firestore().collection('contracts').doc(contractId).delete();
        console.log(`âœ… Firestore contracts ì‚­ì œ ì™„ë£Œ: ${contractId}`);
        
        // signedContracts Firestoreì—ì„œë„ ì œê±°
        await firebase.firestore().collection('signedContracts').doc(contractId).delete();
        console.log('âœ… signedContractsì—ì„œë„ ì‚­ì œ ì™„ë£Œ');
        
        // ìºì‹œ ì—…ë°ì´íŠ¸
        signedContractsCache = signedContractsCache.filter(sc => sc.id !== contractId);
        
        alert(`âœ… "${employeeName}"ë‹˜ì˜ ê³„ì•½ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        
        // ê³„ì•½ì„œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        await loadContracts();
        
        // ëŒ€ì‹œë³´ë“œë„ ì—…ë°ì´íŠ¸
        if (currentTab === 'dashboard') {
          loadDashboard();
        }
      } catch (error) {
        console.error('âŒ ê³„ì•½ì„œ ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('âŒ ê³„ì•½ì„œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    };

    function loadNotice() {
      // loadNotices() í˜¸ì¶œ
      loadNotices();
    }

    // ë§¤ì¥ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    async function loadStores() {
      const tbody = document.getElementById('storesTableBody');
      
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">ë§¤ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        // Firestoreì—ì„œ ë§¤ì¥ ì •ë³´ ë¡œë“œ
        const storesSnapshot = await firebase.firestore().collection('stores').get();
        
        let stores = [];
        storesSnapshot.forEach(doc => {
          stores.push({ id: doc.id, ...doc.data() });
        });
        
        // ê¸°ë³¸ ë§¤ì¥ì´ ì—†ìœ¼ë©´ Firestoreì— ì¶”ê°€
        if (stores.length === 0) {
          console.log('ğŸ“‹ ê¸°ë³¸ ë§¤ì¥ ìƒì„± ì¤‘...');
          const defaultStores = [
            { name: 'ë§›ë‚¨ì‚´ë¡± ë¶€ì²œì‹œì²­ì ', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ì›ë¯¸êµ¬', phone: '032-123-4567', ceo: 'í™ê¸¸ë™', businessNumber: '123-45-67890' },
            { name: 'ë§›ë‚¨ì‚´ë¡± ìƒë™ì ', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ìƒë™', phone: '032-123-4568', ceo: 'í™ê¸¸ë™', businessNumber: '123-45-67890' },
            { name: 'ë§›ë‚¨ì‚´ë¡± ë¶€ì²œì—­ì‚¬ì ', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ë¶€ì²œì—­ ì¸ê·¼', phone: '032-123-4569', ceo: 'í™ê¸¸ë™', businessNumber: '123-45-67890' }
          ];
          
          for (const store of defaultStores) {
            const docRef = await firebase.firestore().collection('stores').add({
              ...store,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            stores.push({ id: docRef.id, ...store });
          }
          console.log('âœ… ê¸°ë³¸ ë§¤ì¥ 3ê°œ ìƒì„± ì™„ë£Œ');
        }
        
        if (stores.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                <p style="margin-bottom: 16px;">ë“±ë¡ëœ ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <button class="btn btn-primary" onclick="showAddStoreModal()">+ ì²« ë§¤ì¥ ì¶”ê°€í•˜ê¸°</button>
              </td>
            </tr>
          `;
          return;
        }
        
        tbody.innerHTML = stores.map(store => `
          <tr>
            <td>${store.name}</td>
            <td>${store.address || '-'}</td>
            <td>${store.phone || '-'}</td>
            <td>${store.ceo || '-'}</td>
            <td>${store.businessNumber || '-'}</td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="showEditStoreModal('${store.id}')">âœï¸ ìˆ˜ì •</button>
            </td>
          </tr>
        `).join('');
        
        console.log(`âœ… ${stores.length}ê°œ ë§¤ì¥ ë¡œë“œ ì™„ë£Œ`);
      } catch (error) {
        console.error('âŒ ë§¤ì¥ ë¡œë“œ ì‹¤íŒ¨:', error);
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--danger-color);">ë§¤ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }

    // í•„í„°ìš© ë§¤ì¥ ëª©ë¡ ë¡œë“œ (ë“œë¡­ë‹¤ìš´)
    async function loadStoresForFilter(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      
      try {
        const snapshot = await db.collection('stores').orderBy('name').get();
        
        // ê¸°ì¡´ ì˜µì…˜ ìœ ì§€í•˜ê³  ë§¤ì¥ë§Œ ì¶”ê°€
        const currentValue = select.value;
        const defaultOption = select.querySelector('option[value=""]');
        select.innerHTML = '';
        if (defaultOption) {
          select.appendChild(defaultOption);
        } else {
          select.innerHTML = '<option value="">ì „ì²´</option>';
        }
        
        snapshot.forEach(doc => {
          const store = doc.data();
          const option = document.createElement('option');
          option.value = store.name;
          option.textContent = store.name;
          select.appendChild(option);
        });
        
        // ì´ì „ ì„ íƒê°’ ë³µì›
        if (currentValue) {
          select.value = currentValue;
        }
        
        console.log(`âœ… í•„í„°ìš© ë§¤ì¥ ${snapshot.size}ê°œ ë¡œë“œ ì™„ë£Œ`);
      } catch (error) {
        console.error('âŒ í•„í„°ìš© ë§¤ì¥ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    let storeCeoSignatureData = null;

    function showAddStoreModal() {
      document.getElementById('storeModalTitle').textContent = 'ğŸª ë§¤ì¥ ì¶”ê°€';
      document.getElementById('editStoreId').value = '';
      document.getElementById('storeName').value = '';
      document.getElementById('storeAddress').value = '';
      document.getElementById('storePhone').value = '';
      document.getElementById('storeCEO').value = '';
      document.getElementById('storeBusinessNumber').value = '';
      document.getElementById('deleteStoreBtn').style.display = 'none';
      
      // ìˆ˜ë‹¹ ì˜µì…˜ ì´ˆê¸°í™” (ê¸°ë³¸ê°’: ëª¨ë‘ ë¯¸ì ìš©)
      document.getElementById('storeOvertimeAllowance').checked = false;
      document.getElementById('storeNightAllowance').checked = false;
      document.getElementById('storeHolidayAllowance').checked = false;
      
      // ì„œëª… ì´ˆê¸°í™”
      storeCeoSignatureData = null;
      document.getElementById('storeCeoSignaturePreview').innerHTML = '<span style="color: #999;">ì„œëª… ì´ë¯¸ì§€ ì„ íƒ (ì„ íƒì‚¬í•­)</span>';
      
      document.getElementById('storeModal').style.display = 'flex';
    }

    async function showEditStoreModal(storeId) {
      try {
        // Firestoreì—ì„œ ë§¤ì¥ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const storeDoc = await firebase.firestore().collection('stores').doc(storeId).get();
        
        if (!storeDoc.exists) {
          alert('ë§¤ì¥ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const store = { id: storeDoc.id, ...storeDoc.data() };
        
        document.getElementById('storeModalTitle').textContent = 'ğŸª ë§¤ì¥ ìˆ˜ì •';
        document.getElementById('editStoreId').value = store.id;
        document.getElementById('storeName').value = store.name;
        document.getElementById('storeAddress').value = store.address || '';
        document.getElementById('storePhone').value = store.phone || '';
        document.getElementById('storeCEO').value = store.ceo || '';
        document.getElementById('storeBusinessNumber').value = store.businessNumber || '';
        document.getElementById('deleteStoreBtn').style.display = 'block';
        
        // ìˆ˜ë‹¹ ì˜µì…˜ ë¶ˆëŸ¬ì˜¤ê¸°
        if (store.allowances) {
          document.getElementById('storeOvertimeAllowance').checked = store.allowances.overtime || false;
          document.getElementById('storeNightAllowance').checked = store.allowances.night || false;
          document.getElementById('storeHolidayAllowance').checked = store.allowances.holiday || false;
        } else {
          // ê¸°ë³¸ê°’ (ëª¨ë‘ ë¯¸ì ìš©)
          document.getElementById('storeOvertimeAllowance').checked = false;
          document.getElementById('storeNightAllowance').checked = false;
          document.getElementById('storeHolidayAllowance').checked = false;
        }
        
        // ì„œëª… ë¶ˆëŸ¬ì˜¤ê¸°
        if (store.ceoSignature) {
          storeCeoSignatureData = store.ceoSignature;
          document.getElementById('storeCeoSignaturePreview').innerHTML = `<img src="${store.ceoSignature}" style="max-width: 100%; max-height: 100px; object-fit: contain;">`;
        } else {
          storeCeoSignatureData = null;
          document.getElementById('storeCeoSignaturePreview').innerHTML = '<span style="color: #999;">ì„œëª… ì´ë¯¸ì§€ ì„ íƒ (ì„ íƒì‚¬í•­)</span>';
        }
        
        document.getElementById('storeModal').style.display = 'flex';
      } catch (error) {
        console.error('âŒ ë§¤ì¥ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ë§¤ì¥ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function closeStoreModal() {
      document.getElementById('storeModal').style.display = 'none';
    }

    async function saveStore() {
      const storeId = document.getElementById('editStoreId').value;
      const name = document.getElementById('storeName').value.trim();
      const address = document.getElementById('storeAddress').value.trim();
      const phone = document.getElementById('storePhone').value.trim();
      const ceo = document.getElementById('storeCEO').value.trim();
      const businessNumber = document.getElementById('storeBusinessNumber').value.trim();
      
      if (!name) {
        alert('âš ï¸ ë§¤ì¥ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ìˆ˜ë‹¹ ì ìš© ì˜µì…˜ ìˆ˜ì§‘
      const overtimeAllowance = document.getElementById('storeOvertimeAllowance').checked;
      const nightAllowance = document.getElementById('storeNightAllowance').checked;
      const holidayAllowance = document.getElementById('storeHolidayAllowance').checked;
      
      try {
        const storeData = {
          name,
          address,
          phone,
          ceo,
          businessNumber,
          ceoSignature: storeCeoSignatureData || null,
          allowances: {
            overtime: overtimeAllowance,
            night: nightAllowance,
            holiday: holidayAllowance
          },
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (storeId) {
          // ìˆ˜ì • - Firestore ì—…ë°ì´íŠ¸
          await firebase.firestore().collection('stores').doc(storeId).update(storeData);
          console.log('âœ… ë§¤ì¥ ìˆ˜ì • ì™„ë£Œ:', storeId);
        } else {
          // ì¶”ê°€ - Firestore ì‹ ê·œ ìƒì„±
          storeData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          const docRef = await firebase.firestore().collection('stores').add(storeData);
          console.log('âœ… ë§¤ì¥ ì¶”ê°€ ì™„ë£Œ:', docRef.id);
        }
        
        closeStoreModal();
        loadStores();
        
        // ì„œëª… ì´ˆê¸°í™”
        storeCeoSignatureData = null;
        
        alert('âœ… ë§¤ì¥ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('âŒ ë§¤ì¥ ì €ì¥ ì‹¤íŒ¨:', error);
        alert('ë§¤ì¥ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteStore() {
      if (!confirm('âš ï¸ ì •ë§ ì´ ë§¤ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      const storeId = document.getElementById('editStoreId').value;
      
      if (!storeId) {
        alert('ì‚­ì œí•  ë§¤ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        // Firestoreì—ì„œ ë§¤ì¥ ì‚­ì œ
        await firebase.firestore().collection('stores').doc(storeId).delete();
        console.log('âœ… ë§¤ì¥ ì‚­ì œ ì™„ë£Œ:', storeId);
        
        closeStoreModal();
        loadStores();
        alert('âœ… ë§¤ì¥ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('âŒ ë§¤ì¥ ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('ë§¤ì¥ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê³µì§€ì‚¬í•­ ê´€ë¦¬
    async function loadNotices() {
      const tbody = document.getElementById('noticeTableBody');
      
      if (!tbody) {
        console.error('âŒ noticeTableBody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        return;
      }
      
      tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        // Firestoreì—ì„œ ê³µì§€ì‚¬í•­ ê°€ì ¸ì˜¤ê¸°
        const snapshot = await firebase.firestore().collection('notices').get();
        
        const notices = [];
        snapshot.forEach(doc => {
          notices.push({ id: doc.id, ...doc.data() });
        });
        
        if (notices.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                <p style="margin-bottom: 16px;">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <button class="btn btn-primary" onclick="showAddNoticeModal()">+ ê³µì§€ì‚¬í•­ ì‘ì„±</button>
              </td>
            </tr>
          `;
          return;
        }
        
        // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìµœì‹ ìˆœ ì •ë ¬
        notices.sort((a, b) => {
          const dateA = a.createdAt ? (a.createdAt.toDate ? a.createdAt.toDate() : new Date(a.createdAt)) : new Date(0);
          const dateB = b.createdAt ? (b.createdAt.toDate ? b.createdAt.toDate() : new Date(b.createdAt)) : new Date(0);
          return dateB - dateA;
        });
        
        tbody.innerHTML = notices.map(notice => {
          // Firestore Timestamp ë˜ëŠ” ISO ë¬¸ìì—´ ì²˜ë¦¬
          const date = notice.createdAt ? (notice.createdAt.toDate ? notice.createdAt.toDate() : new Date(notice.createdAt)) : new Date();
          const dateStr = date.toLocaleDateString('ko-KR');
          const timeStr = date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
          
          return `
            <tr>
              <td>
                ${notice.important ? '<span style="color: #ff6b6b; font-weight: bold;">â­</span> ' : ''}
                ${notice.title}
              </td>
              <td>${dateStr} ${timeStr}</td>
              <td>${notice.important ? '<span style="color: #ff6b6b;">ì¤‘ìš”</span>' : '-'}</td>
              <td>
                <button class="btn btn-sm" onclick="showEditNoticeModal('${notice.id}')">ìˆ˜ì •</button>
                <button class="btn btn-sm btn-danger" onclick="deleteNoticeConfirm('${notice.id}')">ì‚­ì œ</button>
              </td>
            </tr>
          `;
        }).join('');
        
        console.log(`âœ… ${notices.length}ê°œ ê³µì§€ì‚¬í•­ ë¡œë“œ ì™„ë£Œ`);
      } catch (error) {
        console.error('âŒ ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨:', error);
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--danger-color);">ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }

    function showAddNoticeModal() {
      document.getElementById('noticeModalTitle').textContent = 'ğŸ“¢ ê³µì§€ì‚¬í•­ ì‘ì„±';
      document.getElementById('editNoticeId').value = '';
      document.getElementById('noticeTitle').value = '';
      document.getElementById('noticeContent').value = '';
      document.getElementById('noticeImportant').checked = false;
      document.getElementById('deleteNoticeBtn').style.display = 'none';
      document.getElementById('noticeModal').style.display = 'flex';
    }

    async function showEditNoticeModal(noticeId) {
      try {
        // Firestoreì—ì„œ ê³µì§€ì‚¬í•­ ê°€ì ¸ì˜¤ê¸°
        const noticeDoc = await firebase.firestore().collection('notices').doc(noticeId).get();
        
        if (!noticeDoc.exists) {
          alert('ê³µì§€ì‚¬í•­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const notice = noticeDoc.data();
        
        document.getElementById('noticeModalTitle').textContent = 'âœï¸ ê³µì§€ì‚¬í•­ ìˆ˜ì •';
        document.getElementById('editNoticeId').value = noticeId;
        document.getElementById('noticeTitle').value = notice.title || '';
        document.getElementById('noticeContent').value = notice.content || '';
        document.getElementById('noticeImportant').checked = notice.important || false;
        document.getElementById('deleteNoticeBtn').style.display = 'block';
        document.getElementById('noticeModal').style.display = 'flex';
      } catch (error) {
        console.error('âŒ ê³µì§€ì‚¬í•­ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function closeNoticeModal() {
      document.getElementById('noticeModal').style.display = 'none';
    }

    async function saveNotice() {
      const noticeId = document.getElementById('editNoticeId').value;
      const title = document.getElementById('noticeTitle').value.trim();
      const content = document.getElementById('noticeContent').value.trim();
      const important = document.getElementById('noticeImportant').checked;
      
      if (!title) {
        alert('âš ï¸ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!content) {
        alert('âš ï¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        const noticeData = {
          title,
          content,
          important
        };
        
        if (noticeId) {
          // ìˆ˜ì • - Firestore ì—…ë°ì´íŠ¸
          noticeData.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
          await firebase.firestore().collection('notices').doc(noticeId).update(noticeData);
          console.log('âœ… ê³µì§€ì‚¬í•­ ìˆ˜ì • ì™„ë£Œ:', noticeId);
        } else {
          // ì¶”ê°€ - Firestore ì‹ ê·œ ìƒì„±
          noticeData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          const docRef = await firebase.firestore().collection('notices').add(noticeData);
          console.log('âœ… ê³µì§€ì‚¬í•­ ì¶”ê°€ ì™„ë£Œ:', docRef.id);
        }
        
        closeNoticeModal();
        loadNotices();
        alert('âœ… ê³µì§€ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('âŒ ê³µì§€ì‚¬í•­ ì €ì¥ ì‹¤íŒ¨:', error);
        alert('ê³µì§€ì‚¬í•­ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteNoticeConfirm(noticeId) {
      if (!confirm('âš ï¸ ì •ë§ ì´ ê³µì§€ì‚¬í•­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        // Firestoreì—ì„œ ì‚­ì œ
        await firebase.firestore().collection('notices').doc(noticeId).delete();
        console.log('âœ… ê³µì§€ì‚¬í•­ ì‚­ì œ ì™„ë£Œ:', noticeId);
        
        loadNotices();
        alert('âœ… ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('âŒ ê³µì§€ì‚¬í•­ ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('ê³µì§€ì‚¬í•­ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function deleteNotice() {
      const noticeId = document.getElementById('editNoticeId').value;
      deleteNoticeConfirm(noticeId);
      closeNoticeModal();
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // íŠ¹ì • ì§ì›ì„ ìœ„í•œ ê³„ì•½ì„œ ì‘ì„± í˜ì´ì§€ ì—´ê¸°
    function openContractPageForEmployee(uid, name, birth, phone, address) {
      console.log('ğŸ“ íŠ¹ì • ì§ì› ê³„ì•½ì„œ ì‘ì„±:', name);
      
      // ê³„ì•½ì„œ ëª¨ë‹¬ ì—´ê¸°
      openContractPage();
      
      // ì§ì› ì •ë³´ ìë™ ì…ë ¥
      setTimeout(() => {
        document.getElementById('employeeName').value = name;
        document.getElementById('employeeBirth').value = birth;
        document.getElementById('employeePhone').value = phone;
        document.getElementById('employeeAddress').value = address;
        
        // employeeSelectëŠ” ìˆ¨ê¸°ê±°ë‚˜ readonlyë¡œ ì„¤ì •
        const employeeSelect = document.getElementById('employeeSelect');
        if (employeeSelect) {
          employeeSelect.value = ''; // ì„ íƒ ì•ˆí•¨
          employeeSelect.style.display = 'none'; // ìˆ¨ê¹€
        }
        
        console.log('âœ… ì§ì› ì •ë³´ ìë™ ì…ë ¥ ì™„ë£Œ');
      }, 500);
    }

    // ê³„ì•½ì„œ ì‘ì„± ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    function openContractPage() {
      console.log('ğŸš€ ê³„ì•½ì„œ ëª¨ë‹¬ ì—´ê¸°');
      const modal = document.getElementById('contractModal');
      if (!modal) {
        console.error('âŒ contractModalì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      // ëª¨ë‹¬ í‘œì‹œ
      modal.style.display = 'flex';
      
      // ì‘ì„±í•˜ê¸° íƒ­ ê°•ì œ í™œì„±í™”
      const formTab = document.getElementById('formTab');
      const formTabBtn = document.getElementById('formTabBtn');
      const previewTab = document.getElementById('previewTab');
      const previewTabBtn = document.getElementById('previewTabBtn');
      
      console.log('ğŸ“ íƒ­ ìš”ì†Œ í™•ì¸:', { formTab, formTabBtn, previewTab, previewTabBtn });
      
      if (formTab && formTabBtn) {
        formTab.classList.add('active');
        formTab.style.display = 'block'; // ê°•ì œ í‘œì‹œ
        formTabBtn.classList.add('active');
        console.log('âœ… ì‘ì„±í•˜ê¸° íƒ­ í™œì„±í™”');
      }
      
      if (previewTab && previewTabBtn) {
        previewTab.classList.remove('active');
        previewTab.style.display = 'none';
        previewTabBtn.classList.remove('active');
      }
      
      // ëª¨ë‹¬ì´ í™”ë©´ì— ë Œë”ë§ë  ë•Œê¹Œì§€ ëŒ€ê¸°
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          console.log('âœ… ëª¨ë‹¬ ë Œë”ë§ ì™„ë£Œ, ì´ˆê¸°í™” ì‹œì‘');
          
          // í¼ ì»¨í…ì¸  ê°€ì‹œì„± ì¬í™•ì¸
          const formTabCheck = document.getElementById('formTab');
          if (formTabCheck) {
            const computedStyle = window.getComputedStyle(formTabCheck);
            console.log('ğŸ“Š formTab computed display:', computedStyle.display);
            console.log('ğŸ“Š formTab classList:', formTabCheck.classList.toString());
          }
          
          initializeContractFormNow();
        });
      });
    }
    
    function initializeContractFormNow() {
      console.log('ğŸ“ ê³„ì•½ì„œ í¼ ê°•ì œ ì´ˆê¸°í™” ì‹œì‘');
      
      // formTab ìµœì¢… í™•ì¸
      const formTab = document.getElementById('formTab');
      if (formTab) {
        console.log('âœ… formTab ë°œê²¬, ë‚´ë¶€ HTML ê¸¸ì´:', formTab.innerHTML.length);
        console.log('ğŸ“Š formTab ì²« 100ì:', formTab.innerHTML.substring(0, 100));
      } else {
        console.error('âŒ formTabì„ ì°¾ì„ ìˆ˜ ì—†ìŒ!');
        return;
      }
      
      // ì˜¤ëŠ˜ ë‚ ì§œ
      const today = new Date().toISOString().split('T')[0];
      const startDateEl = document.getElementById('startDate');
      if (startDateEl) {
        startDateEl.value = today;
        console.log('âœ… ì‹œì‘ì¼ ì„¤ì •:', today);
      } else {
        console.error('âŒ startDate ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
      }
      
      // ì‹œê°„ ë“œë¡­ë‹¤ìš´
      const startHourEl = document.querySelector('.schedule-start-hour');
      const startMinuteEl = document.querySelector('.schedule-start-minute');
      const endHourEl = document.querySelector('.schedule-end-hour');
      const endMinuteEl = document.querySelector('.schedule-end-minute');
      
      console.log('ì‹œê°„ ìš”ì†Œ í™•ì¸:', { startHourEl, startMinuteEl, endHourEl, endMinuteEl });
      
      if (startHourEl && startMinuteEl && endHourEl && endMinuteEl) {
        // ì‹œ ì˜µì…˜
        for (let i = 0; i <= 23; i++) {
          const h = String(i).padStart(2, '0');
          startHourEl.innerHTML += `<option value="${i}">${h}ì‹œ</option>`;
          endHourEl.innerHTML += `<option value="${i}">${h}ì‹œ</option>`;
        }
        
        // ë¶„ ì˜µì…˜
        for (let i = 0; i <= 59; i++) {
          const m = String(i).padStart(2, '0');
          startMinuteEl.innerHTML += `<option value="${i}">${m}ë¶„</option>`;
          endMinuteEl.innerHTML += `<option value="${i}">${m}ë¶„</option>`;
        }
        
        // ë””í´íŠ¸: 00ë¶„ ì„ íƒ
        startMinuteEl.value = '0';
        endMinuteEl.value = '0';
        
        console.log('âœ… ê·¼ë¬´ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì™„ë£Œ (ë¶„ ë””í´íŠ¸: 00ë¶„)');
      } else {
        console.error('âŒ ê·¼ë¬´ì‹œê°„ ë“œë¡­ë‹¤ìš´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
      }
      
      // íœ´ê²Œì‹œê°„
      const breakStartHour = document.getElementById('breakStartHour');
      const breakStartMinute = document.getElementById('breakStartMinute');
      const breakEndHour = document.getElementById('breakEndHour');
      const breakEndMinute = document.getElementById('breakEndMinute');
      
      if (breakStartHour && breakStartMinute && breakEndHour && breakEndMinute) {
        for (let i = 0; i <= 23; i++) {
          const h = String(i).padStart(2, '0');
          breakStartHour.innerHTML += `<option value="${i}">${h}ì‹œ</option>`;
          breakEndHour.innerHTML += `<option value="${i}">${h}ì‹œ</option>`;
        }
        
        for (let i = 0; i <= 59; i++) {
          const m = String(i).padStart(2, '0');
          breakStartMinute.innerHTML += `<option value="${i}">${m}ë¶„</option>`;
          breakEndMinute.innerHTML += `<option value="${i}">${m}ë¶„</option>`;
        }
        
        // ë””í´íŠ¸: 00ë¶„ ì„ íƒ
        breakStartMinute.value = '0';
        breakEndMinute.value = '0';
        
        console.log('âœ… íœ´ê²Œì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì™„ë£Œ (ë¶„ ë””í´íŠ¸: 00ë¶„)');
      }
      
      // ì§ì› ëª©ë¡ - Firestore users ì»¬ë ‰ì…˜ì—ì„œ ë¡œë“œ
      const employeeSelect = document.getElementById('employeeSelect');
      if (employeeSelect) {
        employeeSelect.innerHTML = '<option value="">ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        
        // Firestoreì—ì„œ ì§ì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (users ì»¬ë ‰ì…˜, userType === 'employee')
        firebase.firestore().collection('users')
          .where('userType', '==', 'employee')
          .get()
          .then(snapshot => {
            if (!snapshot.empty) {
              snapshot.forEach(doc => {
                const emp = doc.data();
                const displayName = `${emp.name} (${emp.store || 'ë§¤ì¥ë¯¸ì§€ì •'}) - ${emp.phone}`;
                employeeSelect.innerHTML += `<option value="${doc.id}">${displayName}</option>`;
              });
              console.log(`âœ… ${snapshot.size}ëª…ì˜ ì§ì› ëª©ë¡ ë¡œë“œ ì™„ë£Œ`);
            } else {
              console.log('ğŸ“‹ ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤');
              employeeSelect.innerHTML += '<option value="" disabled>ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</option>';
            }
          })
          .catch(error => {
            console.error('âŒ ì§ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            employeeSelect.innerHTML += '<option value="" disabled>ì§ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</option>';
          });
      }
      
      // íšŒì‚¬ ëª©ë¡
      const storeSelect = document.getElementById('storeSelect');
      if (storeSelect) {
        let stores = JSON.parse(localStorage.getItem('stores') || '[]');
        
        // storesê°€ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ ë§¤ì¥ ì¶”ê°€
        if (stores.length === 0) {
          stores = [
            {
              id: '1',
              name: 'ë§›ë‚¨ì‚´ë¡± ë¶€ì²œì‹œì²­ì ',
              ceo: 'í™ê¸¸ë™',
              businessNumber: '123-45-67890',
              phone: '032-123-4567',
              address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ'
            },
            {
              id: '2',
              name: 'ë§›ë‚¨ì‚´ë¡± ìƒë™ì ',
              ceo: 'í™ê¸¸ë™',
              businessNumber: '123-45-67890',
              phone: '032-123-4568',
              address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ìƒë™'
            },
            {
              id: '3',
              name: 'ë§›ë‚¨ì‚´ë¡± ë¶€ì²œì—­ì‚¬ì ',
              ceo: 'í™ê¸¸ë™',
              businessNumber: '123-45-67890',
              phone: '032-123-4569',
              address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ë¶€ì²œì—­'
            }
          ];
          // companiesëŠ” ì œê±°ë¨ - stores Firestore ì‚¬ìš©
        }
        
        storeSelect.innerHTML = '<option value="">ë§¤ì¥ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        
        // Firestoreì—ì„œ ë§¤ì¥ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        firebase.firestore().collection('stores')
          .get()
          .then(snapshot => {
            if (!snapshot.empty) {
              const stores = [];
              snapshot.forEach(doc => {
                const store = { id: doc.id, ...doc.data() };
                stores.push(store);
                storeSelect.innerHTML += `<option value="${doc.id}">${store.name}</option>`;
              });
              
              // ì²« ë²ˆì§¸ ë§¤ì¥ ìë™ ì„ íƒ
              if (stores.length > 0) {
                storeSelect.value = stores[0].id;
                // ë§¤ì¥ ì •ë³´ ìë™ ì…ë ¥
                const store = stores[0];
                document.getElementById('companyCEO').value = store.ceo || '';
                document.getElementById('companyBusinessNumber').value = store.businessNumber || '';
                document.getElementById('companyPhone').value = store.phone || '';
                document.getElementById('companyAddress').value = store.address || '';
                document.getElementById('workStore').value = store.name || '';
                console.log('âœ… ë§¤ì¥ ì •ë³´ ìë™ ì…ë ¥ ì™„ë£Œ:', store.name);
              }
              
              console.log(`âœ… ${stores.length}ê°œ ë§¤ì¥ ëª©ë¡ ë¡œë“œ ì™„ë£Œ (ê³„ì•½ì„œ í¼)`);
            } else {
              console.log('ğŸ“‹ ë“±ë¡ëœ ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤');
              storeSelect.innerHTML += '<option value="" disabled>ë“±ë¡ëœ ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤</option>';
            }
          })
          .catch(error => {
            console.error('âŒ ë§¤ì¥ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            storeSelect.innerHTML += '<option value="" disabled>ë§¤ì¥ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</option>';
          });
      }
      
      // ê¸°ë³¸ í…œí”Œë¦¿
      const contentEl = document.getElementById('contractContent');
      if (contentEl) {
        const template = `ì œ1ì¡° (ê·¼ë¡œê³„ì•½ ê¸°ê°„)
ë³¸ ê³„ì•½ì˜ ê¸°ê°„ì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.

ì œ2ì¡° (ê·¼ë¬´ ì¥ì†Œ ë° ì—…ë¬´ ë‚´ìš©)
ê·¼ë¡œìëŠ” ìœ„ í‘œì— ëª…ì‹œëœ ê·¼ë¬´ ì¥ì†Œì—ì„œ ëª…ì‹œëœ ì—…ë¬´ë¥¼ ìˆ˜í–‰í•œë‹¤.

ì œ3ì¡° (ê·¼ë¡œì‹œê°„ ë° íœ´ê²Œì‹œê°„)
1. ê·¼ë¡œì‹œê°„ì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.
2. íœ´ê²Œì‹œê°„ì€ ê·¼ë¡œì‹œê°„ ì¤‘ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.

ì œ4ì¡° (ê·¼ë¬´ì¼ ë° íœ´ì¼)
1. ê·¼ë¬´ì¼ì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.
2. ì£¼íœ´ì¼ì€ ê·¼ë¡œê¸°ì¤€ë²•ì— ë”°ë¼ ë¶€ì—¬í•œë‹¤.

ì œ5ì¡° (ì„ê¸ˆ)
1. ê·¼ë¡œìì˜ ì„ê¸ˆì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.
2. ì„ê¸ˆì€ ìœ„ í‘œì— ëª…ì‹œëœ ì§€ê¸‰ì¼ì— ì§€ê¸‰í•œë‹¤.
3. ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œ ì‹œì—ëŠ” ê·¼ë¡œê¸°ì¤€ë²•ì— ë”°ë¼ ê°€ì‚°ì„ê¸ˆì„ ì§€ê¸‰í•œë‹¤.

ì œ6ì¡° (ì—°ì°¨ìœ ê¸‰íœ´ê°€)
ì—°ì°¨ìœ ê¸‰íœ´ê°€ëŠ” ê·¼ë¡œê¸°ì¤€ë²•ì— ë”°ë¼ ë¶€ì—¬í•œë‹¤.

ì œ7ì¡° (ì‚¬íšŒë³´í—˜ ê°€ì…)
ì‚¬ìš©ìëŠ” ê·¼ë¡œìë¥¼ 4ëŒ€ ì‚¬íšŒë³´í—˜ì— ê°€ì…ì‹œí‚¨ë‹¤.

ì œ8ì¡° (ê³„ì•½ì˜ í•´ì§€)
1. ë³¸ ê³„ì•½ì„ í•´ì§€í•˜ê³ ì í•  ë•ŒëŠ” 30ì¼ ì „ì— ì˜ˆê³ í•˜ì—¬ì•¼ í•œë‹¤.
2. í•´ê³  ì˜ˆê³  ê¸°ê°„ì„ ë‘ì§€ ì•Šì„ ê²½ìš° 30ì¼ë¶„ì˜ í†µìƒì„ê¸ˆì„ ì§€ê¸‰í•œë‹¤.

ì œ9ì¡° (ê¸°íƒ€)
ì´ ê³„ì•½ì„œì— ëª…ì‹œë˜ì§€ ì•Šì€ ì‚¬í•­ì€ ê·¼ë¡œê¸°ì¤€ë²• ë° ê´€ê³„ ë²•ë ¹ì— ë”°ë¥¸ë‹¤.`;
        
        contentEl.value = template;
        console.log('âœ… ê¸°ë³¸ í…œí”Œë¦¿ ë¡œë“œ ì™„ë£Œ');
      }
      
      console.log('ğŸ‰ ëª¨ë“  ì´ˆê¸°í™” ì™„ë£Œ!');
    }
    
    function closeContractModal() {
      if (confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ì €ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        document.getElementById('contractModal').style.display = 'none';
      }
    }
    
    function resetContractForm() {
      document.getElementById('contractFormTab').querySelectorAll('input, select, textarea').forEach(el => {
        if (el.type === 'date' && el.id === 'startDate') {
          el.value = new Date().toISOString().split('T')[0];
        } else if (el.tagName === 'TEXTAREA' && el.id === 'contractContent') {
          loadDefaultTemplate();
        } else {
          el.value = '';
        }
      });
      document.getElementById('signLinkSection').style.display = 'none';
      switchContractTab('form');
    }
    
    // 4ëŒ€ë³´í—˜ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateInsuranceInfo() {
      const insuranceType = document.getElementById('insuranceType').value;
      const infoDiv = document.getElementById('insuranceInfo');
      const infoP = infoDiv.querySelector('p');
      
      if (!insuranceType) {
        infoDiv.style.display = 'none';
        return;
      }
      
      let infoText = '';
      if (insuranceType === 'all') {
        infoText = 'ğŸ“‹ ê³µì œ í•­ëª©: êµ­ë¯¼ì—°ê¸ˆ 4.5% + ê±´ê°•ë³´í—˜ 3.545% + ì¥ê¸°ìš”ì–‘ 0.459% + ê³ ìš©ë³´í—˜ 0.9% + ì†Œë“ì„¸ ì•½ 3.3%';
      } else if (insuranceType === 'employment_only') {
        infoText = 'ğŸ“‹ ê³µì œ í•­ëª©: ê³ ìš©ë³´í—˜ 0.9% + ì‚°ì¬ë³´í—˜(ì‚¬ì—…ì£¼ ë¶€ë‹´) + ì†Œë“ì„¸ ì•½ 3.3%';
      } else if (insuranceType === 'freelancer') {
        infoText = 'ğŸ“‹ ê³µì œ í•­ëª©: ì†Œë“ì„¸ 3.3%ë§Œ ì ìš© (í”„ë¦¬ëœì„œ ì„¸ìœ¨)';
      } else if (insuranceType === 'none') {
        infoText = 'ğŸ“‹ ê³µì œ í•­ëª©: ì—†ìŒ (ì„¸ê¸ˆ ë° ë³´í—˜ ì „í˜€ ì ìš© ì•ˆ í•¨)';
      }
      
      infoP.textContent = infoText;
      infoDiv.style.display = 'block';
    }
    
    // ë§¤ì¥ ì„ íƒ ì‹œ ìˆ˜ë‹¹ ìë™ ì²´í¬ (ë§¤ì¥ ì„¤ì • ê¸°ë°˜)
    async function applyStoreAllowances(storeName) {
      if (!storeName) return;
      
      try {
        // Firestoreì—ì„œ ë§¤ì¥ ì •ë³´ ì¡°íšŒ
        const snapshot = await db.collection('stores')
          .where('name', '==', storeName)
          .limit(1)
          .get();
        
        if (!snapshot.empty) {
          const store = snapshot.docs[0].data();
          const allowances = store.allowances || {};
          
          // ë§¤ì¥ ì„¤ì •ì— ë”°ë¼ ìˆ˜ë‹¹ ì²´í¬ë°•ìŠ¤ ìë™ ì„¤ì •
          document.getElementById('allowOvertime').checked = allowances.overtime || false;
          document.getElementById('allowNight').checked = allowances.night || false;
          document.getElementById('allowHoliday').checked = allowances.holiday || false;
          
          console.log('âœ… ë§¤ì¥ ìˆ˜ë‹¹ ì„¤ì • ì ìš©:', storeName, allowances);
        }
      } catch (error) {
        console.error('âŒ ë§¤ì¥ ìˆ˜ë‹¹ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }
  </script>
  
  <!-- ê³„ì•½ì„œ ì „ìš© JavaScript (ëª¨ë“  ì½”ë“œ ì¸ë¼ì¸) -->
  <script>
    // ===================================================================
    // config.js - ì„¤ì • ë° ë””ë²„ê·¸ í•¨ìˆ˜
    // ===================================================================
    
    const CONFIG = {
      APPS_SCRIPT_URL: 'YOUR_APPS_SCRIPT_URL_HERE',
      STORES: [
        { id: 'busan_city', name: 'ë¶€ì²œì‹œì²­ì ', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ì›ë¯¸êµ¬' },
        { id: 'sangdong', name: 'ìƒë™ì ', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ìƒë™' },
        { id: 'bucheon_station', name: 'ë¶€ì²œì—­ì‚¬ì ', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ì—­ê³¡ë™' }
      ],
      WORK_TYPES: [
        { id: 'regular', name: 'ì •ê·œê·¼ë¬´', color: '#4CAF50' },
        { id: 'overtime', name: 'ì´ˆê³¼ê·¼ë¬´', color: '#FF9800' },
        { id: 'substitute', name: 'ëŒ€íƒ€ê·¼ë¬´', color: '#2196F3' }
      ],
      ATTENDANCE_STATUS: [
        { id: 'normal', name: 'ì •ìƒ', color: '#4CAF50' },
        { id: 'late', name: 'ì§€ê°', color: '#FF9800' },
        { id: 'early', name: 'ì¡°í‡´', color: '#FFC107' },
        { id: 'absent', name: 'ê²°ê·¼', color: '#F44336' }
      ],
      EMPLOYMENT_TYPES: [
        { id: 'hourly', name: 'ì‹œê¸‰ì œ' },
        { id: 'monthly', name: 'ì›”ê¸‰ì œ' }
      ],
      CONTRACT_TYPES: [
        { id: 'fulltime', name: 'ì •ê·œì§ ê·¼ë¡œê³„ì•½ì„œ', template: 'template_fulltime' },
        { id: 'parttime', name: 'ì‹œê°„ì œ ê·¼ë¡œê³„ì•½ì„œ', template: 'template_parttime' },
        { id: 'intern', name: 'ì¸í„´ ê·¼ë¡œê³„ì•½ì„œ', template: 'template_intern' },
        { id: 'temporary', name: 'ì„ì‹œì§ ê·¼ë¡œê³„ì•½ì„œ', template: 'template_temporary' }
      ],
      INSURANCE_RATES: {
        national_pension: 0.045,
        health_insurance: 0.03545,
        long_term_care: 0.004591,
        employment_insurance: 0.009
      },
      FREELANCE_TAX_RATE: 0.033,
      TARDINESS_THRESHOLD: 1,
      EARLY_LEAVE_THRESHOLD: 1,
      WEEKLY_HOLIDAY_PAY: {
        MIN_WEEKLY_HOURS: 15,
        WEEKLY_HOURS: 40
      },
      RETIREMENT_PAY: {
        MIN_MONTHS: 12,
        AVERAGE_MONTHS: 3
      },
      PAGINATION: {
        DEFAULT_PAGE_SIZE: 20,
        PAGE_SIZE_OPTIONS: [10, 20, 50, 100]
      },
      STORAGE_KEYS: {
        USER_INFO: 'matnamsalon_user',
        CURRENT_ROLE: 'matnamsalon_role',
        LAST_LOGIN: 'matnamsalon_last_login'
      },
      DATE_FORMAT: {
        DISPLAY: 'YYYY-MM-DD',
        DATETIME_DISPLAY: 'YYYY-MM-DD HH:mm:ss',
        TIME_DISPLAY: 'HH:mm'
      },
      API_TIMEOUT: 30000,
      AUTO_CONFIRM_TIME: '00:00',
      DATA_RETENTION_YEARS: 2,
      DEBUG_MODE: true
    };

    function getConfig(key) {
      const keys = key.split('.');
      let value = CONFIG;
      
      for (const k of keys) {
        if (value && typeof value === 'object' && k in value) {
          value = value[k];
        } else {
          console.warn(`[ë¯¸ê²€ì¦] ì„¤ì • í‚¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${key}`);
          return null;
        }
      }
      
      return value;
    }

    function isConfigured() {
      return CONFIG.APPS_SCRIPT_URL && CONFIG.APPS_SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL_HERE';
    }

    function debugLog(...args) {
      if (CONFIG.DEBUG_MODE) {
        console.log('[DEBUG]', ...args);
      }
    }

    // ===================================================================
    // utils.js - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (contract.jsì—ì„œ í•„ìš”í•œ ê²ƒë§Œ)
    // ===================================================================

    function formatDate(date) {
      if (!date) return '';
      const d = new Date(date);
      if (isNaN(d.getTime())) return '';
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function formatDateTime(date) {
      if (!date) return '';
      const d = new Date(date);
      if (isNaN(d.getTime())) return '';
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      const hours = String(d.getHours()).padStart(2, '0');
      const minutes = String(d.getMinutes()).padStart(2, '0');
      const seconds = String(d.getSeconds()).padStart(2, '0');
      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }

    function formatTime(date) {
      if (!date) return '';
      const d = new Date(date);
      if (isNaN(d.getTime())) return '';
      const hours = String(d.getHours()).padStart(2, '0');
      const minutes = String(d.getMinutes()).padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    function parseTime(timeStr, baseDate = new Date()) {
      if (!timeStr) return null;
      const [hours, minutes] = timeStr.split(':').map(Number);
      const date = new Date(baseDate);
      date.setHours(hours, minutes, 0, 0);
      return date;
    }

    function getMinutesDifference(startTime, endTime) {
      const start = new Date(startTime);
      const end = new Date(endTime);
      if (isNaN(start.getTime()) || isNaN(end.getTime())) return 0;
      return Math.round((end - start) / (1000 * 60));
    }

    function getHoursDifference(startTime, endTime) {
      const minutes = getMinutesDifference(startTime, endTime);
      return parseFloat((minutes / 60).toFixed(2));
    }

    function formatMinutesToHourMin(minutes) {
      if (!minutes || minutes < 0) return '0ë¶„';
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      if (hours === 0) return `${mins}ë¶„`;
      if (mins === 0) return `${hours}ì‹œê°„`;
      return `${hours}ì‹œê°„ ${mins}ë¶„`;
    }

    function formatNumber(num) {
      if (num === null || num === undefined || isNaN(num)) return '0';
      return Math.round(num).toLocaleString('ko-KR');
    }

    function formatCurrency(amount) {
      return `${formatNumber(amount)}ì›`;
    }

    function extractNumber(str) {
      if (!str) return 0;
      const num = String(str).replace(/[^\d.-]/g, '');
      return parseFloat(num) || 0;
    }

    function isEmpty(value) {
      return value === null || value === undefined || value === '' || 
             (Array.isArray(value) && value.length === 0) ||
             (typeof value === 'object' && Object.keys(value).length === 0);
    }

    function generateId(prefix = '') {
      const timestamp = Date.now().toString(36);
      const random = Math.random().toString(36).substring(2, 9);
      return prefix ? `${prefix}_${timestamp}_${random}` : `${timestamp}_${random}`;
    }

    function getUrlParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // ===================================================================
    // contract.js - ê³„ì•½ì„œ ì‘ì„± ì‹œìŠ¤í…œ (ì „ì²´ ì½”ë“œ)
    // ===================================================================

    // ì „ì—­ ë³€ìˆ˜
    let companies = [];
    let savedContracts = [];
    let signedContractsCache = []; // Firestore signedContracts ìºì‹œ

    // ë”ë¯¸ ì§ì› ë°ì´í„° (contract.jsìš© - ê¸°ì¡´ DUMMY_EMPLOYEESì™€ ë™ì¼ì¸ë¬¼)
    const CONTRACT_DUMMY_EMPLOYEES = [
      { id: '1', name: 'ê¹€ë¯¼ìˆ˜', birth: '1990-03-15', address: 'ê²½ê¸°ë„ ë¶€ì²œì‹œ ì›ë¯¸êµ¬', phone: '010-1234-5678' },
    ];

    // ì´ˆê¸°í™” í•¨ìˆ˜
    function initializeContractForm() {
      console.log('ğŸ“ ê³„ì•½ì„œ í¼ ì´ˆê¸°í™”');
      
      const today = new Date().toISOString().split('T')[0];
      const startDateEl = document.getElementById('startDate');
      if (startDateEl) startDateEl.value = today;
      
      initializeTimeDropdowns();
      loadEmployeeList();
      loadCompanyList();
      loadDefaultTemplate();
    }

    // íƒ­ ì „í™˜ í•¨ìˆ˜ - switchContractTabë¡œ ë³€ê²½í•˜ì—¬ ê¸°ì¡´ switchTabê³¼ ì¶©ëŒ ë°©ì§€
    function switchContractTab(tabName) {
      console.log('ğŸ”„ ê³„ì•½ì„œ íƒ­ ì „í™˜ ìš”ì²­:', tabName);
      
      if (tabName === 'preview') {
        if (!validateForm()) {
          console.log('âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨');
          return;
        }
        updatePreview();
      }
      
      const formTab = document.getElementById('formTab');
      const formTabBtn = document.getElementById('formTabBtn');
      const previewTab = document.getElementById('previewTab');
      const previewTabBtn = document.getElementById('previewTabBtn');
      
      // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
      formTabBtn.classList.remove('active');
      previewTabBtn.classList.remove('active');
      formTab.classList.remove('active');
      previewTab.classList.remove('active');
      
      if (tabName === 'form') {
        formTabBtn.classList.add('active');
        formTab.classList.add('active');
        formTab.style.display = 'block';  // ëª…ì‹œì  í‘œì‹œ
        previewTab.style.display = 'none';  // ëª…ì‹œì  ìˆ¨ê¹€
        console.log('âœ… ì‘ì„±í•˜ê¸° íƒ­ í™œì„±í™”');
      } else if (tabName === 'preview') {
        previewTabBtn.classList.add('active');
        previewTab.classList.add('active');
        previewTab.style.display = 'block';  // ëª…ì‹œì  í‘œì‹œ
        formTab.style.display = 'none';  // ëª…ì‹œì  ìˆ¨ê¹€
        console.log('âœ… ë¯¸ë¦¬ë³´ê¸° íƒ­ í™œì„±í™”');
        
        // ë¯¸ë¦¬ë³´ê¸° íƒ­ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
        setTimeout(() => {
          const modalBody = document.querySelector('#contractModal .modal-body');
          if (modalBody) modalBody.scrollTop = 0;
        }, 50);
      }
    }

    // ì§ì› ì •ë³´
    function loadEmployeeList() {
      console.log('ğŸ‘¥ ì§ì› ëª©ë¡ ë¡œë“œ ì‹œì‘');
      const select = document.getElementById('employeeSelect');
      console.log('employeeSelect ìš”ì†Œ:', select);
      if (!select) {
        console.error('âŒ employeeSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }
      select.innerHTML = '<option value="">ìƒˆ ì§ì› (ì§ì ‘ ì…ë ¥)</option>';
      
      const employeeMap = new Map();
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const empKey = contractData.employeeName + '_' + contractData.employeeBirth;
            
            if (!employeeMap.has(empKey)) {
              employeeMap.set(empKey, {
                id: empKey,
                name: contractData.employeeName,
                birth: contractData.employeeBirth,
                address: contractData.employeeAddress,
                phone: contractData.employeePhone
              });
            }
          } catch (e) {
            console.error('ì§ì› ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', e);
          }
        }
      }
      
      const employees = Array.from(employeeMap.values());
      
      if (employees.length === 0) {
        CONTRACT_DUMMY_EMPLOYEES.forEach(emp => {
          const option = document.createElement('option');
          option.value = emp.id;
          option.textContent = `${emp.name} (${emp.phone})`;
          select.appendChild(option);
        });
      } else {
        employees.forEach(emp => {
          const option = document.createElement('option');
          option.value = emp.id;
          option.textContent = `${emp.name} (${emp.phone})`;
          select.appendChild(option);
        });
      }
    }

    /**
     * ì£¼ë¯¼ë²ˆí˜¸ë¥¼ ìƒë…„ì›”ì¼(YYYY-MM-DD)ë¡œ ë³€í™˜
     * @param {string} ssn - ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ (YYMMDD-******* í˜•ì‹)
     * @returns {string} YYYY-MM-DD í˜•ì‹ì˜ ìƒë…„ì›”ì¼
     */
    function convertSSNtoBirthDate(ssn) {
      if (!ssn || ssn.length < 6) return '';
      
      // ì£¼ë¯¼ë²ˆí˜¸ ì• 6ìë¦¬ ì¶”ì¶œ (YYMMDD)
      const ssnFront = ssn.replace(/-/g, '').substring(0, 6);
      const yy = parseInt(ssnFront.substring(0, 2));
      const mm = ssnFront.substring(2, 4);
      const dd = ssnFront.substring(4, 6);
      
      // ë’·ìë¦¬ ì²«ë²ˆì§¸ ìˆ«ìë¡œ ì„¸ê¸° íŒë‹¨ (1,2: 1900ë…„ëŒ€, 3,4: 2000ë…„ëŒ€)
      const genderDigit = ssn.replace(/-/g, '').charAt(6);
      let yyyy;
      
      if (genderDigit === '1' || genderDigit === '2') {
        yyyy = 1900 + yy;
      } else if (genderDigit === '3' || genderDigit === '4') {
        yyyy = 2000 + yy;
      } else {
        // ê¸°ë³¸ê°’: 1900ë…„ëŒ€ë¡œ ê°€ì •
        yyyy = 1900 + yy;
      }
      
      return `${yyyy}-${mm}-${dd}`;
    }

    async function loadEmployeeInfo() {
      const employeeSelect = document.getElementById('employeeSelect');
      
      // employeeSelectê°€ ì—†ìœ¼ë©´ ì¡°ìš©íˆ ë¦¬í„´
      if (!employeeSelect) {
        console.log('â„¹ï¸ employeeSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ (ì•„ì§ ëª¨ë‹¬ì´ ì—´ë¦¬ì§€ ì•ŠìŒ)');
        return;
      }
      
      const employeeId = employeeSelect.value;
      
      if (!employeeId) {
        document.getElementById('employeeName').value = '';
        document.getElementById('employeeBirth').value = '';
        document.getElementById('employeeAddress').value = '';
        document.getElementById('employeePhone').value = '';
        document.getElementById('employeeName').readOnly = false;
        return;
      }
      
      try {
        console.log('ğŸ“‹ ì§ì› ì •ë³´ ë¡œë“œ:', employeeId);
        
        // Firestore users ì»¬ë ‰ì…˜ì—ì„œ ì§ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const doc = await firebase.firestore().collection('users').doc(employeeId).get();
        
        if (doc.exists) {
          const employee = doc.data();
          
          document.getElementById('employeeName').value = employee.name || '';
          document.getElementById('employeeAddress').value = employee.address || '';
          document.getElementById('employeePhone').value = employee.phone || '';
          document.getElementById('employeeName').readOnly = true;
          
          // ì£¼ë¯¼ë²ˆí˜¸ ìë™ ì…ë ¥
          if (employee.birth) {
            document.getElementById('employeeBirth').value = employee.birth;
            console.log('âœ… ì£¼ë¯¼ë²ˆí˜¸ ìë™ ì…ë ¥:', employee.birth);
          }
          
          console.log('âœ… ì§ì› ì •ë³´ ë¡œë“œ ì™„ë£Œ:', employee.name);
          updatePreview(); // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        } else {
          console.error('âŒ ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          alert('ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('âŒ ì§ì› ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
        alert('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    // íšŒì‚¬ ì •ë³´ - ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (storesë¡œ í†µí•©)
    function loadCompanyList() {
      console.log('â„¹ï¸ loadCompanyListëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. storesë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.');
      // companiesëŠ” ì œê±°ë¨ - stores Firestore ì‚¬ìš©
    }

    async function loadStoreInfoToContract() {
      const storeSelect = document.getElementById('storeSelect');
      if (!storeSelect) {
        console.log('â„¹ï¸ storeSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        return;
      }
      const storeId = storeSelect.value;
      
      if (!storeId) {
        document.getElementById('companyCEO').value = '';
        document.getElementById('companyBusinessNumber').value = '';
        document.getElementById('companyPhone').value = '';
        document.getElementById('companyAddress').value = '';
        document.getElementById('workStore').value = '';
        updatePreview();
        return;
      }
      
      try {
        // Firestoreì—ì„œ ë§¤ì¥ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const storeDoc = await firebase.firestore().collection('stores').doc(storeId).get();
        
        if (storeDoc.exists) {
          const store = storeDoc.data();
          document.getElementById('companyCEO').value = store.ceo || '';
          document.getElementById('companyBusinessNumber').value = store.businessNumber || '';
          document.getElementById('companyPhone').value = store.phone || '';
          document.getElementById('companyAddress').value = store.address || '';
          document.getElementById('workStore').value = store.name || '';
          
          // ë§¤ì¥ ìˆ˜ë‹¹ ì„¤ì • ìë™ ì ìš©
          const allowances = store.allowances || {};
          console.log('ğŸ’° ë§¤ì¥ ìˆ˜ë‹¹ ì„¤ì • ìë™ ì ìš©:', allowances);
          document.getElementById('allowOvertime').checked = allowances.overtime || false;
          document.getElementById('allowNight').checked = allowances.night || false;
          document.getElementById('allowHoliday').checked = allowances.holiday || false;
          
          updatePreview();
        }
      } catch (error) {
        console.error('âŒ ë§¤ì¥ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    function loadCompanyInfo() {
      // í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
      loadStoreInfoToContract();
    }

    function showAddCompanyModal() {
      // companiesëŠ” ì œê±°ë¨ - ë§¤ì¥ ê´€ë¦¬ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”
      alert('â„¹ï¸ íšŒì‚¬/ë§¤ì¥ ì •ë³´ëŠ” "ë§¤ì¥ ê´€ë¦¬" íƒ­ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    }

    function showEditCompanyModal() {
      // companiesëŠ” ì œê±°ë¨ - ë§¤ì¥ ê´€ë¦¬ì—ì„œ ê´€ë¦¬í•˜ì„¸ìš”
      alert('â„¹ï¸ íšŒì‚¬/ë§¤ì¥ ì •ë³´ëŠ” "ë§¤ì¥ ê´€ë¦¬" íƒ­ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      
      if (!company) {
        alert('âš ï¸ íšŒì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      document.getElementById('companyModalTitle').textContent = 'âœï¸ íšŒì‚¬ ìˆ˜ì •';
      document.getElementById('editCompanyId').value = companyId;
      document.getElementById('deleteCompanyBtnContainer').style.display = 'block';
      
      document.getElementById('newCompanyName').value = company.name;
      document.getElementById('newCompanyCEO').value = company.ceo;
      document.getElementById('newCompanyBusinessNumber').value = company.businessNumber;
      document.getElementById('newCompanyPhone').value = company.phone;
      document.getElementById('newCompanyAddress').value = company.address;
      
      document.getElementById('addCompanyModal').style.display = 'flex';
    }

    function closeAddCompanyModal() {
      document.getElementById('addCompanyModal').style.display = 'none';
      document.getElementById('editCompanyId').value = '';
      document.getElementById('newCompanyName').value = '';
      document.getElementById('newCompanyCEO').value = '';
      document.getElementById('newCompanyBusinessNumber').value = '';
      document.getElementById('newCompanyPhone').value = '';
      document.getElementById('newCompanyAddress').value = '';
    }

    function saveCompany() {
      // companiesëŠ” ì œê±°ë¨ - ë§¤ì¥ ê´€ë¦¬ ì‚¬ìš©
      alert('â„¹ï¸ íšŒì‚¬/ë§¤ì¥ ì •ë³´ëŠ” "ë§¤ì¥ ê´€ë¦¬" íƒ­ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      closeAddCompanyModal();
    }

    function deleteCompany() {
      // companiesëŠ” ì œê±°ë¨ - ë§¤ì¥ ê´€ë¦¬ ì‚¬ìš©
      alert('â„¹ï¸ íšŒì‚¬/ë§¤ì¥ ì •ë³´ëŠ” "ë§¤ì¥ ê´€ë¦¬" íƒ­ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      
      closeAddCompanyModal();
      loadCompanyList();
      
      alert('âœ… íšŒì‚¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
    function initializeTimeDropdowns() {
      console.log('â° ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì‹œì‘');
      
      const startHour = document.querySelector('.schedule-start-hour');
      const startMinute = document.querySelector('.schedule-start-minute');
      const endHour = document.querySelector('.schedule-end-hour');
      const endMinute = document.querySelector('.schedule-end-minute');
      
      console.log('ê·¼ë¬´ì‹œê°„ ìš”ì†Œ:', { startHour, startMinute, endHour, endMinute });
      
      if (!startHour || !startMinute || !endHour || !endMinute) {
        console.error('âŒ ê·¼ë¬´ì‹œê°„ ë“œë¡­ë‹¤ìš´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }
      
      populateHourOptions(startHour);
      populateHourOptions(endHour);
      populateMinuteOptions(startMinute);
      populateMinuteOptions(endMinute);
      
      const breakStartHour = document.getElementById('breakStartHour');
      const breakStartMinute = document.getElementById('breakStartMinute');
      const breakEndHour = document.getElementById('breakEndHour');
      const breakEndMinute = document.getElementById('breakEndMinute');
      
      console.log('íœ´ê²Œì‹œê°„ ìš”ì†Œ:', { breakStartHour, breakStartMinute, breakEndHour, breakEndMinute });
      
      populateHourOptions(breakStartHour);
      populateHourOptions(breakEndHour);
      populateMinuteOptions(breakStartMinute);
      populateMinuteOptions(breakEndMinute);
      
      console.log('âœ… ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì™„ë£Œ');
    }

    function populateHourOptions(select) {
      if (!select) return;
      for (let i = 0; i <= 23; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = String(i).padStart(2, '0') + 'ì‹œ';
        select.appendChild(option);
      }
    }

    function populateMinuteOptions(select) {
      if (!select) return;
      for (let i = 0; i <= 59; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = String(i).padStart(2, '0') + 'ë¶„';
        select.appendChild(option);
      }
      select.value = '0';
    }

    // ê·¼ë¬´ ì¼ì • ê´€ë¦¬
    function toggleDayForSchedule(button, scheduleIndex) {
      button.classList.toggle('active');
      updateWorkTimeDisplay();
    }

    let scheduleCounter = 1;

    function addSchedule() {
      const container = document.getElementById('workScheduleContainer');
      const newIndex = scheduleCounter++;
      
      const newItem = document.createElement('div');
      newItem.className = 'work-schedule-item';
      newItem.setAttribute('data-index', newIndex);
      
      newItem.innerHTML = `
        <div class="form-group">
          <label>ê·¼ë¬´ì¼ *</label>
          <div class="day-buttons">
            <button type="button" class="day-btn" data-day="ì›”" onclick="toggleDayForSchedule(this, ${newIndex})">ì›”</button>
            <button type="button" class="day-btn" data-day="í™”" onclick="toggleDayForSchedule(this, ${newIndex})">í™”</button>
            <button type="button" class="day-btn" data-day="ìˆ˜" onclick="toggleDayForSchedule(this, ${newIndex})">ìˆ˜</button>
            <button type="button" class="day-btn" data-day="ëª©" onclick="toggleDayForSchedule(this, ${newIndex})">ëª©</button>
            <button type="button" class="day-btn" data-day="ê¸ˆ" onclick="toggleDayForSchedule(this, ${newIndex})">ê¸ˆ</button>
            <button type="button" class="day-btn" data-day="í† " onclick="toggleDayForSchedule(this, ${newIndex})">í† </button>
            <button type="button" class="day-btn" data-day="ì¼" onclick="toggleDayForSchedule(this, ${newIndex})">ì¼</button>
          </div>
        </div>
        <div class="form-row" style="align-items: flex-end;">
          <div class="form-group">
            <label>ì‹œì‘ ì‹œê°„ *</label>
            <div style="display: flex; gap: 8px;">
              <select class="schedule-start-hour" required onchange="updateWorkTimeDisplay()">
                <option value="">ì‹œ</option>
              </select>
              <select class="schedule-start-minute" required onchange="updateWorkTimeDisplay()">
                <option value="">ë¶„</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>ì¢…ë£Œ ì‹œê°„ *</label>
            <div style="display: flex; gap: 8px;">
              <select class="schedule-end-hour" required onchange="updateWorkTimeDisplay()">
                <option value="">ì‹œ</option>
              </select>
              <select class="schedule-end-minute" required onchange="updateWorkTimeDisplay()">
                <option value="">ë¶„</option>
              </select>
            </div>
          </div>
          <button type="button" class="btn btn-danger btn-sm" onclick="removeSchedule(${newIndex})" style="height: 42px; margin-bottom: 0;">ì‚­ì œ</button>
        </div>
      `;
      
      container.appendChild(newItem);
      
      const newStartHour = newItem.querySelector('.schedule-start-hour');
      const newStartMinute = newItem.querySelector('.schedule-start-minute');
      const newEndHour = newItem.querySelector('.schedule-end-hour');
      const newEndMinute = newItem.querySelector('.schedule-end-minute');
      
      populateHourOptions(newStartHour);
      populateHourOptions(newEndHour);
      populateMinuteOptions(newStartMinute);
      populateMinuteOptions(newEndMinute);
      
      const firstDeleteBtn = container.querySelector('[data-index="0"] .btn-danger');
      if (firstDeleteBtn) firstDeleteBtn.style.display = 'inline-block';
    }

    function removeSchedule(index) {
      const item = document.querySelector(`[data-index="${index}"]`);
      if (item) {
        item.remove();
        updateWorkTimeDisplay();
        
        const container = document.getElementById('workScheduleContainer');
        if (container.children.length === 1) {
          const firstDeleteBtn = container.querySelector('.btn-danger');
          if (firstDeleteBtn) firstDeleteBtn.style.display = 'none';
        }
      }
    }

    function updateWorkTimeDisplay() {
      const allDays = [];
      const schedules = [];
      
      const scheduleItems = document.querySelectorAll('.work-schedule-item');
      
      scheduleItems.forEach((item) => {
        const selectedDays = [];
        
        const activeDayBtns = item.querySelectorAll('.day-btn.active');
        activeDayBtns.forEach(btn => {
          const day = btn.getAttribute('data-day');
          selectedDays.push(day);
          if (!allDays.includes(day)) {
            allDays.push(day);
          }
        });
        
        const startHour = item.querySelector('.schedule-start-hour')?.value;
        const startMinute = item.querySelector('.schedule-start-minute')?.value;
        const endHour = item.querySelector('.schedule-end-hour')?.value;
        const endMinute = item.querySelector('.schedule-end-minute')?.value;
        
        if (selectedDays.length > 0 && startHour !== '' && startMinute !== '' && endHour !== '' && endMinute !== '') {
          const startTime = `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`;
          const endTime = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;
          schedules.push(`${selectedDays.join(', ')}: ${startTime}~${endTime}`);
        }
      });
      
      document.getElementById('workDays').value = allDays.join(', ');
      document.getElementById('workTime').value = schedules.join(' / ');
    }

    // íœ´ê²Œì‹œê°„ ê´€ë¦¬
    function updateBreakTimeDisplay() {
      const hour = document.getElementById('breakTimeHour')?.value;
      const minute = document.getElementById('breakTimeMinute')?.value;
      const startHour = document.getElementById('breakStartHour')?.value;
      const startMinute = document.getElementById('breakStartMinute')?.value;
      const endHour = document.getElementById('breakEndHour')?.value;
      const endMinute = document.getElementById('breakEndMinute')?.value;
      
      let breakTimeText = '';
      
      if (hour || minute) {
        const h = hour || '0';
        const m = minute || '0';
        breakTimeText = `${h}ì‹œê°„ ${m}ë¶„`;
        
        if (startHour !== '' && startMinute !== '' && endHour !== '' && endMinute !== '') {
          const start = `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`;
          const end = `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`;
          breakTimeText += ` (${start}~${end})`;
        }
      }
      
      document.getElementById('breakTime').value = breakTimeText;
      const previewEl = document.getElementById('breakTimePreview');
      if (previewEl) previewEl.textContent = breakTimeText ? `íœ´ê²Œì‹œê°„: ${breakTimeText}` : '';
    }

    // ìœ íš¨ì„± ê²€ì‚¬
    function validateForm() {
      const requiredFields = [
        { id: 'employeeName', name: 'ì´ë¦„' },
        { id: 'employeeBirth', name: 'ìƒë…„ì›”ì¼' },
        { id: 'employeeAddress', name: 'ì£¼ì†Œ' },
        { id: 'employeePhone', name: 'ì—°ë½ì²˜' },
        { id: 'storeSelect', name: 'ë§¤ì¥' },
        { id: 'contractType', name: 'ê³„ì•½ ìœ í˜•' },
        { id: 'workStore', name: 'ê·¼ë¬´ ë§¤ì¥' },
        { id: 'startDate', name: 'ê³„ì•½ ì‹œì‘ì¼' },
        { id: 'position', name: 'ì§ì±…/ì§ë¬´' },
        { id: 'wageType', name: 'ê¸‰ì—¬ í˜•íƒœ' },
        { id: 'wageAmount', name: 'ê¸‰ì—¬ì•¡' },
        { id: 'paymentDay', name: 'ê¸‰ì—¬ ì§€ê¸‰ì¼' },
        { id: 'paymentMethod', name: 'ê¸‰ì—¬ ì§€ê¸‰ ë°©ë²•' }
      ];
      
      for (const field of requiredFields) {
        const element = document.getElementById(field.id);
        if (!element || !element.value || element.value.trim() === '') {
          alert(`âš ï¸ ${field.name}ì„(ë¥¼) ì…ë ¥í•´ì£¼ì„¸ìš”.`);
          if (element) element.focus();
          return false;
        }
      }
      
      const workDays = document.getElementById('workDays').value;
      const workTime = document.getElementById('workTime').value;
      
      if (!workDays || workDays.trim() === '') {
        alert('âš ï¸ ê·¼ë¬´ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return false;
      }
      
      if (!workTime || workTime.trim() === '') {
        alert('âš ï¸ ê·¼ë¬´ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
        return false;
      }
      
      return true;
    }

    // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updatePreview() {
      console.log('ğŸ” ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸');
      
      // í•„ìˆ˜ ìš”ì†Œ ì²´í¬
      const employeeNameEl = document.getElementById('employeeName');
      if (!employeeNameEl) {
        console.log('â„¹ï¸ í¼ ìš”ì†Œê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•ŠìŒ');
        return;
      }
      
      // ì§ì›(ê·¼ë¡œì) ì •ë³´
      const employeeName = employeeNameEl.value;
      const employeeBirth = document.getElementById('employeeBirth')?.value || '';
      const employeeAddress = document.getElementById('employeeAddress')?.value || '';
      const employeePhone = document.getElementById('employeePhone')?.value || '';
      
      document.getElementById('previewName').textContent = employeeName || '_______';
      document.getElementById('previewEmployeeName').textContent = employeeName || '_______';
      document.getElementById('previewEmployeeName2').textContent = employeeName || '_______';
      document.getElementById('previewBirth').textContent = employeeBirth || '_______';
      document.getElementById('previewAddress').textContent = employeeAddress || '_______';
      document.getElementById('previewPhone').textContent = employeePhone || '_______';
      
      // ì£¼ë¯¼ë²ˆí˜¸ë„ í‘œì‹œ (ìƒë…„ì›”ì¼ inputì—ì„œ ê°€ì ¸ì˜¨ ê°’ ë˜ëŠ” ì›ë³¸ ì£¼ë¯¼ë²ˆí˜¸)
      // employeeBirthê°€ YYYY-MM-DD í˜•ì‹ì´ë©´ ë³€í™˜, ì•„ë‹ˆë©´ ê·¸ëŒ€ë¡œ í‘œì‹œ
      const birthFormatted = employeeBirth ? employeeBirth.replace(/-/g, '.') : '_______';
      const previewSSN = document.getElementById('previewSSN');
      if (previewSSN) previewSSN.textContent = birthFormatted;
      
      // íšŒì‚¬(ì‚¬ìš©ì) ì •ë³´ - storeSelectì—ì„œ ê°€ì ¸ì˜¤ê¸°
      const storeSelectEl = document.getElementById('storeSelect');
      if (!storeSelectEl) {
        console.log('â„¹ï¸ storeSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        return;
      }
      
      // í¼ì—ì„œ ì§ì ‘ ì½ì–´ì˜¨ ê°’ ì‚¬ìš© (ì´ë¯¸ loadStoreInfoToContractì—ì„œ ì±„ì›Œì§)
      const companyName = document.getElementById('workStore')?.value || '(ì£¼)ABCë””ì €íŠ¸ì„¼í„°';
      const companyCEO = document.getElementById('companyCEO')?.value || '_______';
      const companyBusinessNumber = document.getElementById('companyBusinessNumber')?.value || '_______';
      const companyPhone = document.getElementById('companyPhone')?.value || '_______';
      const companyAddress = document.getElementById('companyAddress')?.value || '_______';
      
      document.getElementById('previewCompanyName').textContent = companyName;
      document.getElementById('previewCompanyName2').textContent = companyName;
      document.getElementById('previewCEO').textContent = companyCEO;
      
      // ì‚¬ìš©ì(íšŒì‚¬) ìƒì„¸ì •ë³´ í‘œì‹œ
      const previewCompanyNameDetail = document.getElementById('previewCompanyNameDetail');
      if (previewCompanyNameDetail) previewCompanyNameDetail.textContent = companyName;
      
      const previewCEODetail = document.getElementById('previewCEODetail');
      if (previewCEODetail) previewCEODetail.textContent = companyCEO;
      
      const previewBusinessNumber = document.getElementById('previewBusinessNumber');
      if (previewBusinessNumber) previewBusinessNumber.textContent = companyBusinessNumber;
      
      const previewCompanyPhone = document.getElementById('previewCompanyPhone');
      if (previewCompanyPhone) previewCompanyPhone.textContent = companyPhone;
      
      const previewCompanyAddress = document.getElementById('previewCompanyAddress');
      if (previewCompanyAddress) previewCompanyAddress.textContent = companyAddress;
      
      document.getElementById('previewStartDate').textContent = document.getElementById('startDate').value || '_______';
      const endDate = document.getElementById('endDate').value;
      document.getElementById('previewEndDate').textContent = endDate || 'ê¸°ê°„ì˜ ì •í•¨ì´ ì—†ìŒ';
      document.getElementById('previewStore').textContent = document.getElementById('workStore').value || '_______';
      document.getElementById('previewPosition').textContent = document.getElementById('position').value || '_______';
      
      document.getElementById('previewWorkDays').textContent = document.getElementById('workDays').value || '_______';
      document.getElementById('previewWorkTime').textContent = document.getElementById('workTime').value || '_______';
      document.getElementById('previewBreakTime').textContent = document.getElementById('breakTime').value || 'ì—†ìŒ';
      
      document.getElementById('previewWageType').textContent = document.getElementById('wageType').value || '_______';
      const wageAmount = document.getElementById('wageAmount').value;
      document.getElementById('previewWageAmount').textContent = wageAmount ? Number(wageAmount).toLocaleString() : '_______';
      document.getElementById('previewPaymentDay').textContent = document.getElementById('paymentDay').value || '_______';
      document.getElementById('previewPaymentMethod').textContent = document.getElementById('paymentMethod').value || '_______';
      
      const contractContent = document.getElementById('contractContent').value;
      const bodyDiv = document.getElementById('previewContractBody');
      if (contractContent && contractContent.trim()) {
        bodyDiv.innerHTML = '<div style="white-space: pre-wrap; line-height: 1.8; margin: 30px 0;">' + contractContent + '</div>';
      } else {
        bodyDiv.innerHTML = '';
      }
      
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      document.getElementById('previewContractDate').textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
      
      console.log('âœ… ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ ì™„ë£Œ');
    }

    // ê³„ì•½ì„œ í…œí”Œë¦¿
    function loadDefaultTemplate() {
      console.log('ğŸ“„ ê¸°ë³¸ í…œí”Œë¦¿ ë¡œë“œ ì‹œì‘');
      const contentEl = document.getElementById('contractContent');
      console.log('contractContent ìš”ì†Œ:', contentEl);
      if (!contentEl) {
        console.error('âŒ contractContent ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
        return;
      }
      
      const template = `ì œ1ì¡° (ê·¼ë¡œê³„ì•½ ê¸°ê°„)
ë³¸ ê³„ì•½ì˜ ê¸°ê°„ì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.

ì œ2ì¡° (ê·¼ë¬´ ì¥ì†Œ ë° ì—…ë¬´ ë‚´ìš©)
ê·¼ë¡œìëŠ” ìœ„ í‘œì— ëª…ì‹œëœ ê·¼ë¬´ ì¥ì†Œì—ì„œ ëª…ì‹œëœ ì—…ë¬´ë¥¼ ìˆ˜í–‰í•œë‹¤.

ì œ3ì¡° (ê·¼ë¡œì‹œê°„ ë° íœ´ê²Œì‹œê°„)
1. ê·¼ë¡œì‹œê°„ì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.
2. íœ´ê²Œì‹œê°„ì€ ê·¼ë¡œì‹œê°„ ì¤‘ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.

ì œ4ì¡° (ê·¼ë¬´ì¼ ë° íœ´ì¼)
1. ê·¼ë¬´ì¼ì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.
2. ì£¼íœ´ì¼ì€ ê·¼ë¡œê¸°ì¤€ë²•ì— ë”°ë¼ ë¶€ì—¬í•œë‹¤.

ì œ5ì¡° (ì„ê¸ˆ)
1. ê·¼ë¡œìì˜ ì„ê¸ˆì€ ìœ„ í‘œì— ëª…ì‹œëœ ë°”ì™€ ê°™ë‹¤.
2. ì„ê¸ˆì€ ìœ„ í‘œì— ëª…ì‹œëœ ì§€ê¸‰ì¼ì— ì§€ê¸‰í•œë‹¤.
3. ì—°ì¥Â·ì•¼ê°„Â·íœ´ì¼ ê·¼ë¡œ ì‹œì—ëŠ” ê·¼ë¡œê¸°ì¤€ë²•ì— ë”°ë¼ ê°€ì‚°ì„ê¸ˆì„ ì§€ê¸‰í•œë‹¤.

ì œ6ì¡° (ì—°ì°¨ìœ ê¸‰íœ´ê°€)
ì—°ì°¨ìœ ê¸‰íœ´ê°€ëŠ” ê·¼ë¡œê¸°ì¤€ë²•ì— ë”°ë¼ ë¶€ì—¬í•œë‹¤.

ì œ7ì¡° (ì‚¬íšŒë³´í—˜ ê°€ì…)
ì‚¬ìš©ìëŠ” ê·¼ë¡œìë¥¼ 4ëŒ€ ì‚¬íšŒë³´í—˜ì— ê°€ì…ì‹œí‚¨ë‹¤.

ì œ8ì¡° (ê³„ì•½ì˜ í•´ì§€)
1. ë³¸ ê³„ì•½ì„ í•´ì§€í•˜ê³ ì í•  ë•ŒëŠ” 30ì¼ ì „ì— ì˜ˆê³ í•˜ì—¬ì•¼ í•œë‹¤.
2. í•´ê³  ì˜ˆê³  ê¸°ê°„ì„ ë‘ì§€ ì•Šì„ ê²½ìš° 30ì¼ë¶„ì˜ í†µìƒì„ê¸ˆì„ ì§€ê¸‰í•œë‹¤.

ì œ9ì¡° (ê¸°íƒ€)
ì´ ê³„ì•½ì„œì— ëª…ì‹œë˜ì§€ ì•Šì€ ì‚¬í•­ì€ ê·¼ë¡œê¸°ì¤€ë²• ë° ê´€ê³„ ë²•ë ¹ì— ë”°ë¥¸ë‹¤.`;

      contentEl.value = template;
      console.log('âœ… ê¸°ë³¸ í…œí”Œë¦¿ ë¡œë“œ ì™„ë£Œ');
    }

    // ìŠ¤ì¼€ì¤„ ë°ì´í„° ìˆ˜ì§‘ ë° ë³µì›
    function collectScheduleData() {
      const schedules = [];
      const scheduleItems = document.querySelectorAll('.work-schedule-item');
      
      scheduleItems.forEach((item, index) => {
        const selectedDays = [];
        const activeDayBtns = item.querySelectorAll('.day-btn.active');
        activeDayBtns.forEach(btn => {
          selectedDays.push(btn.getAttribute('data-day'));
        });
        
        const startHour = item.querySelector('.schedule-start-hour')?.value || '';
        const startMinute = item.querySelector('.schedule-start-minute')?.value || '';
        const endHour = item.querySelector('.schedule-end-hour')?.value || '';
        const endMinute = item.querySelector('.schedule-end-minute')?.value || '';
        
        schedules.push({
          index: index,
          days: selectedDays,
          startHour: startHour,
          startMinute: startMinute,
          endHour: endHour,
          endMinute: endMinute
        });
      });
      
      return schedules;
    }

    function restoreScheduleData(schedules, breakTimeData) {
      if (!schedules || schedules.length === 0) return;
      
      const container = document.getElementById('workScheduleContainer');
      const items = container.querySelectorAll('.work-schedule-item');
      for (let i = items.length - 1; i > 0; i--) {
        items[i].remove();
      }
      
      schedules.forEach((schedule, index) => {
        let scheduleItem;
        
        if (index === 0) {
          scheduleItem = container.querySelector('.work-schedule-item[data-index="0"]');
        } else {
          addSchedule();
          scheduleItem = container.querySelector(`.work-schedule-item[data-index="${scheduleCounter - 1}"]`);
        }
        
        if (scheduleItem) {
          schedule.days.forEach(day => {
            const dayBtn = scheduleItem.querySelector(`.day-btn[data-day="${day}"]`);
            if (dayBtn) {
              dayBtn.classList.add('active');
            }
          });
          
          const startHourSelect = scheduleItem.querySelector('.schedule-start-hour');
          const startMinuteSelect = scheduleItem.querySelector('.schedule-start-minute');
          const endHourSelect = scheduleItem.querySelector('.schedule-end-hour');
          const endMinuteSelect = scheduleItem.querySelector('.schedule-end-minute');
          
          if (startHourSelect) startHourSelect.value = schedule.startHour;
          if (startMinuteSelect) startMinuteSelect.value = schedule.startMinute;
          if (endHourSelect) endHourSelect.value = schedule.endHour;
          if (endMinuteSelect) endMinuteSelect.value = schedule.endMinute;
        }
      });
      
      if (breakTimeData) {
        if (breakTimeData.hour) document.getElementById('breakTimeHour').value = breakTimeData.hour;
        if (breakTimeData.minute) document.getElementById('breakTimeMinute').value = breakTimeData.minute;
        if (breakTimeData.startHour) document.getElementById('breakStartHour').value = breakTimeData.startHour;
        if (breakTimeData.startMinute) document.getElementById('breakStartMinute').value = breakTimeData.startMinute;
        if (breakTimeData.endHour) document.getElementById('breakEndHour').value = breakTimeData.endHour;
        if (breakTimeData.endMinute) document.getElementById('breakEndMinute').value = breakTimeData.endMinute;
      }
      
      updateWorkTimeDisplay();
      updateBreakTimeDisplay();
    }

    // ê³„ì•½ì„œ ì €ì¥
    function showSaveContractModal() {
      // ì„ì‹œ ì €ì¥ì€ validation ì—†ì´ ê°€ëŠ¥
      document.getElementById('saveContractModal').style.display = 'flex';
      const employeeName = document.getElementById('employeeName').value || 'ì§ì›ë¯¸ì •';
      const position = document.getElementById('position').value || 'ì§ì±…ë¯¸ì •';
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('contractSaveName').value = `${employeeName}_${position}_${today}`;
    }

    function closeSaveContractModal() {
      document.getElementById('saveContractModal').style.display = 'none';
      document.getElementById('contractSaveName').value = '';
    }

    async function saveContract() {
      const contractName = document.getElementById('contractSaveName').value.trim();
      
      if (!contractName) {
        alert('âš ï¸ ê³„ì•½ì„œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì„ì‹œ ì €ì¥ì€ validation ì—†ì´ ì§„í–‰ (ì‘ì„± ì¤‘ì¸ ë‚´ìš© ê·¸ëŒ€ë¡œ ì €ì¥)
      const schedules = collectScheduleData();
      
      const breakTimeData = {
        hour: document.getElementById('breakTimeHour')?.value || '',
        minute: document.getElementById('breakTimeMinute')?.value || '',
        startHour: document.getElementById('breakStartHour')?.value || '',
        startMinute: document.getElementById('breakStartMinute')?.value || '',
        endHour: document.getElementById('breakEndHour')?.value || '',
        endMinute: document.getElementById('breakEndMinute')?.value || ''
      };
      
      const contractData = {
        name: contractName,
        employeeId: document.getElementById('employeeSelect')?.value || '',
        employeeName: document.getElementById('employeeName')?.value || '',
        employeeBirth: document.getElementById('employeeBirth')?.value || '',
        employeeAddress: document.getElementById('employeeAddress')?.value || '',
        employeePhone: document.getElementById('employeePhone')?.value || '',
        storeId: document.getElementById('storeSelect')?.value || '',
        companyName: document.getElementById('workStore')?.value || '',
        companyCEO: document.getElementById('companyCEO')?.value || '',
        companyBusinessNumber: document.getElementById('companyBusinessNumber')?.value || '',
        companyPhone: document.getElementById('companyPhone')?.value || '',
        companyAddress: document.getElementById('companyAddress')?.value || '',
        contractType: document.getElementById('contractType')?.value || '',
        workStore: document.getElementById('workStore')?.value || '',
        startDate: document.getElementById('startDate')?.value || '',
        endDate: document.getElementById('endDate')?.value || '',
        position: document.getElementById('position')?.value || '',
        workDays: document.getElementById('workDays')?.value || '',
        workTime: document.getElementById('workTime')?.value || '',
        breakTime: document.getElementById('breakTime')?.value || '',
        wageType: document.getElementById('wageType')?.value || '',
        wageAmount: document.getElementById('wageAmount')?.value || '',
        paymentDay: document.getElementById('paymentDay')?.value || '',
        paymentMethod: document.getElementById('paymentMethod')?.value || '',
        contractContent: document.getElementById('contractContent')?.value || '',
        schedules: schedules || [],
        breakTimeData: breakTimeData || {},
        savedAt: new Date().toISOString(),
        // ê¸‰ì—¬ ì§€ê¸‰ í•­ëª© ì„¤ì •
        allowances: {
          weeklyHoliday: document.getElementById('allowWeeklyHoliday')?.checked || false,
          overtime: document.getElementById('allowOvertime')?.checked || false,
          night: document.getElementById('allowNight')?.checked || false,
          holiday: document.getElementById('allowHoliday')?.checked || false
        },
        // 4ëŒ€ë³´í—˜ ì ìš© ì„¤ì •
        insurance: {
          type: document.getElementById('insuranceType')?.value || '',
          severancePay: document.getElementById('allowSeverancePay')?.checked || false
        }
      };
      
      try {
        // Firestoreì—ì„œ ê°™ì€ ì´ë¦„ì˜ ê³„ì•½ì„œê°€ ìˆëŠ”ì§€ í™•ì¸
        const existingSnapshot = await firebase.firestore().collection('savedContracts')
          .where('name', '==', contractName)
          .where('createdBy', '==', firebase.auth().currentUser.uid)
          .limit(1)
          .get();
        
        if (!existingSnapshot.empty) {
          if (!confirm('âš ï¸ ê°™ì€ ì´ë¦„ì˜ ê³„ì•½ì„œê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.\në®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            return;
          }
          // ê¸°ì¡´ ë¬¸ì„œ ì—…ë°ì´íŠ¸
          const existingDocId = existingSnapshot.docs[0].id;
          await firebase.firestore().collection('savedContracts').doc(existingDocId).update({
            ...contractData,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          console.log('âœ… ê³„ì•½ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', existingDocId);
        } else {
          // ìƒˆ ë¬¸ì„œ ìƒì„±
          contractData.createdBy = firebase.auth().currentUser.uid;
          contractData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          const docRef = await firebase.firestore().collection('savedContracts').add(contractData);
          console.log('âœ… ê³„ì•½ì„œ ì €ì¥ ì™„ë£Œ:', docRef.id);
        }
        
        closeSaveContractModal();
        alert('âœ… ê³„ì•½ì„œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (error) {
        console.error('âŒ ê³„ì•½ì„œ ì €ì¥ ì‹¤íŒ¨:', error);
        alert('ê³„ì•½ì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì €ì¥ëœ ê³„ì•½ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    async function showLoadContractModal() {
      const listDiv = document.getElementById('savedContractsList');
      listDiv.innerHTML = '<p style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary);">ê³„ì•½ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
      
      document.getElementById('loadContractModal').style.display = 'flex';
      
      try {
        // Firestoreì—ì„œ ì €ì¥ëœ ê³„ì•½ì„œ ê°€ì ¸ì˜¤ê¸°
        const snapshot = await firebase.firestore().collection('savedContracts')
          .where('createdBy', '==', firebase.auth().currentUser.uid)
          .get();
        
        savedContracts = [];
        snapshot.forEach(doc => {
          savedContracts.push({ id: doc.id, ...doc.data() });
        });
        
        // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‚ ì§œ ê¸°ì¤€ ì •ë ¬ (ìµœì‹ ìˆœ)
        savedContracts.sort((a, b) => {
          const dateA = a.savedAt ? new Date(a.savedAt).getTime() : 0;
          const dateB = b.savedAt ? new Date(b.savedAt).getTime() : 0;
          return dateB - dateA; // ë‚´ë¦¼ì°¨ìˆœ
        });
        
        if (savedContracts.length === 0) {
          listDiv.innerHTML = '<p style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary);">ì €ì¥ëœ ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
          listDiv.innerHTML = savedContracts.map((contract, index) => {
            const displayName = contract.name || `${contract.employeeName} - ${contract.position}`;
            const savedDate = contract.savedAt ? new Date(contract.savedAt).toLocaleString('ko-KR', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit'
            }) : 'ë‚ ì§œ ë¯¸ìƒ';
            
            return `
              <div style="padding: var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: var(--spacing-sm); cursor: pointer; transition: all 0.2s ease; display: flex; justify-content: space-between; align-items: center;" onmouseover="this.style.borderColor='var(--primary-color)'; this.style.backgroundColor='var(--bg-light)';" onmouseout="this.style.borderColor='var(--border-color)'; this.style.backgroundColor='white';" onclick="loadSavedContract(${index})">
                <div>
                  <div style="font-weight: 600; margin-bottom: 4px; font-size: 15px;">ğŸ“„ ${displayName}</div>
                  <div style="font-size: 13px; color: var(--text-secondary);">${savedDate}</div>
                </div>
                <button onclick="event.stopPropagation(); deleteSavedContract('${contract.id}', ${index});" style="padding: 6px 12px; background: var(--danger-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button>
              </div>
            `;
          }).join('');
        }
        
        console.log(`âœ… ${savedContracts.length}ê°œ ì €ì¥ëœ ê³„ì•½ì„œ ë¡œë“œ ì™„ë£Œ`);
      } catch (error) {
        console.error('âŒ ê³„ì•½ì„œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        listDiv.innerHTML = '<p style="text-align: center; padding: var(--spacing-xl); color: var(--danger-color);">ê³„ì•½ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
      }
    }

    function closeLoadContractModal() {
      document.getElementById('loadContractModal').style.display = 'none';
    }

    function loadSavedContract(index) {
      const contract = savedContracts[index];
      
      if (confirm('í˜„ì¬ ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        // ì§ì› ì„ íƒ
        if (contract.employeeId) {
          document.getElementById('employeeSelect').value = contract.employeeId;
          loadEmployeeInfo();
        }
        
        // ë§¤ì¥ ì„ íƒ (storeId ì‚¬ìš©)
        if (contract.storeId) {
          document.getElementById('storeSelect').value = contract.storeId;
          loadStoreInfoToContract();
        }
        
        document.getElementById('contractType').value = contract.contractType;
        document.getElementById('workStore').value = contract.workStore;
        document.getElementById('startDate').value = contract.startDate;
        document.getElementById('endDate').value = contract.endDate;
        document.getElementById('position').value = contract.position;
        document.getElementById('wageType').value = contract.wageType;
        document.getElementById('wageAmount').value = contract.wageAmount;
        document.getElementById('paymentDay').value = contract.paymentDay;
        document.getElementById('paymentMethod').value = contract.paymentMethod;
        document.getElementById('contractContent').value = contract.contractContent;
        
        // ê¸‰ì—¬ ì§€ê¸‰ í•­ëª© ë³µì›
        if (contract.allowances) {
          document.getElementById('allowWeeklyHoliday').checked = contract.allowances.weeklyHoliday || false;
          document.getElementById('allowOvertime').checked = contract.allowances.overtime || false;
          document.getElementById('allowNight').checked = contract.allowances.night || false;
          document.getElementById('allowHoliday').checked = contract.allowances.holiday || false;
        }
        
        // 4ëŒ€ë³´í—˜ ì„¤ì • ë³µì›
        if (contract.insurance) {
          document.getElementById('insuranceType').value = contract.insurance.type || '';
          updateInsuranceInfo(); // ë³´í—˜ ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
          document.getElementById('allowSeverancePay').checked = contract.insurance.severancePay || false;
        }
        
        if (contract.schedules && contract.schedules.length > 0) {
          restoreScheduleData(contract.schedules, contract.breakTimeData);
        }
        
        closeLoadContractModal();
        alert('âœ… ê³„ì•½ì„œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteSavedContract(docId, index) {
      const contract = savedContracts[index];
      const displayName = contract.name || `${contract.employeeName} - ${contract.position}`;
      
      if (confirm(`"${displayName}" ê³„ì•½ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        try {
          // Firestoreì—ì„œ ì‚­ì œ
          await firebase.firestore().collection('savedContracts').doc(docId).delete();
          console.log('âœ… ê³„ì•½ì„œ ì‚­ì œ ì™„ë£Œ:', docId);
          
          // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          showLoadContractModal();
          alert('âœ… ê³„ì•½ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (error) {
          console.error('âŒ ê³„ì•½ì„œ ì‚­ì œ ì‹¤íŒ¨:', error);
          alert('ê³„ì•½ì„œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }
    }

    // ê³„ì•½ì„œ ìƒì„±
    async function generateContract() {
      console.log('ğŸ“ ê³„ì•½ì„œ ìƒì„± ì‹œì‘');
      
      // ìœ íš¨ì„± ê²€ì‚¬
      if (!validateForm()) {
        alert('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const contractId = 'C' + Date.now();
      // í˜„ì¬ í˜ì´ì§€ì˜ ë””ë ‰í† ë¦¬ ê²½ë¡œ ì¶”ì¶œ
      const currentPath = window.location.pathname;
      const directory = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
      const baseUrl = window.location.origin + directory;
      const signLink = `${baseUrl}contract-sign.html?id=${contractId}`;
      console.log('ğŸ”— ì„œëª… ë§í¬ ìƒì„±:', signLink);
      
      // Firestoreì—ì„œ stores ê°€ì ¸ì˜¤ê¸°
      const storesSnapshot = await firebase.firestore().collection('stores').get();
      const stores = [];
      storesSnapshot.forEach(doc => {
        stores.push({ id: doc.id, ...doc.data() });
      });
      
      const store = stores.find(s => s.id === document.getElementById('storeSelect').value);
      
      const contractData = {
        id: contractId,
        employeeName: document.getElementById('employeeName').value,
        employeeBirth: document.getElementById('employeeBirth').value,
        employeeAddress: document.getElementById('employeeAddress').value,
        employeePhone: document.getElementById('employeePhone').value,
        companyName: store?.name || '',
        companyCEO: store?.ceo || '',
        companyBusinessNumber: store?.businessNumber || '',
        companyPhone: store?.phone || '',
        companyAddress: store?.address || '',
        contractType: document.getElementById('contractType').value,
        workStore: document.getElementById('workStore').value,
        storeId: document.getElementById('storeSelect').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value || 'ê¸°ê°„ì˜ ì •í•¨ì´ ì—†ìŒ',
        position: document.getElementById('position').value,
        workDays: document.getElementById('workDays').value,
        workTime: document.getElementById('workTime').value,
        breakTime: document.getElementById('breakTime').value,
        wageType: document.getElementById('wageType').value,
        wageAmount: document.getElementById('wageAmount').value,
        paymentDay: document.getElementById('paymentDay').value,
        paymentMethod: document.getElementById('paymentMethod').value,
        contractContent: document.getElementById('contractContent').value,
        contractDate: new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' }),
        createdAt: new Date().toISOString(),
        signLink: signLink,
        createdBy: firebase.auth().currentUser?.uid || 'unknown',
        // ê¸‰ì—¬ ì§€ê¸‰ í•­ëª© ì„¤ì •
        allowances: {
          weeklyHoliday: document.getElementById('allowWeeklyHoliday').checked,
          overtime: document.getElementById('allowOvertime').checked,
          night: document.getElementById('allowNight').checked,
          holiday: document.getElementById('allowHoliday').checked
        },
        // 4ëŒ€ë³´í—˜ ì ìš© ì„¤ì •
        insurance: {
          type: document.getElementById('insuranceType').value,
          severancePay: document.getElementById('allowSeverancePay').checked
        }
      };
      
      console.log('ğŸ’¾ ê³„ì•½ì„œ ë°ì´í„° Firestore ì €ì¥:', contractId);
      
      try {
        // Firestoreì— ì €ì¥ (ë¬¸ì„œ IDë¥¼ contractIdë¡œ ì§€ì •)
        await firebase.firestore().collection('contracts').doc(contractId).set(contractData);
        console.log('âœ… Firestore ì €ì¥ ì™„ë£Œ:', contractId);
        
        // ì„œëª… ë§í¬ í‘œì‹œ
        document.getElementById('signLinkSection').style.display = 'block';
        document.getElementById('contractIdDisplay').textContent = contractId;
        document.getElementById('signLinkInput').value = signLink;
        
        alert(`âœ… ê³„ì•½ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê³„ì•½ì„œ ID: ${contractId}\n\nì„œëª… ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë©ë‹ˆë‹¤.`);
        
        // ì„œëª… ë§í¬ ìë™ ë³µì‚¬
        const input = document.getElementById('signLinkInput');
        input.select();
        document.execCommand('copy');
        
        // 3ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê³  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          console.log('ğŸ”„ ëª¨ë‹¬ ë‹«ê¸° ë° ëª©ë¡ ìƒˆë¡œê³ ì¹¨');
          closeContractModal();
          loadContracts(); // ê³„ì•½ì„œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          switchTab('contracts'); // ê³„ì•½ì„œ ê´€ë¦¬ íƒ­ìœ¼ë¡œ ì´ë™
        }, 3000);
      } catch (error) {
        console.error('âŒ Firestore ì €ì¥ ì‹¤íŒ¨:', error);
        alert('âŒ ê³„ì•½ì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    function copySignLink() {
      const input = document.getElementById('signLinkInput');
      input.select();
      document.execCommand('copy');
      alert('âœ… ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  </script>

  <!-- ê³„ì•½ì„œ ì‘ì„± ëª¨ë‹¬ -->
  <div id="contractModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2 style="margin: 0;">ğŸ“ ê·¼ë¡œê³„ì•½ì„œ ì‘ì„±</h2>
        <button class="modal-close" onclick="closeContractModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- íƒ­ ë° ì €ì¥ëœ ê³„ì•½ì„œ ë¶ˆëŸ¬ì˜¤ê¸° -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
          <div class="tab-buttons" style="margin-bottom: 0;">
            <button id="formTabBtn" class="tab-button active" onclick="switchContractTab('form')">âœï¸ ì‘ì„±í•˜ê¸°</button>
            <button id="previewTabBtn" class="tab-button" onclick="switchContractTab('preview')">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
          </div>
          <button class="btn btn-secondary" onclick="showLoadContractModal()">ğŸ“‚ ì €ì¥ëœ ê³„ì•½ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>

        <!-- ì‘ì„± í¼ íƒ­ -->
        <div id="formTab" class="tab-content active">
          <!-- 1. ì§ì› ë° ì‚¬ìš©ì ì •ë³´ -->
          <div class="form-section">
            <h3>1. ê¸°ë³¸ ì •ë³´</h3>
            
            <h4>ğŸ‘¤ ê·¼ë¡œì (ì§ì›) ì •ë³´</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="employeeSelect">ì§ì› ì„ íƒ *</label>
                <select id="employeeSelect" required onchange="loadEmployeeInfo(); updatePreview();">
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="employeeName">ì´ë¦„ *</label>
                <input type="text" id="employeeName" placeholder="ìë™ ì…ë ¥" readonly required>
              </div>
              <div class="form-group">
                <label for="employeeBirth">ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ *</label>
                <input type="text" id="employeeBirth" placeholder="123456-1234567" pattern="\d{6}-\d{7}" readonly required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="employeeAddress">ì£¼ì†Œ *</label>
                <input type="text" id="employeeAddress" required>
              </div>
              <div class="form-group">
                <label for="employeePhone">ì—°ë½ì²˜ *</label>
                <input type="tel" id="employeePhone" required>
              </div>
            </div>

            <h4>ğŸ¢ ì‚¬ìš©ì (íšŒì‚¬) ì •ë³´</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="storeSelect">ë§¤ì¥ ì„ íƒ *</label>
                <select id="storeSelect" required onchange="loadStoreInfoToContract(); updatePreview();">
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
            </div>
            <p class="help-text" style="margin-top: -12px; margin-bottom: 16px;">
              ğŸ’¡ ë§¤ì¥ ì •ë³´ëŠ” 'ë§¤ì¥ ê´€ë¦¬' íƒ­ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            <div class="form-row">
              <div class="form-group">
                <label for="companyCEO">ëŒ€í‘œìëª… *</label>
                <input type="text" id="companyCEO" placeholder="ìë™ ì…ë ¥" readonly required>
              </div>
              <div class="form-group">
                <label for="companyBusinessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ *</label>
                <input type="text" id="companyBusinessNumber" placeholder="ìë™ ì…ë ¥" readonly required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="companyPhone">íšŒì‚¬ ì—°ë½ì²˜ *</label>
                <input type="tel" id="companyPhone" placeholder="ìë™ ì…ë ¥" readonly required>
              </div>
              <div class="form-group">
                <label for="companyAddress">ì‚¬ì—…ì¥ ì£¼ì†Œ *</label>
                <input type="text" id="companyAddress" placeholder="ìë™ ì…ë ¥" readonly required>
              </div>
            </div>
          </div>

          <!-- 2. ê³„ì•½ ì •ë³´ -->
          <div class="form-section">
            <h3>2. ê³„ì•½ ì •ë³´</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="contractType">ê³„ì•½ ìœ í˜• *</label>
                <select id="contractType" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="ì •ê·œì§">ì •ê·œì§</option>
                  <option value="ê³„ì•½ì§">ê³„ì•½ì§</option>
                  <option value="ì‹œê°„ì œ">ì‹œê°„ì œ</option>
                </select>
              </div>
              <div class="form-group">
                <label for="workStore">ê·¼ë¬´ ë§¤ì¥ *</label>
                <input type="text" id="workStore" placeholder="ìë™ ì…ë ¥" readonly required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="startDate">ê³„ì•½ ì‹œì‘ì¼ *</label>
                <input type="date" id="startDate" required>
              </div>
              <div class="form-group">
                <label for="endDate">ê³„ì•½ ì¢…ë£Œì¼</label>
                <input type="date" id="endDate">
                <p class="help-text">ê¸°ê°„ì˜ ì •í•¨ì´ ì—†ëŠ” ê²½ìš° ë¹„ì›Œë‘ì„¸ìš”</p>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="position">ì§ì±…/ì§ë¬´ *</label>
                <input type="text" id="position" placeholder="ë°”ë¦¬ìŠ¤íƒ€, ë§¤ë‹ˆì € ë“±" required>
              </div>
            </div>
          </div>

          <!-- 3. ê·¼ë¬´ ì¡°ê±´ -->
          <div class="form-section">
            <h3>3. ê·¼ë¬´ ì¡°ê±´</h3>
            
            <!-- ê·¼ë¬´ ì‹œê°„ëŒ€ (ë‹¤ì¤‘ ìŠ¤ì¼€ì¤„) -->
            <div id="workScheduleContainer">
              <div class="work-schedule-item" data-index="0">
                <div class="form-group">
                  <label>ê·¼ë¬´ì¼ *</label>
                  <div class="day-buttons">
                    <button type="button" class="day-btn" data-day="ì›”" onclick="toggleDayForSchedule(this, 0)">ì›”</button>
                    <button type="button" class="day-btn" data-day="í™”" onclick="toggleDayForSchedule(this, 0)">í™”</button>
                    <button type="button" class="day-btn" data-day="ìˆ˜" onclick="toggleDayForSchedule(this, 0)">ìˆ˜</button>
                    <button type="button" class="day-btn" data-day="ëª©" onclick="toggleDayForSchedule(this, 0)">ëª©</button>
                    <button type="button" class="day-btn" data-day="ê¸ˆ" onclick="toggleDayForSchedule(this, 0)">ê¸ˆ</button>
                    <button type="button" class="day-btn" data-day="í† " onclick="toggleDayForSchedule(this, 0)">í† </button>
                    <button type="button" class="day-btn" data-day="ì¼" onclick="toggleDayForSchedule(this, 0)">ì¼</button>
                  </div>
                </div>
                <div class="form-row" style="align-items: flex-end;">
                  <div class="form-group">
                    <label>ì‹œì‘ ì‹œê°„ *</label>
                    <div style="display: flex; gap: 8px;">
                      <select class="schedule-start-hour" required onchange="updateWorkTimeDisplay()">
                        <option value="">ì‹œ</option>
                      </select>
                      <select class="schedule-start-minute" required onchange="updateWorkTimeDisplay()">
                        <option value="">ë¶„</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label>ì¢…ë£Œ ì‹œê°„ *</label>
                    <div style="display: flex; gap: 8px;">
                      <select class="schedule-end-hour" required onchange="updateWorkTimeDisplay()">
                        <option value="">ì‹œ</option>
                      </select>
                      <select class="schedule-end-minute" required onchange="updateWorkTimeDisplay()">
                        <option value="">ë¶„</option>
                      </select>
                    </div>
                  </div>
                  <button type="button" class="btn btn-danger btn-sm" onclick="removeSchedule(0)" style="display: none; height: 42px; margin-bottom: 0;">ì‚­ì œ</button>
                </div>
              </div>
            </div>
            
            <button type="button" class="btn btn-secondary btn-sm" onclick="addSchedule()" style="margin-top: 8px;">
              â• ì‹œê°„ëŒ€ ì¶”ê°€
            </button>
            <input type="hidden" id="workDays">
            <input type="hidden" id="workTime">

            <!-- íœ´ê²Œì‹œê°„ -->
            <div class="form-row" style="margin-top: var(--spacing-md);">
              <div class="form-group">
                <label>íœ´ê²Œì‹œê°„ (ì„ íƒì‚¬í•­)</label>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <select id="breakTimeHour" onchange="updateBreakTimeDisplay()">
                    <option value="">ì‹œê°„</option>
                    <option value="0">0ì‹œê°„</option>
                    <option value="1">1ì‹œê°„</option>
                    <option value="2">2ì‹œê°„</option>
                  </select>
                  <select id="breakTimeMinute" onchange="updateBreakTimeDisplay()">
                    <option value="">ë¶„</option>
                    <option value="0">0ë¶„</option>
                    <option value="15">15ë¶„</option>
                    <option value="30">30ë¶„</option>
                    <option value="45">45ë¶„</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>íœ´ê²Œì‹œê°„ ì‹œì‘ (ì„ íƒì‚¬í•­)</label>
                <div style="display: flex; gap: 8px;">
                  <select id="breakStartHour" onchange="updateBreakTimeDisplay()">
                    <option value="">ì‹œ</option>
                  </select>
                  <select id="breakStartMinute" onchange="updateBreakTimeDisplay()">
                    <option value="">ë¶„</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>íœ´ê²Œì‹œê°„ ì¢…ë£Œ (ì„ íƒì‚¬í•­)</label>
                <div style="display: flex; gap: 8px;">
                  <select id="breakEndHour" onchange="updateBreakTimeDisplay()">
                    <option value="">ì‹œ</option>
                  </select>
                  <select id="breakEndMinute" onchange="updateBreakTimeDisplay()">
                    <option value="">ë¶„</option>
                  </select>
                </div>
              </div>
            </div>
            <input type="hidden" id="breakTime">
            <p class="help-text" id="breakTimePreview" style="margin-top: 8px;"></p>
          </div>

          <!-- 4. ê¸‰ì—¬ ì¡°ê±´ -->
          <div class="form-section">
            <h3>4. ê¸‰ì—¬ ì¡°ê±´</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="wageType">ê¸‰ì—¬ í˜•íƒœ *</label>
                <select id="wageType" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="ì‹œê¸‰">ì‹œê¸‰</option>
                  <option value="ì›”ê¸‰">ì›”ê¸‰</option>
                  <option value="ì—°ë´‰">ì—°ë´‰</option>
                </select>
              </div>
              <div class="form-group">
                <label for="wageAmount">ê¸‰ì—¬ì•¡ *</label>
                <input type="number" id="wageAmount" placeholder="ê¸ˆì•¡ ì…ë ¥" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="paymentDay">ê¸‰ì—¬ ì§€ê¸‰ì¼ *</label>
                <select id="paymentDay" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="ë§¤ì›” 10ì¼">ë§¤ì›” 10ì¼</option>
                  <option value="ë§¤ì›” 25ì¼">ë§¤ì›” 25ì¼</option>
                  <option value="ë§¤ì›” ë§ì¼">ë§¤ì›” ë§ì¼</option>
                </select>
              </div>
              <div class="form-group">
                <label for="paymentMethod">ê¸‰ì—¬ ì§€ê¸‰ ë°©ë²• *</label>
                <select id="paymentMethod" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="ê³„ì¢Œì´ì²´">ê³„ì¢Œì´ì²´</option>
                  <option value="í˜„ê¸ˆ">í˜„ê¸ˆ</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 5. ì§€ê¸‰ í•­ëª© ì„¤ì • -->
          <div class="form-section" style="border: 2px solid var(--primary-color); padding: var(--spacing-lg);">
            <h3>5. ê¸‰ì—¬ ì§€ê¸‰ í•­ëª© ì„¤ì •</h3>
            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-md);">
              ğŸ’¡ ì´ ì§ì›ì˜ ê¸‰ì—¬ ê³„ì‚° ì‹œ ì ìš©í•  ìˆ˜ë‹¹ í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”. (ë§¤ì¥ ì„¤ì • ê¸°ì¤€ìœ¼ë¡œ ìë™ ì„ íƒë¨)
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
              <label style="display: flex; align-items: center; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius); cursor: pointer;">
                <input type="checkbox" id="allowWeeklyHoliday" style="width: auto; margin-right: 8px;">
                <span style="font-size: 14px;">ì£¼íœ´ìˆ˜ë‹¹ (ì£¼ 15ì‹œê°„ ì´ìƒ ê·¼ë¬´ ì‹œ)</span>
              </label>
              
              <label style="display: flex; align-items: center; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius); cursor: pointer;">
                <input type="checkbox" id="allowOvertime" style="width: auto; margin-right: 8px;">
                <span style="font-size: 14px;">ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 1.5ë°°)</span>
              </label>
              
              <label style="display: flex; align-items: center; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius); cursor: pointer;">
                <input type="checkbox" id="allowNight" style="width: auto; margin-right: 8px;">
                <span style="font-size: 14px;">ì•¼ê°„ê·¼ë¡œìˆ˜ë‹¹ (22:00~06:00)</span>
              </label>
              
              <label style="display: flex; align-items: center; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius); cursor: pointer;">
                <input type="checkbox" id="allowHoliday" style="width: auto; margin-right: 8px;">
                <span style="font-size: 14px;">íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 1.5ë°°)</span>
              </label>
            </div>
          </div>

          <!-- 6. ê³µì œ í•­ëª© ì„¤ì • -->
          <div class="form-section" style="border: 2px solid var(--danger-color); padding: var(--spacing-lg);">
            <h3>6. 4ëŒ€ë³´í—˜ ì ìš©</h3>
            <div class="form-group">
              <label for="insuranceType">4ëŒ€ë³´í—˜ ë° ì„¸ê¸ˆ ì ìš© ë°©ì‹ *</label>
              <select id="insuranceType" required onchange="updateInsuranceInfo()">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="all">ì „ì²´ ì ìš© (êµ­ë¯¼ì—°ê¸ˆ+ê±´ê°•+ì¥ê¸°ìš”ì–‘+ê³ ìš©+ì‚°ì¬)</option>
                <option value="employment_only">ê³ ìš©Â·ì‚°ì¬ë³´í—˜ë§Œ (ë‹¨ì‹œê°„ ê·¼ë¡œì)</option>
                <option value="freelancer">ì†Œë“ì„¸ë§Œ ì ìš© (í”„ë¦¬ëœì„œ 3.3%)</option>
                <option value="none">ì™„ì „ ì ìš© ì•ˆ í•¨ (ì„¸ê¸ˆ ì—†ìŒ)</option>
              </select>
            </div>
            
            <div id="insuranceInfo" style="background: #f8f9fa; padding: var(--spacing-md); border-radius: var(--border-radius); font-size: 13px; color: #666; display: none;">
              <p style="margin: 0;"></p>
            </div>
            
            <div style="margin-top: var(--spacing-md);">
              <label style="display: flex; align-items: center; padding: var(--spacing-sm); background: var(--bg-light); border-radius: var(--border-radius); cursor: pointer;">
                <input type="checkbox" id="allowSeverancePay" style="width: auto; margin-right: 8px;">
                <span style="font-size: 14px;"><strong>í‡´ì§ê¸ˆ ì ìš© ëŒ€ìƒ</strong> (ì£¼ 15ì‹œê°„ ì´ìƒ ê·¼ë¬´, 1ë…„ ì´ìƒ ê·¼ì†)</span>
              </label>
            </div>
          </div>

          <!-- 7. ê³„ì•½ì„œ ë³¸ë¬¸ -->
          <div class="form-section">
            <h3>7. ê³„ì•½ì„œ ë³¸ë¬¸ (ì„ íƒì‚¬í•­)</h3>
            <div class="form-group">
              <label for="contractContent">ê³„ì•½ì„œ ì¶”ê°€ ë‚´ìš©</label>
              <textarea id="contractContent" placeholder="ê¸°ë³¸ í…œí”Œë¦¿ì´ ìë™ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤. í•„ìš”ì‹œ ìˆ˜ì •í•˜ì„¸ìš”." style="min-height: 500px; height: auto;"></textarea>
              <p class="help-text">íŠ¹ì•½ì‚¬í•­ì´ë‚˜ ì¶”ê°€ ë‚´ìš©ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”</p>
            </div>
          </div>

          <!-- ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="action-buttons">
            <button class="btn btn-secondary" onclick="closeContractModal()">â† ë‹«ê¸°</button>
            <button class="btn btn-secondary" onclick="showSaveContractModal()">ğŸ“ ê³„ì•½ì„œ ì €ì¥</button>
            <button class="btn btn-primary" onclick="switchContractTab('preview')">ë¯¸ë¦¬ë³´ê¸° â†’</button>
          </div>
        </div>

        <!-- ë¯¸ë¦¬ë³´ê¸° íƒ­ -->
        <div id="previewTab" class="tab-content">
          <div class="preview-section">
            <div class="preview-content" id="previewContent">
              <div class="preview-title">ê·¼ ë¡œ ê³„ ì•½ ì„œ</div>
              
              <p><strong><span id="previewCompanyName">(ì£¼)ABCë””ì €íŠ¸ì„¼í„°</span></strong> (ì´í•˜ "ì‚¬ìš©ì"ë¼ í•¨)ì™€ <strong id="previewName">_______</strong> (ì´í•˜ "ê·¼ë¡œì"ë¼ í•¨)ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê·¼ë¡œê³„ì•½ì„ ì²´ê²°í•œë‹¤.</p>

              <table class="preview-table">
                <tr>
                  <th>ê·¼ë¡œì (ì§ì›) ì •ë³´</th>
                  <td>
                    <div>ì„±ëª…: <span id="previewEmployeeName">_______</span></div>
                    <div>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸: <span id="previewBirth">_______</span></div>
                    <div>ì£¼ì†Œ: <span id="previewAddress">_______</span></div>
                    <div>ì—°ë½ì²˜: <span id="previewPhone">_______</span></div>
                  </td>
                </tr>
                <tr>
                  <th>ì‚¬ìš©ì (íšŒì‚¬) ì •ë³´</th>
                  <td>
                    <div>ìƒí˜¸: <span id="previewCompanyNameDetail">_______</span></div>
                    <div>ëŒ€í‘œì: <span id="previewCEODetail">_______</span></div>
                    <div>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: <span id="previewBusinessNumber">_______</span></div>
                    <div>íšŒì‚¬ ì „í™”ë²ˆí˜¸: <span id="previewCompanyPhone">_______</span></div>
                    <div>ì‚¬ì—…ì¥ ì£¼ì†Œ: <span id="previewCompanyAddress">_______</span></div>
                  </td>
                </tr>
                <tr>
                  <th>ê³„ì•½ ê¸°ê°„</th>
                  <td>
                    <span id="previewStartDate">_______</span> ~ <span id="previewEndDate">ê¸°ê°„ì˜ ì •í•¨ì´ ì—†ìŒ</span>
                  </td>
                </tr>
                <tr>
                  <th>ê·¼ë¬´ ì¥ì†Œ</th>
                  <td>ë§›ë‚¨ì‚´ë¡± <span id="previewStore">_______</span></td>
                </tr>
                <tr>
                  <th>ì—…ë¬´ ë‚´ìš©</th>
                  <td><span id="previewPosition">_______</span></td>
                </tr>
                <tr>
                  <th>ê·¼ë¬´ ì¼ì‹œ</th>
                  <td>
                    <div>ê·¼ë¬´ì¼: <span id="previewWorkDays">_______</span></div>
                    <div>ê·¼ë¬´ì‹œê°„: <span id="previewWorkTime">_______</span></div>
                    <div>íœ´ê²Œì‹œê°„: <span id="previewBreakTime">_______</span></div>
                  </td>
                </tr>
                <tr>
                  <th>ê¸‰ì—¬ ì¡°ê±´</th>
                  <td>
                    <div><span id="previewWageType">_______</span>: <span id="previewWageAmount">_______</span>ì›</div>
                    <div>ì§€ê¸‰ì¼: <span id="previewPaymentDay">_______</span></div>
                    <div>ì§€ê¸‰ë°©ë²•: <span id="previewPaymentMethod">_______</span></div>
                  </td>
                </tr>
              </table>

              <div id="previewContractBody"></div>

              <p style="text-align: center; margin-top: 40px;">
                <strong id="previewContractDate">20__ë…„ __ì›” __ì¼</strong>
              </p>

              <div style="margin-top: 40px; display: flex; justify-content: space-around;">
                <div style="text-align: center;">
                  <p>ì‚¬ìš©ì <span id="previewCompanyName2">(ì£¼)ABCë””ì €íŠ¸ì„¼í„°</span></p>
                  <p style="margin-top: 20px;">ëŒ€í‘œì´ì‚¬: <span id="previewCEO">_______</span> (ì¸)</p>
                </div>
                <div style="text-align: center;">
                  <p>ê·¼ë¡œì</p>
                  <p style="margin-top: 20px;"><span id="previewEmployeeName2">_______</span> (ì¸)</p>
                </div>
              </div>
            </div>
          </div>

          <!-- ì•¡ì…˜ ë²„íŠ¼ -->
          <div class="action-buttons">
            <button class="btn btn-secondary" onclick="switchContractTab('form')">â† ìˆ˜ì •í•˜ê¸°</button>
            <button class="btn btn-primary" onclick="generateContract()">ê³„ì•½ì„œ ìƒì„±</button>
          </div>

          <!-- ì„œëª… ë§í¬ í‘œì‹œ ì˜ì—­ -->
          <div id="signLinkSection" style="display: none; margin-top: var(--spacing-lg);">
            <div class="form-section">
              <h3 style="color: var(--success-color);">âœ… ê³„ì•½ì„œ ìƒì„± ì™„ë£Œ!</h3>
              <p style="margin-bottom: var(--spacing-md);">ê³„ì•½ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë§í¬ë¥¼ ì§ì›ì—ê²Œ ì „ì†¡í•˜ì—¬ ì„œëª…ì„ ìš”ì²­í•˜ì„¸ìš”.</p>
              
              <div style="margin-bottom: var(--spacing-md);">
                <label style="font-weight: 600; margin-bottom: 8px; display: block;">ğŸ“‹ ê³„ì•½ì„œ ID</label>
                <div id="contractIdDisplay" style="padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius); font-family: monospace;"></div>
              </div>

              <div style="margin-bottom: var(--spacing-md);">
                <label style="font-weight: 600; margin-bottom: 8px; display: block;">ğŸ”— ì„œëª… ë§í¬</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="signLinkInput" readonly style="flex: 1; padding: var(--spacing-md); border: 2px solid var(--success-color); border-radius: var(--border-radius);">
                  <button class="btn btn-primary" onclick="copySignLink()">ğŸ“‹ ë³µì‚¬</button>
                </div>
              </div>

              <div class="action-buttons">
                <button class="btn btn-secondary" onclick="closeContractModal()">â† ë‹«ê¸°</button>
                <button class="btn btn-primary" onclick="resetContractForm()">+ ìƒˆ ê³„ì•½ì„œ ì‘ì„±</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- íšŒì‚¬ ì¶”ê°€ ëª¨ë‹¬ -->
  <div id="addCompanyModal" class="modal-overlay" style="display: none; z-index: 10001;">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="companyModalTitle">ğŸ¢ íšŒì‚¬ ì¶”ê°€</h3>
        <button class="modal-close" onclick="closeAddCompanyModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editCompanyId" value="">
        <div class="form-group" style="margin-bottom: var(--spacing-md);">
          <label for="newCompanyName">íšŒì‚¬ëª… *</label>
          <input type="text" id="newCompanyName" placeholder="ì˜ˆ: (ì£¼)ABCë””ì €íŠ¸ì„¼í„°">
        </div>
        <div class="form-group" style="margin-bottom: var(--spacing-md);">
          <label for="newCompanyCEO">ëŒ€í‘œìëª… *</label>
          <input type="text" id="newCompanyCEO" placeholder="ì˜ˆ: í™ê¸¸ë™">
        </div>
        <div class="form-group" style="margin-bottom: var(--spacing-md);">
          <label for="newCompanyBusinessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ *</label>
          <input type="text" id="newCompanyBusinessNumber" placeholder="ì˜ˆ: 123-45-67890">
        </div>
        <div class="form-group" style="margin-bottom: var(--spacing-md);">
          <label for="newCompanyPhone">íšŒì‚¬ ì—°ë½ì²˜ *</label>
          <input type="tel" id="newCompanyPhone" placeholder="ì˜ˆ: 032-123-4567">
        </div>
        <div class="form-group" style="margin-bottom: var(--spacing-md);">
          <label for="newCompanyAddress">ì‚¬ì—…ì¥ ì£¼ì†Œ *</label>
          <input type="text" id="newCompanyAddress" placeholder="ì˜ˆ: ê²½ê¸°ë„ ë¶€ì²œì‹œ ì›ë¯¸êµ¬ 74">
        </div>
      </div>
      <div class="modal-footer">
        <div id="deleteCompanyBtnContainer" style="margin-right: auto; display: none;">
          <button class="btn btn-danger" onclick="deleteCompany()">ğŸ—‘ï¸ ì‚­ì œ</button>
        </div>
        <button class="btn btn-secondary" onclick="closeAddCompanyModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveCompany()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ê³„ì•½ì„œ ì €ì¥ ëª¨ë‹¬ -->
  <div id="saveContractModal" class="modal-overlay" style="display: none; z-index: 10001;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ’¾ ê³„ì•½ì„œ ì €ì¥</h3>
        <button class="modal-close" onclick="closeSaveContractModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p class="help-text" style="margin-bottom: var(--spacing-md);">
          ì €ì¥í•  ê³„ì•½ì„œì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.
        </p>
        <div class="form-group">
          <label for="contractSaveName">ê³„ì•½ì„œ ì´ë¦„ *</label>
          <input type="text" id="contractSaveName" placeholder="ì˜ˆ: í™ê¸¸ë™_ë°”ë¦¬ìŠ¤íƒ€_2024ë…„">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSaveContractModal()">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="saveContract()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ì €ì¥ëœ ê³„ì•½ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ëª¨ë‹¬ -->
  <div id="loadContractModal" class="modal-overlay" style="display: none; z-index: 10001;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ğŸ“‚ ì €ì¥ëœ ê³„ì•½ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</h3>
        <button class="modal-close" onclick="closeLoadContractModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p class="help-text" style="margin-bottom: var(--spacing-md);">
          ë¶ˆëŸ¬ì˜¬ ê³„ì•½ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”. í˜„ì¬ ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.
        </p>
        <div id="savedContractsList">
          <p style="text-align: center; padding: var(--spacing-xl); color: var(--text-secondary);">
            ì €ì¥ëœ ê³„ì•½ì„œê°€ ì—†ìŠµë‹ˆë‹¤.
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeLoadContractModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ê¸‰ì—¬ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="salaryDetailModal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 style="margin: 0;">ğŸ’° ê¸‰ì—¬ ìƒì„¸ ë‚´ì—­</h2>
        <button class="modal-close" onclick="closeSalaryDetailModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- ê¸°ë³¸ ì •ë³´ -->
        <div style="background: var(--bg-light); padding: var(--spacing-lg); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg);">
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md);">
            <div>
              <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">ì§ì›ëª…</div>
              <div style="font-size: 16px; font-weight: 600;" id="salaryDetailName">-</div>
            </div>
            <div>
              <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">ë§¤ì¥</div>
              <div style="font-size: 16px; font-weight: 600;" id="salaryDetailStore">-</div>
            </div>
            <div>
              <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">ì¡°íšŒ ì›”</div>
              <div style="font-size: 16px; font-weight: 600;" id="salaryDetailMonth">-</div>
            </div>
            <div>
              <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">ê·¼ë¬´ ì¼ìˆ˜</div>
              <div style="font-size: 16px; font-weight: 600;" id="salaryDetailWorkDays">-</div>
            </div>
          </div>
        </div>

        <!-- ì§€ê¸‰ í•­ëª© -->
        <div style="margin-bottom: var(--spacing-lg);">
          <h3 style="font-size: 16px; margin-bottom: var(--spacing-md); color: var(--primary-color);">ğŸ“Š ì§€ê¸‰ í•­ëª©</h3>
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 2px solid var(--border-color);">
              <td style="padding: 12px; font-weight: 600;">í•­ëª©</td>
              <td style="padding: 12px; text-align: right; font-weight: 600;">ê¸ˆì•¡</td>
            </tr>
            <tr>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                ê¸°ë³¸ê¸‰ (ì‹œê¸‰ <span id="salaryDetailHourlyWage">-</span>ì› Ã— <span id="salaryDetailTotalHours">-</span>ì‹œê°„)
              </td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color);" id="salaryDetailBasePay">-</td>
            </tr>
            <tr id="salaryDetailOvertimeRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                ì—°ì¥ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 1.5ë°° Ã— <span id="salaryDetailOvertimeHours">-</span>ì‹œê°„)
              </td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--success-color);" id="salaryDetailOvertimePay">-</td>
            </tr>
            <tr id="salaryDetailNightRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                ì•¼ê°„ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 0.5ë°° Ã— <span id="salaryDetailNightHours">-</span>ì‹œê°„)
              </td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--success-color);" id="salaryDetailNightPay">-</td>
            </tr>
            <tr id="salaryDetailHolidayRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                íœ´ì¼ê·¼ë¡œìˆ˜ë‹¹ (ì‹œê¸‰ Ã— 1.5ë°°)
              </td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--success-color);" id="salaryDetailHolidayPay">-</td>
            </tr>
            <tr id="salaryDetailWeeklyRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                ì£¼íœ´ìˆ˜ë‹¹
              </td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--success-color);" id="salaryDetailWeeklyPay">-</td>
            </tr>
            <tr style="background: var(--bg-light); font-weight: 600;">
              <td style="padding: 12px; border-bottom: 2px solid var(--border-color);">ì´ ì§€ê¸‰ì•¡ (ê³µì œ ì „)</td>
              <td style="padding: 12px; text-align: right; font-size: 16px; border-bottom: 2px solid var(--border-color);" id="salaryDetailTotalPay">-</td>
            </tr>
          </table>
        </div>

        <!-- ê³µì œ í•­ëª© -->
        <div style="margin-bottom: var(--spacing-lg);">
          <h3 style="font-size: 16px; margin-bottom: var(--spacing-md); color: var(--danger-color);">ğŸ“‹ ê³µì œ í•­ëª©</h3>
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="border-bottom: 2px solid var(--border-color);">
              <td style="padding: 12px; font-weight: 600;">í•­ëª©</td>
              <td style="padding: 12px; text-align: right; font-weight: 600;">ê¸ˆì•¡</td>
            </tr>
            <tr id="salaryDetailPensionRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">êµ­ë¯¼ì—°ê¸ˆ (4.5%)</td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--danger-color);" id="salaryDetailPension">-</td>
            </tr>
            <tr id="salaryDetailHealthRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">ê±´ê°•ë³´í—˜ (3.545%)</td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--danger-color);" id="salaryDetailHealth">-</td>
            </tr>
            <tr id="salaryDetailLongTermRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">ì¥ê¸°ìš”ì–‘ (0.459%)</td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--danger-color);" id="salaryDetailLongTerm">-</td>
            </tr>
            <tr id="salaryDetailEmploymentRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">ê³ ìš©ë³´í—˜ (0.9%)</td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--danger-color);" id="salaryDetailEmployment">-</td>
            </tr>
            <tr id="salaryDetailTaxRow" style="display: none;">
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">ì†Œë“ì„¸ (3.3%)</td>
              <td style="padding: 12px; text-align: right; border-bottom: 1px solid var(--border-color); color: var(--danger-color);" id="salaryDetailTax">-</td>
            </tr>
            <tr style="background: var(--bg-light); font-weight: 600;">
              <td style="padding: 12px; border-bottom: 2px solid var(--border-color);">ì´ ê³µì œì•¡</td>
              <td style="padding: 12px; text-align: right; font-size: 16px; border-bottom: 2px solid var(--border-color); color: var(--danger-color);" id="salaryDetailTotalDeduction">-</td>
            </tr>
          </table>
        </div>

        <!-- ì‹¤ì§€ê¸‰ì•¡ -->
        <div style="background: var(--primary-color); color: white; padding: var(--spacing-lg); border-radius: var(--border-radius); text-align: center;">
          <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9;">ì‹¤ì§€ê¸‰ì•¡</div>
          <div style="font-size: 32px; font-weight: 700;" id="salaryDetailNetPay">-</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSalaryDetailModal()">ë‹«ê¸°</button>
        <button class="btn btn-success" onclick="confirmSalary()">âœ… ê¸‰ì—¬ í™•ì •</button>
      </div>
    </div>
  </div>

  <script>
    // ë§¤ì¥ ì„œëª… ë¯¸ë¦¬ë³´ê¸°
    function previewStoreSignature(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('âŒ ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        storeCeoSignatureData = e.target.result;
        const preview = document.getElementById('storeCeoSignaturePreview');
        preview.innerHTML = `<img src="${storeCeoSignatureData}" style="max-width: 100%; max-height: 100px; object-fit: contain;">`;
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
